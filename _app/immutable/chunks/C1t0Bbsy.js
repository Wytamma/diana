import{d as h,w as d}from"./3ms3zztt.js";const p=c=>c.reduce(([o,s],e)=>[Math.min(o,e),Math.max(s,e)],[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]);function I(){const{subscribe:c,set:o,update:s}=d(new Map);return{subscribe:c,set:o,update:s,reset:()=>o(new Map),load:async(e,t)=>{const r=await w(t);e.toLowerCase().includes("0")||(r.isTreatment=!0),s(a=>(a.set(e,r),a))},remove:e=>s(t=>(t.delete(e),t)),setIsTreatment:(e,t)=>s(r=>{const a=r.get(e);return a&&(a.isTreatment=t),r}),containsControlAndTreatment:()=>{let e=!1,t=!1;return c(r=>{r.forEach(a=>{a.isTreatment?e=!0:t=!0})}),e&&t}}}async function w(c,o=5e4){var a;const s=c.split(`
`),e={wig:c,chromosomes:new Map,isTreatment:!1},t={};let r;for(let i=0;i<s.length;i+=o)s.slice(i,i+o).forEach(n=>{if(n.startsWith("variableStep"))r=n.split("chrom=")[1].split(/\s+/)[0],t[r]=new Map;else{if(n.startsWith("fixedStep"))throw new Error("Fixed step WIG files are not supported");if(/^\d/.test(n)){const[l,f]=n.split(/\s+/).map(u=>parseInt(u,10));if(r===void 0)throw new Error("Invalid WIG file format: missing chromosome (chrom=) line");t[r].set(l,(t[r].get(l)||0)+Math.abs(f))}}}),await new Promise(n=>setTimeout(n,0));for(const i in t){const[,m]=p(Array.from(t[i].keys()));for(let n=0;n<=m;n++)e.chromosomes.set(i,e.chromosomes.get(i)||[]),(a=e.chromosomes.get(i))==null||a.push(t[i].get(n)||0)}return e}const T=I(),g=h(T,c=>{let o=!1,s=!1;return c.forEach(e=>{e.isTreatment?o=!0:s=!0}),o&&s});export{g as c,T as i};
