import{d as h,w as d}from"./3ms3zztt.js";const p=c=>c.reduce(([a,s],e)=>[Math.min(a,e),Math.max(s,e)],[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]);function I(){const{subscribe:c,set:a,update:s}=d(new Map);return{subscribe:c,set:a,update:s,reset:()=>a(new Map),load:async(e,t)=>{const r=await w(t);e.toLowerCase().includes("0")||(r.isTreatment=!0),s(n=>(n.set(e,r),n))},remove:e=>s(t=>(t.delete(e),t)),setIsTreatment:(e,t)=>s(r=>{const n=r.get(e);return n&&(n.isTreatment=t),r}),containsControlAndTreatment:()=>{let e=!1,t=!1;return c(r=>{r.forEach(n=>{console.log(n.isTreatment),n.isTreatment?e=!0:t=!0})}),e&&t}}}async function w(c,a=5e4){var n;const s=c.split(`
`),e={wig:c,chromosomes:new Map,isTreatment:!1},t={};let r;for(let i=0;i<s.length;i+=a)s.slice(i,i+a).forEach(o=>{if(o.startsWith("variableStep"))r=o.split("chrom=")[1].split(/\s+/)[0],t[r]=new Map;else{if(o.startsWith("fixedStep"))throw new Error("Fixed step WIG files are not supported");if(/^\d/.test(o)){const[l,f]=o.split(/\s+/).map(u=>parseInt(u,10));if(r===void 0)throw new Error("Invalid WIG file format: missing chromosome (chrom=) line");t[r].set(l,(t[r].get(l)||0)+Math.abs(f))}}}),await new Promise(o=>setTimeout(o,0));for(const i in t){const[,m]=p(Array.from(t[i].keys()));for(let o=0;o<=m;o++)e.chromosomes.set(i,e.chromosomes.get(i)||[]),(n=e.chromosomes.get(i))==null||n.push(t[i].get(o)||0)}return e}const T=I(),M=h(T,c=>{let a=!1,s=!1;return c.forEach(e=>{e.isTreatment?a=!0:s=!0}),a&&s});export{M as c,T as i};
