import{d as h,w as p}from"./index.1X6iZZfA.js";const d=c=>c.reduce(([a,s],t)=>[Math.min(a,t),Math.max(s,t)],[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]);function I(){const{subscribe:c,set:a,update:s}=p(new Map);return{subscribe:c,set:a,update:s,reset:()=>a(new Map),load:async(t,e)=>{const r=await w(e);t.toLowerCase().includes("0")||(r.isTreatment=!0),s(o=>(o.set(t,r),o))},remove:t=>s(e=>(e.delete(t),e)),setIsTreatment:(t,e)=>s(r=>{const o=r.get(t);return o&&(o.isTreatment=e),r}),containsControlAndTreatment:()=>{let t=!1,e=!1;return c(r=>{r.forEach(o=>{console.log(o.isTreatment),o.isTreatment?t=!0:e=!0})}),t&&e}}}async function w(c,a=5e4){var o;const s=c.split(`
`),t={wig:c,chromosomes:new Map,isTreatment:!1},e={};let r;for(let i=0;i<s.length;i+=a)s.slice(i,i+a).forEach(n=>{if(n.startsWith("variableStep"))r=n.split("chrom=")[1].split(/\s+/)[0],e[r]=new Map;else{if(n.startsWith("fixedStep"))throw new Error("Fixed step WIG files are not supported");if(/^\d/.test(n)){const[l,f]=n.split(/\s+/).map(u=>parseInt(u,10));if(r===void 0)throw new Error("Invalid WIG file format: missing chromosome (chrom=) line");e[r].set(l,(e[r].get(l)||0)+Math.abs(f))}}}),await new Promise(n=>setTimeout(n,0));for(const i in e){const[,m]=d(Array.from(e[i].keys()));for(let n=0;n<=m;n++)t.chromosomes.set(i,t.chromosomes.get(i)||[]),(o=t.chromosomes.get(i))==null||o.push(e[i].get(n)||0)}return t}const T=I(),M=h(T,c=>{let a=!1,s=!1;return c.forEach(t=>{t.isTreatment?a=!0:s=!0}),a&&s});export{M as c,T as i};
