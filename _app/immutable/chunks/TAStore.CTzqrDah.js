import{w as h,d as v}from"./index.DsiQ7ewd.js";import{B as L,c as b}from"./aioli.BDahayWZ.js";function T(){const{subscribe:o,set:a,update:i}=h(new Map);return{subscribe:o,set:a,update:i,reset:()=>a(new Map),load:async(e,n)=>{const t=await F(n);console.log(t),i(s=>(s.set(e,t),s))},remove:e=>i(n=>(n.delete(e),n))}}async function F(o,a=5e4){const i=o.split(`
`),e=[],n={wig:"",insertions:[]};e.push("track type=wiggle_0 visibility=full autoScale=on color=255,150,0 yLineMark=0 yLineOnOff=on"),e.push("variableStep chrom=chrom span=2");for(let t=0;t<i.length;t+=a)i.slice(t,t+a).forEach((r,u)=>{const[l,w]=r.split(/\s+/).map(c=>parseInt(c,10));n.insertions.push({plus:l,minus:w}),l!==0&&e.push(`${t+u} ${l}`),w!==0&&e.push(`${t+u} -${w}`)}),console.log(t),await new Promise(r=>setTimeout(r,0));return n.wig=e.join(`
`),n}const P=T();function I(o){const a=[];return o.forEach((i,e)=>{i.forEach(n=>{const t=n+2,s=`${e}	${n}	${t}`;a.push(s)})}),a.join(`
`)}function k(){const o={raw:new Map},{subscribe:a,set:i,update:e}=h(o);return{subscribe:a,set:i,update:e,reset:()=>i(o),load:async n=>{const t=n.split(`
`);let s="",r="";const u=new Map;for(const p of t)p.startsWith(">")?(s&&r&&u.set(s,r),s=p.substring(1).trim(),r=""):r+=p.trim();s&&r&&u.set(s,r);const l=new Map;u.forEach((p,y)=>{const g=[];for(let d=0;d<p.length-1;d++)p[d]==="T"&&p[d+1]==="A"&&g.push(d);l.set(y,g)});const w=I(l);console.log(w);const c=await new L([{tool:"tabix",version:"1.17",urlPrefix:`${window.location.origin}./tools/tabix`},{tool:"bgzip",version:"1.17",urlPrefix:`${window.location.origin}./tools/bgzip`}]),f=await c.mount([{name:"data.bed",data:w}]);await c.exec(`bgzip ${f[0]}`),await c.exec(`tabix -p bed ${f[0]}.gz`);const $=await c.fs.stat(`${f[0]}.gz`),m=await c.read({path:`${f[0]}.gz`,length:$.size}),x=b(m),z=await c.fs.stat(`${f[0]}.gz.tbi`),M=await c.read({path:`${f[0]}.gz.tbi`,length:z.size}),S=b(M);i({raw:l,url:x,indexUrl:S})}}}const A=k();v(A,o=>o);export{P as i,A as t};
