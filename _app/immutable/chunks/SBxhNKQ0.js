var N=Object.defineProperty;var A=(s,e,t)=>e in s?N(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var n=(s,e,t)=>A(s,typeof e!="symbol"?e+"":e,t);import{w as p,d as f}from"./DWhds3qF.js";import{M as d,s as F,e as _,c as O,l as E,m as C,i as B,Q as j,n as R,f as L,k as T}from"./fdk2rqUP.js";import{S as M,i as D}from"./CdCg8B6F.js";const H=s=>s==null||s==="",W=s=>!H(s),b=(s,e)=>{const t=e??s.toString();if(typeof s=="string")return{callback:r=>r[s],identifier:t,key:s};if(typeof s=="function")return{callback:s,identifier:t,key:void 0};throw new Error(`Invalid field argument: ${String(s)}`)},S={isLike:(s,e)=>u(s).indexOf(u(e))>-1,isNotLike:(s,e)=>u(s).indexOf(u(e))===-1,startsWith:(s,e)=>u(s).startsWith(u(e)),endsWith:(s,e)=>u(s).endsWith(u(e)),isEqualTo:(s,e)=>u(s)===u(e),isNotEqualTo:(s,e)=>u(s)!==u(e),isGreaterThan:(s,e)=>m(s)?!1:s>e,isGreaterThanOrEqualTo:(s,e)=>m(s)?!1:s>=e,isLessThan:(s,e)=>m(s)?!1:s<e,isLessThanOrEqualTo:(s,e)=>m(s)?!1:s<=e,isBetween:(s,e)=>{if(m(s))return!1;const[t,r]=e;return s>=t&&s<=r},isStrictlyBetween:(s,e)=>{if(m(s))return!1;const[t,r]=e;return s>t&&s<r},isTrue:(s,e)=>s===!0,isFalse:(s,e)=>s===!1,isNull:(s,e)=>s==null,isNotNull:(s,e)=>s!=null,whereIn:(s,e=[])=>{if(m(s)||e.length===0)return!1;for(const{value:t,comparator:r}of e)if(r(s,t))return!0;return!1},contains:(s,e)=>S.isLike(s,e)};function u(s=null){return String(s).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function m(s){if(s==null)return!0}class I{constructor(){n(this,"events",{change:[],clearFilters:[],clearSearch:[]});n(this,"triggerChange",p(0))}add(e,t){this.events[e].push(t)}trigger(e){for(const t of this.events[e])t();e==="change"&&this.triggerChange.update(t=>t+1)}}class q{constructor(e,t){n(this,"event");n(this,"rowsPerPage");n(this,"pageNumber");n(this,"search");n(this,"filters");n(this,"filterCount");n(this,"rawRows");n(this,"filteredRows");n(this,"pagedRows");n(this,"rowCount");n(this,"pages");n(this,"pagesWithEllipsis");n(this,"pageCount");n(this,"sort");n(this,"selected");n(this,"selectScope");n(this,"isAllSelected");this.event=new I,this.rowsPerPage=p(t.rowsPerPage),this.pageNumber=p(1),this.search=p({}),this.filters=p([]),this.filterCount=this.createFilterCount(),this.rawRows=p(e),this.filteredRows=this.createFilteredRows(),this.pagedRows=this.createPagedRows(),this.rowCount=this.createRowCount(),this.pages=this.createPages(),this.pagesWithEllipsis=this.createPagesWithEllipsis(),this.pageCount=this.createPageCount(),this.sort=p({}),this.selected=p([]),this.selectScope=p("all"),this.isAllSelected=this.createIsAllSelected()}createFilterCount(){return f(this.filters,e=>e.length)}createFilteredRows(){return f([this.rawRows,this.search,this.filters],([e,t,r])=>(t.value&&(e=e.filter(i=>(t.scope??Object.keys(i)).map(h=>{const{callback:g}=b(h);return g}).some(h=>this.match(h(i),t.value))),this.pageNumber.set(1),this.selected.set([]),this.event.trigger("change")),r.length>0&&(r.forEach(i=>e=e.filter(l=>{const o=i.callback(l);return this.match(o,i.value,i.comparator)})),this.pageNumber.set(1),this.selected.set([]),this.event.trigger("change")),e))}match(e,t,r=null){if(H(t))return!0;if(!e&&r)return r(e,t);if(e){if(typeof e=="object")return Object.keys(e).some(i=>this.match(e[i],t,r))}else return S.isLike(e,t);return r?r(e,t):S.isLike(e,t)}createPagedRows(){return f([this.filteredRows,this.rowsPerPage,this.pageNumber],([e,t,r])=>t?e.slice((r-1)*t,r*t):e)}createRowCount(){return f([this.filteredRows,this.pageNumber,this.rowsPerPage],([e,t,r])=>{const i=e.length;return r?{total:i,start:t*r-r+1,end:Math.min(t*r,e.length)}:{total:i,start:1,end:i}})}createPages(){return f([this.rowsPerPage,this.filteredRows],([e,t])=>e?Array.from(Array(Math.ceil(t.length/e))).map((i,l)=>l+1):[1])}createPagesWithEllipsis(){return f([this.pages,this.pageNumber],([e,t])=>{if(e.length<=7)return e;const r=null,i=1,l=e.length;return t<=4?[...e.slice(0,5),r,l]:t<e.length-3?[i,r,...e.slice(t-2,t+1),r,l]:[i,r,...e.slice(e.length-5,e.length)]})}createPageCount(){return f(this.pages,e=>e.length)}createIsAllSelected(){return f([this.selected,this.pagedRows,this.filteredRows,this.selectScope],([e,t,r,i])=>{const l=i==="currentPage"?t.length:r.length;return l===e.length&&l!==0})}}class J{constructor(e){n(this,"rawRows");n(this,"event");n(this,"sort");n(this,"backup");this.rawRows=e.rawRows,this.event=e.event,this.sort=e.sort,this.backup=[]}set(e=null,t){if(!e)return;const r=d(this.sort),{identifier:i}=b(e,t);r.identifier!==i&&this.sort.update(l=>l.direction=null),r.direction===null||r.direction==="desc"?this.asc(e,t):r.direction==="asc"&&this.desc(e,t)}asc(e,t){if(!e)return;const{identifier:r,callback:i,key:l}=b(e,t);this.sort.set({identifier:r,callback:i,direction:"asc",key:l}),this.rawRows.update(o=>(o.sort((h,g)=>{const[c,a]=[i(h),i(g)];return c===a?0:c===null?1:a===null?-1:typeof c=="boolean"?c===!1?1:-1:typeof c=="string"?c.localeCompare(a):typeof c=="number"?c-a:typeof c=="object"?JSON.stringify(c).localeCompare(JSON.stringify(a)):String(c).localeCompare(String(a))}),o)),this.log({identifier:r,callback:i,direction:"asc"}),this.event.trigger("change")}desc(e,t){if(!e)return;const{identifier:r,callback:i,key:l}=b(e,t);this.sort.set({identifier:r,callback:i,direction:"desc",key:l}),this.rawRows.update(o=>(o.sort((h,g)=>{const[c,a]=[i(h),i(g)];return c===a?0:c===null?1:a===null?-1:typeof a=="boolean"?a===!1?1:-1:typeof a=="string"?a.localeCompare(c):typeof a=="number"?a-c:typeof a=="object"?JSON.stringify(a).localeCompare(JSON.stringify(c)):String(a).localeCompare(String(c))}),o)),this.log({identifier:r,callback:i,direction:"desc"}),this.event.trigger("change")}apply(e=null){if(e)switch(e.direction){case"asc":return this.asc(e.orderBy);case"desc":return this.desc(e.orderBy);default:return this.set(e.orderBy)}else this.restore()}clear(){this.backup=[],this.sort.set({})}define(e,t="asc"){if(!e)return;const{identifier:r,callback:i,key:l}=b(e);this.sort.set({identifier:r,callback:i,direction:t,key:l})}restore(){for(const e of this.backup){const{key:t,callback:r,direction:i}=e,l=t??r;this[i](l)}}log(e){if(this.backup=this.backup.filter(t=>t.identifier!==e.identifier),this.backup.length>=3){const[t,r,i]=this.backup;this.backup=[r,i,e]}else this.backup=[...this.backup,e]}}class z{constructor(e){n(this,"filteredRows");n(this,"pagedRows");n(this,"selected");n(this,"scope");n(this,"isAllSelected");n(this,"event");this.filteredRows=e.filteredRows,this.pagedRows=e.pagedRows,this.selected=e.selected,this.scope=e.selectScope,this.isAllSelected=e.isAllSelected,this.event=e.event}set(e){const t=d(this.selected);t.includes(e)?this.selected.set(t.filter(r=>r!==e)):this.selected.set([e,...t])}all(e=null){if(d(this.isAllSelected))return this.clear();const r=d(this.scope),i=r==="currentPage"?d(this.pagedRows):d(this.filteredRows);r==="currentPage"&&this.event.add("change",()=>this.clear()),e?this.selected.set(i.map(l=>l[e])):this.selected.set(i)}clear(){this.selected.set([])}}class G{constructor(e){n(this,"pageNumber");n(this,"rowCount");n(this,"rowsPerPage");n(this,"event");this.pageNumber=e.pageNumber,this.rowCount=e.rowCount,this.rowsPerPage=e.rowsPerPage,this.event=e.event}goto(e){this.pageNumber.update(t=>{const r=d(this.rowsPerPage);if(r){const i=d(this.rowCount).total;e>=1&&e<=Math.ceil(i/r)&&(t=e,this.event.trigger("change"))}return t})}previous(){const e=d(this.pageNumber)-1;this.goto(e)}next(){const e=d(this.pageNumber)+1;this.goto(e)}}class U{constructor(e){n(this,"search");n(this,"event");this.search=e.search,this.event=e.event}set(e,t=null){this.search.update(r=>(r={value:e??"",scope:t??null},r))}clear(){this.search.set({value:null,scope:null}),this.event.trigger("change"),this.event.trigger("clearSearch")}}class V{constructor(e){n(this,"filters");n(this,"event");n(this,"collection");this.filters=e.filters,this.event=e.event}set(e,t,r=null,i){const{callback:l,identifier:o,key:h}=b(t,i),g={value:e,identifier:o,callback:l,comparator:r,key:h};this.filters.update(c=>(c=c.filter(a=>a.identifier!==o),W(e)&&c.push(g),c))}clear(){this.filters.set([]),this.event.trigger("change"),this.event.trigger("clearFilters")}get(){return this.collection?this.collection:(this.collection=this.createCollection(),this.collection)}createCollection(){return f(this.filters,e=>e.map(({value:t,callback:r,key:i,comparator:l})=>({value:t,filterBy:i??r,check:l?l.name:"isLike"})))}}class Q{constructor(e,t,r){n(this,"filterHandler");n(this,"filterBy");n(this,"uid");n(this,"comparator");n(this,"callback");this.filterHandler=e,this.filterBy=t,this.uid="f_"+Math.random().toString(28).substring(2),this.comparator=r??S.isLike,this.callback=()=>null}set(e,t){t&&(this.comparator=t),this.filterHandler.set(e,this.filterBy,this.comparator,this.uid)}clear(){this.callback(),this.filterHandler.set(void 0,this.filterBy)}on(e,t){this.callback=t}}class K{constructor(e,t){n(this,"filterHandler");n(this,"criteria");n(this,"filterBy");n(this,"selected");this.filterHandler=e,this.filterBy=t,this.criteria=[],this.selected=p([])}set(e,t=S.isLike){if(this.criteria.find(r=>r.value===e)?this.criteria=this.criteria.filter(r=>r.value!==e):this.criteria=[{value:e,comparator:t},...this.criteria],this.criteria.length===0)return this.clear();this.filterHandler.set(this.criteria,this.filterBy,S.whereIn),this.selected.set(this.criteria.map(r=>r.value))}getSelected(){return this.selected}clear(){this.criteria=[],this.selected.set([]),this.filterHandler.set(void 0,this.filterBy,S.whereIn)}}class X{constructor(e,t,r){n(this,"rawRows");n(this,"filteredRows");n(this,"callback");n(this,"precision");this.rawRows=e.rawRows,this.filteredRows=e.filteredRows,this.callback=b(t).callback,this.precision=r.precision}distinct(e=null){const r=d(this.rawRows).map(o=>this.callback(o)),l=(e?e(r):r).reduce((o,h)=>(o[h]=(o[h]??0)+1,o),{});return Object.entries(l).map(([o,h])=>({value:o,count:h}))}avg(e=null){return f(this.filteredRows,t=>{if(t.length===0)return 0;const r=t.map(l=>this.callback(l)).filter(Boolean),i=e?e(r):r;return this.round(i.reduce((l,o)=>l+o,0)/i.length)})}sum(e=null){return f(this.filteredRows,t=>{const r=t.map(l=>this.callback(l)),i=e?e(r):r;return this.round(i.reduce((l,o)=>l+o,0))})}bounds(e=null){const r=d(this.rawRows).map(l=>this.callback(l)),i=e?e(r):r;return[Math.min(...i.filter(Boolean)),Math.max(...i.filter(Boolean))]}setPrecision(e){this.precision=e}round(e){if(this.precision===0)return Math.round(e);const t=Math.pow(10,this.precision);return Math.round((e+Number.EPSILON)*t)/t}}class se{constructor(e=[],t={rowsPerPage:null}){n(this,"context");n(this,"sortHandler");n(this,"selectHandler");n(this,"pageHandler");n(this,"searchHandler");n(this,"filterHandler");n(this,"i18n");this.i18n=this.translate(t.i18n),this.context=new q(e,t),this.sortHandler=new J(this.context),this.selectHandler=new z(this.context),this.pageHandler=new G(this.context),this.searchHandler=new U(this.context),this.filterHandler=new V(this.context)}setRows(e){this.context.rawRows.set(e),this.context.event.trigger("change"),this.applySort()}getRows(){return this.context.pagedRows}getAllRows(){return this.context.filteredRows}getRowCount(){return this.context.rowCount}getRowsPerPage(){return this.context.rowsPerPage}getPages(e={ellipsis:!1}){return e.ellipsis?this.context.pagesWithEllipsis:this.context.pages}getPageCount(){return this.context.pageCount}getPageNumber(){return this.context.pageNumber}setPage(e){switch(e){case"previous":return this.pageHandler.previous();case"next":return this.pageHandler.next();default:return this.pageHandler.goto(e)}}search(e,t=null){this.searchHandler.set(e,t)}clearSearch(){this.searchHandler.clear()}sort(e,t){this.setPage(1),this.sortHandler.set(e,t)}sortAsc(e,t){this.setPage(1),this.sortHandler.asc(e,t)}sortDesc(e,t){this.setPage(1),this.sortHandler.desc(e,t)}getSort(){return this.context.sort}applySort(e=null){this.sortHandler.apply(e)}defineSort(e,t){this.sortHandler.define(e,t)}clearSort(){this.sortHandler.clear()}filter(e,t,r=null){this.filterHandler.set(e,t,r)}getFilters(){return this.filterHandler.get()}createFilter(e,t){return new Q(this.filterHandler,e,t)}createAdvancedFilter(e){return new K(this.filterHandler,e)}getFilterCount(){return this.context.filterCount}clearFilters(){this.filterHandler.clear()}select(e){this.selectHandler.set(e)}getSelected(){return this.context.selected}selectAll(e={}){this.context.selectScope.set(e.scope==="currentPage"?"currentPage":"all"),this.selectHandler.all(e.selectBy??null)}isAllSelected(){return this.context.isAllSelected}on(e,t){this.context.event.add(e,t)}createCalculation(e,t=null){return new X(this.context,e,{precision:(t==null?void 0:t.precision)??2})}translate(e){return{search:"Search...",show:"Show",entries:"entries",filter:"Filter",rowCount:"Showing {start} to {end} of {total} entries",noRows:"No entries found",previous:"Previous",next:"Next",...e}}update(e){console.log("%c%s","color:#e65100;background:#fff3e0;font-size:12px;border-radius:4px;padding:4px;text-align:center;","DataHandler.update(data) method is deprecated. Please use DataHandler.setRows(data) instead"),this.context.rawRows.set(e)}applySorting(e=null){this.applySort(e)}getSorted(){return this.getSort()}getTriggerChange(){return this.context.event.triggerChange}}function Y(s){let e,t="Export CSV",r,i;return{c(){e=_("button"),e.textContent=t,this.h()},l(l){e=O(l,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),E(e)!=="svelte-dkqpww"&&(e.textContent=t),this.h()},h(){C(e,"type","button"),C(e,"class","btn variant-ghost-surface mr-2 hover:variant-soft-primary")},m(l,o){B(l,e,o),r||(i=j(e,"click",s[4]),r=!0)},p:R,i:R,o:R,d(l){l&&L(e),r=!1,i()}}}function Z(s,e,t){let r,{handler:i}=e,{filename:l="diana.csv"}=e,o=i.getAllRows();T(s,o,a=>t(5,r=a));function h(){const a=Object.keys(r[0]),k=r.map(w=>Object.entries(w).map(([P,v])=>P==="attributes"?Object.entries(v).map(([x,y])=>`${x}=${y}`).join(";"):v).join(","));return k.unshift(a.join(",")),k.join(`\r
`)}function g(a){let k=h();const w=document.createElement("a");w.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(k)),w.setAttribute("download",a),w.style.display="none",document.body.appendChild(w),w.click(),document.body.removeChild(w)}const c=()=>g(l);return s.$$set=a=>{"handler"in a&&t(3,i=a.handler),"filename"in a&&t(0,l=a.filename)},[l,o,g,i,c]}class ie extends M{constructor(e){super(),D(this,e,Z,Y,F,{handler:3,filename:0})}}export{se as D,ie as a};
