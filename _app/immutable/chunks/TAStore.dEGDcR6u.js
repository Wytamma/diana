import{w as h,d as v}from"./index.BXt1N_H5.js";import{B as L,c as g}from"./aioli.BDahayWZ.js";function T(){const{subscribe:a,set:s,update:o}=h(new Map);return{subscribe:a,set:s,update:o,reset:()=>s(new Map),load:async(n,t)=>{const r=await F(t);console.log(r),o(e=>(e.set(n,r),e))},remove:n=>o(t=>(t.delete(n),t))}}async function F(a,s=5e4){const o=a.split(`
`),n=[];n.push("track type=wiggle_0 visibility=full autoScale=on color=255,150,0 yLineMark=0 yLineOnOff=on"),n.push("variableStep chrom=chrom span=2");for(let t=0;t<o.length;t+=s)o.slice(t,t+s).forEach((e,i)=>{const[u,p]=e.split(/\s+/).map(w=>parseInt(w,10));u!==0&&n.push(`${t+i} ${u}`),p!==0&&n.push(`${t+i} -${p}`)}),console.log(t),await new Promise(e=>setTimeout(e,0));return n.join(`
`)}const B=T();function P(a){const s=[];return a.forEach((o,n)=>{o.forEach(t=>{const r=t+2,e=`${n}	${t}	${r}`;s.push(e)})}),s.join(`
`)}function k(){const a={raw:new Map},{subscribe:s,set:o,update:n}=h(a);return{subscribe:s,set:o,update:n,reset:()=>o(a),load:async t=>{const r=t.split(`
`);let e="",i="";const u=new Map;for(const l of r)l.startsWith(">")?(e&&i&&u.set(e,i),e=l.substring(1).trim(),i=""):i+=l.trim();e&&i&&u.set(e,i);const p=new Map;u.forEach((l,y)=>{const b=[];for(let d=0;d<l.length-1;d++)l[d]==="T"&&l[d+1]==="A"&&b.push(d);p.set(y,b)});const w=P(p);console.log(w);const c=await new L([{tool:"tabix",version:"1.17",urlPrefix:`${window.location.origin}./tools/tabix`},{tool:"bgzip",version:"1.17",urlPrefix:`${window.location.origin}./tools/bgzip`}]),f=await c.mount([{name:"data.bed",data:w}]);await c.exec(`bgzip ${f[0]}`),await c.exec(`tabix -p bed ${f[0]}.gz`);const $=await c.fs.stat(`${f[0]}.gz`),m=await c.read({path:`${f[0]}.gz`,length:$.size}),x=g(m),z=await c.fs.stat(`${f[0]}.gz.tbi`),M=await c.read({path:`${f[0]}.gz.tbi`,length:z.size}),S=g(M);o({raw:p,url:x,indexUrl:S})}}}const E=k();v(E,a=>a);export{E as t,B as u};
