import{s as or,e as I,a as A,c as B,b as N,f as T,g as D,l as jt,m as ae,u as Rr,i as le,h as w,I as gn,n as rt,J as wn,k as Vt,t as te,d as re,j as Ue}from"../chunks/fdk2rqUP.js";import{S as lr,i as ur,t as j,g as qt,a as P,c as zt,b as W,d as F,m as V,e as q}from"../chunks/CdCg8B6F.js";import{i as bn}from"../chunks/CMe-kOzu.js";import{a as vn}from"../chunks/CMHs0aaK.js";import{P as wt,g as Sr}from"../chunks/CT0txMk3.js";import"../chunks/1N5xdIk4.js";import{P as _n}from"../chunks/DTMBj-cl.js";import{e as Ar}from"../chunks/CHHpUjtn.js";import{S as En,T as Ie,a as Be,R as $n,b as Tn,P as Rn}from"../chunks/Dun4dXSd.js";import{a as Sn,D as An}from"../chunks/SBxhNKQ0.js";import{g as Dn}from"../chunks/CrrjleLN.js";var Wt={},Un=Object.create,Nr=Object.defineProperty,xn=Object.getOwnPropertyDescriptor,jn=Object.getOwnPropertyNames,kn=Object.getPrototypeOf,On=Object.prototype.hasOwnProperty,cr=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')}),se=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Pn=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of jn(t))!On.call(e,a)&&a!==r&&Nr(e,a,{get:()=>t[a],enumerable:!(n=xn(t,a))||n.enumerable});return e},hr=(e,t,r)=>(r=e!=null?Un(kn(e)):{},Pn(!e||!e.__esModule?Nr(r,"default",{value:e,enumerable:!0}):r,e)),dr=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},f=(e,t,r)=>(dr(e,t,"read from private field"),r?r.call(e):t.get(e)),O=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},oe=(e,t,r,n)=>(dr(e,t,"write to private field"),t.set(e,r),r),ye=(e,t,r)=>(dr(e,t,"access private method"),r),kt=se(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getUint64=e.getInt64=e.setInt64=e.setUint64=e.UINT32_MAX=void 0,e.UINT32_MAX=4294967295;function t(i,s,o){let h=o/4294967296,u=o;i.setUint32(s,h),i.setUint32(s+4,u)}e.setUint64=t;function r(i,s,o){let h=Math.floor(o/4294967296),u=o;i.setUint32(s,h),i.setUint32(s+4,u)}e.setInt64=r;function n(i,s){let o=i.getInt32(s),h=i.getUint32(s+4);return o*4294967296+h}e.getInt64=n;function a(i,s){let o=i.getUint32(s),h=i.getUint32(s+4);return o*4294967296+h}e.getUint64=a}),fr=se(e=>{var t,r,n;Object.defineProperty(e,"__esModule",{value:!0}),e.utf8DecodeTD=e.TEXT_DECODER_THRESHOLD=e.utf8DecodeJs=e.utf8EncodeTE=e.TEXT_ENCODER_THRESHOLD=e.utf8EncodeJs=e.utf8Count=void 0;var a=kt(),i=(typeof process>"u"||((t=process==null?void 0:Wt)===null||t===void 0?void 0:t.TEXT_ENCODING)!=="never")&&typeof TextEncoder<"u"&&typeof TextDecoder<"u";function s(l){let c=l.length,g=0,d=0;for(;d<c;){let E=l.charCodeAt(d++);if(E&4294967168)if(!(E&4294965248))g+=2;else{if(E>=55296&&E<=56319&&d<c){let $=l.charCodeAt(d);($&64512)===56320&&(++d,E=((E&1023)<<10)+($&1023)+65536)}E&4294901760?g+=4:g+=3}else{g++;continue}}return g}e.utf8Count=s;function o(l,c,g){let d=l.length,E=g,$=0;for(;$<d;){let k=l.charCodeAt($++);if(k&4294967168)if(!(k&4294965248))c[E++]=k>>6&31|192;else{if(k>=55296&&k<=56319&&$<d){let U=l.charCodeAt($);(U&64512)===56320&&(++$,k=((k&1023)<<10)+(U&1023)+65536)}k&4294901760?(c[E++]=k>>18&7|240,c[E++]=k>>12&63|128,c[E++]=k>>6&63|128):(c[E++]=k>>12&15|224,c[E++]=k>>6&63|128)}else{c[E++]=k;continue}c[E++]=k&63|128}}e.utf8EncodeJs=o;var h=i?new TextEncoder:void 0;e.TEXT_ENCODER_THRESHOLD=i?typeof process<"u"&&((r=process==null?void 0:Wt)===null||r===void 0?void 0:r.TEXT_ENCODING)!=="force"?200:0:a.UINT32_MAX;function u(l,c,g){c.set(h.encode(l),g)}function m(l,c,g){h.encodeInto(l,c.subarray(g))}e.utf8EncodeTE=h!=null&&h.encodeInto?m:u;var b=4096;function _(l,c,g){let d=c,E=d+g,$=[],k="";for(;d<E;){let U=l[d++];if(!(U&128))$.push(U);else if((U&224)===192){let ie=l[d++]&63;$.push((U&31)<<6|ie)}else if((U&240)===224){let ie=l[d++]&63,Z=l[d++]&63;$.push((U&31)<<12|ie<<6|Z)}else if((U&248)===240){let ie=l[d++]&63,Z=l[d++]&63,Re=l[d++]&63,x=(U&7)<<18|ie<<12|Z<<6|Re;x>65535&&(x-=65536,$.push(x>>>10&1023|55296),x=56320|x&1023),$.push(x)}else $.push(U);$.length>=b&&(k+=String.fromCharCode(...$),$.length=0)}return $.length>0&&(k+=String.fromCharCode(...$)),k}e.utf8DecodeJs=_;var R=i?new TextDecoder:null;e.TEXT_DECODER_THRESHOLD=i?typeof process<"u"&&((n=process==null?void 0:Wt)===null||n===void 0?void 0:n.TEXT_DECODER)!=="force"?200:0:a.UINT32_MAX;function v(l,c,g){let d=l.subarray(c,c+g);return R.decode(d)}e.utf8DecodeTD=v}),Wr=se(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ExtData=void 0;var t=class{constructor(r,n){this.type=r,this.data=n}};e.ExtData=t}),pr=se(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DecodeError=void 0;var t=class extends Error{constructor(r){super(r);let n=Object.create(t.prototype);Object.setPrototypeOf(this,n),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:t.name})}};e.DecodeError=t}),Fr=se(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.timestampExtension=e.decodeTimestampExtension=e.decodeTimestampToTimeSpec=e.encodeTimestampExtension=e.encodeDateToTimeSpec=e.encodeTimeSpecToTimestamp=e.EXT_TIMESTAMP=void 0;var t=pr(),r=kt();e.EXT_TIMESTAMP=-1;var n=4294967296-1,a=17179869184-1;function i({sec:m,nsec:b}){if(m>=0&&b>=0&&m<=a)if(b===0&&m<=n){let _=new Uint8Array(4);return new DataView(_.buffer).setUint32(0,m),_}else{let _=m/4294967296,R=m&4294967295,v=new Uint8Array(8),l=new DataView(v.buffer);return l.setUint32(0,b<<2|_&3),l.setUint32(4,R),v}else{let _=new Uint8Array(12),R=new DataView(_.buffer);return R.setUint32(0,b),(0,r.setInt64)(R,4,m),_}}e.encodeTimeSpecToTimestamp=i;function s(m){let b=m.getTime(),_=Math.floor(b/1e3),R=(b-_*1e3)*1e6,v=Math.floor(R/1e9);return{sec:_+v,nsec:R-v*1e9}}e.encodeDateToTimeSpec=s;function o(m){if(m instanceof Date){let b=s(m);return i(b)}else return null}e.encodeTimestampExtension=o;function h(m){let b=new DataView(m.buffer,m.byteOffset,m.byteLength);switch(m.byteLength){case 4:return{sec:b.getUint32(0),nsec:0};case 8:{let _=b.getUint32(0),R=b.getUint32(4),v=(_&3)*4294967296+R,l=_>>>2;return{sec:v,nsec:l}}case 12:{let _=(0,r.getInt64)(b,4),R=b.getUint32(0);return{sec:_,nsec:R}}default:throw new t.DecodeError(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${m.length}`)}}e.decodeTimestampToTimeSpec=h;function u(m){let b=h(m);return new Date(b.sec*1e3+b.nsec/1e6)}e.decodeTimestampExtension=u,e.timestampExtension={type:e.EXT_TIMESTAMP,encode:o,decode:u}}),mr=se(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ExtensionCodec=void 0;var t=Wr(),r=Fr(),n=class{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(r.timestampExtension)}register({type:a,encode:i,decode:s}){if(a>=0)this.encoders[a]=i,this.decoders[a]=s;else{let o=1+a;this.builtInEncoders[o]=i,this.builtInDecoders[o]=s}}tryToEncode(a,i){for(let s=0;s<this.builtInEncoders.length;s++){let o=this.builtInEncoders[s];if(o!=null){let h=o(a,i);if(h!=null){let u=-1-s;return new t.ExtData(u,h)}}}for(let s=0;s<this.encoders.length;s++){let o=this.encoders[s];if(o!=null){let h=o(a,i);if(h!=null){let u=s;return new t.ExtData(u,h)}}}return a instanceof t.ExtData?a:null}decode(a,i,s){let o=i<0?this.builtInDecoders[-1-i]:this.decoders[i];return o?o(a,i,s):new t.ExtData(i,a)}};e.ExtensionCodec=n,n.defaultCodec=new n}),Vr=se(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createDataView=e.ensureUint8Array=void 0;function t(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n instanceof ArrayBuffer?new Uint8Array(n):Uint8Array.from(n)}e.ensureUint8Array=t;function r(n){if(n instanceof ArrayBuffer)return new DataView(n);let a=t(n);return new DataView(a.buffer,a.byteOffset,a.byteLength)}e.createDataView=r}),qr=se(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Encoder=e.DEFAULT_INITIAL_BUFFER_SIZE=e.DEFAULT_MAX_DEPTH=void 0;var t=fr(),r=mr(),n=kt(),a=Vr();e.DEFAULT_MAX_DEPTH=100,e.DEFAULT_INITIAL_BUFFER_SIZE=2048;var i=class{constructor(s=r.ExtensionCodec.defaultCodec,o=void 0,h=e.DEFAULT_MAX_DEPTH,u=e.DEFAULT_INITIAL_BUFFER_SIZE,m=!1,b=!1,_=!1,R=!1){this.extensionCodec=s,this.context=o,this.maxDepth=h,this.initialBufferSize=u,this.sortKeys=m,this.forceFloat32=b,this.ignoreUndefined=_,this.forceIntegerToFloat=R,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}reinitializeState(){this.pos=0}encodeSharedRef(s){return this.reinitializeState(),this.doEncode(s,1),this.bytes.subarray(0,this.pos)}encode(s){return this.reinitializeState(),this.doEncode(s,1),this.bytes.slice(0,this.pos)}doEncode(s,o){if(o>this.maxDepth)throw new Error(`Too deep objects in depth ${o}`);s==null?this.encodeNil():typeof s=="boolean"?this.encodeBoolean(s):typeof s=="number"?this.encodeNumber(s):typeof s=="string"?this.encodeString(s):this.encodeObject(s,o)}ensureBufferSizeToWrite(s){let o=this.pos+s;this.view.byteLength<o&&this.resizeBuffer(o*2)}resizeBuffer(s){let o=new ArrayBuffer(s),h=new Uint8Array(o),u=new DataView(o);h.set(this.bytes),this.view=u,this.bytes=h}encodeNil(){this.writeU8(192)}encodeBoolean(s){s===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(s){Number.isSafeInteger(s)&&!this.forceIntegerToFloat?s>=0?s<128?this.writeU8(s):s<256?(this.writeU8(204),this.writeU8(s)):s<65536?(this.writeU8(205),this.writeU16(s)):s<4294967296?(this.writeU8(206),this.writeU32(s)):(this.writeU8(207),this.writeU64(s)):s>=-32?this.writeU8(224|s+32):s>=-128?(this.writeU8(208),this.writeI8(s)):s>=-32768?(this.writeU8(209),this.writeI16(s)):s>=-2147483648?(this.writeU8(210),this.writeI32(s)):(this.writeU8(211),this.writeI64(s)):this.forceFloat32?(this.writeU8(202),this.writeF32(s)):(this.writeU8(203),this.writeF64(s))}writeStringHeader(s){if(s<32)this.writeU8(160+s);else if(s<256)this.writeU8(217),this.writeU8(s);else if(s<65536)this.writeU8(218),this.writeU16(s);else if(s<4294967296)this.writeU8(219),this.writeU32(s);else throw new Error(`Too long string: ${s} bytes in UTF-8`)}encodeString(s){if(s.length>t.TEXT_ENCODER_THRESHOLD){let o=(0,t.utf8Count)(s);this.ensureBufferSizeToWrite(5+o),this.writeStringHeader(o),(0,t.utf8EncodeTE)(s,this.bytes,this.pos),this.pos+=o}else{let o=(0,t.utf8Count)(s);this.ensureBufferSizeToWrite(5+o),this.writeStringHeader(o),(0,t.utf8EncodeJs)(s,this.bytes,this.pos),this.pos+=o}}encodeObject(s,o){let h=this.extensionCodec.tryToEncode(s,this.context);if(h!=null)this.encodeExtension(h);else if(Array.isArray(s))this.encodeArray(s,o);else if(ArrayBuffer.isView(s))this.encodeBinary(s);else if(typeof s=="object")this.encodeMap(s,o);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(s)}`)}encodeBinary(s){let o=s.byteLength;if(o<256)this.writeU8(196),this.writeU8(o);else if(o<65536)this.writeU8(197),this.writeU16(o);else if(o<4294967296)this.writeU8(198),this.writeU32(o);else throw new Error(`Too large binary: ${o}`);let h=(0,a.ensureUint8Array)(s);this.writeU8a(h)}encodeArray(s,o){let h=s.length;if(h<16)this.writeU8(144+h);else if(h<65536)this.writeU8(220),this.writeU16(h);else if(h<4294967296)this.writeU8(221),this.writeU32(h);else throw new Error(`Too large array: ${h}`);for(let u of s)this.doEncode(u,o+1)}countWithoutUndefined(s,o){let h=0;for(let u of o)s[u]!==void 0&&h++;return h}encodeMap(s,o){let h=Object.keys(s);this.sortKeys&&h.sort();let u=this.ignoreUndefined?this.countWithoutUndefined(s,h):h.length;if(u<16)this.writeU8(128+u);else if(u<65536)this.writeU8(222),this.writeU16(u);else if(u<4294967296)this.writeU8(223),this.writeU32(u);else throw new Error(`Too large map object: ${u}`);for(let m of h){let b=s[m];this.ignoreUndefined&&b===void 0||(this.encodeString(m),this.doEncode(b,o+1))}}encodeExtension(s){let o=s.data.length;if(o===1)this.writeU8(212);else if(o===2)this.writeU8(213);else if(o===4)this.writeU8(214);else if(o===8)this.writeU8(215);else if(o===16)this.writeU8(216);else if(o<256)this.writeU8(199),this.writeU8(o);else if(o<65536)this.writeU8(200),this.writeU16(o);else if(o<4294967296)this.writeU8(201),this.writeU32(o);else throw new Error(`Too large extension object: ${o}`);this.writeI8(s.type),this.writeU8a(s.data)}writeU8(s){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,s),this.pos++}writeU8a(s){let o=s.length;this.ensureBufferSizeToWrite(o),this.bytes.set(s,this.pos),this.pos+=o}writeI8(s){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,s),this.pos++}writeU16(s){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,s),this.pos+=2}writeI16(s){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,s),this.pos+=2}writeU32(s){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,s),this.pos+=4}writeI32(s){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,s),this.pos+=4}writeF32(s){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,s),this.pos+=4}writeF64(s){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,s),this.pos+=8}writeU64(s){this.ensureBufferSizeToWrite(8),(0,n.setUint64)(this.view,this.pos,s),this.pos+=8}writeI64(s){this.ensureBufferSizeToWrite(8),(0,n.setInt64)(this.view,this.pos,s),this.pos+=8}};e.Encoder=i}),In=se(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.encode=void 0;var t=qr(),r={};function n(a,i=r){return new t.Encoder(i.extensionCodec,i.context,i.maxDepth,i.initialBufferSize,i.sortKeys,i.forceFloat32,i.ignoreUndefined,i.forceIntegerToFloat).encodeSharedRef(a)}e.encode=n}),Bn=se(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.prettyByte=void 0;function t(r){return`${r<0?"-":""}0x${Math.abs(r).toString(16).padStart(2,"0")}`}e.prettyByte=t}),Mn=se(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CachedKeyDecoder=void 0;var t=fr(),r=16,n=16,a=class{constructor(i=r,s=n){this.maxKeyLength=i,this.maxLengthPerKey=s,this.hit=0,this.miss=0,this.caches=[];for(let o=0;o<this.maxKeyLength;o++)this.caches.push([])}canBeCached(i){return i>0&&i<=this.maxKeyLength}find(i,s,o){let h=this.caches[o-1];e:for(let u of h){let m=u.bytes;for(let b=0;b<o;b++)if(m[b]!==i[s+b])continue e;return u.str}return null}store(i,s){let o=this.caches[i.length-1],h={bytes:i,str:s};o.length>=this.maxLengthPerKey?o[Math.random()*o.length|0]=h:o.push(h)}decode(i,s,o){let h=this.find(i,s,o);if(h!=null)return this.hit++,h;this.miss++;let u=(0,t.utf8DecodeJs)(i,s,o),m=Uint8Array.prototype.slice.call(i,s,s+o);return this.store(m,u),u}};e.CachedKeyDecoder=a}),yr=se(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Decoder=e.DataViewIndexOutOfBoundsError=void 0;var t=Bn(),r=mr(),n=kt(),a=fr(),i=Vr(),s=Mn(),o=pr(),h=l=>{let c=typeof l;return c==="string"||c==="number"},u=-1,m=new DataView(new ArrayBuffer(0)),b=new Uint8Array(m.buffer);e.DataViewIndexOutOfBoundsError=(()=>{try{m.getInt8(0)}catch(l){return l.constructor}throw new Error("never reached")})();var _=new e.DataViewIndexOutOfBoundsError("Insufficient data"),R=new s.CachedKeyDecoder,v=class{constructor(l=r.ExtensionCodec.defaultCodec,c=void 0,g=n.UINT32_MAX,d=n.UINT32_MAX,E=n.UINT32_MAX,$=n.UINT32_MAX,k=n.UINT32_MAX,U=R){this.extensionCodec=l,this.context=c,this.maxStrLength=g,this.maxBinLength=d,this.maxArrayLength=E,this.maxMapLength=$,this.maxExtLength=k,this.keyDecoder=U,this.totalPos=0,this.pos=0,this.view=m,this.bytes=b,this.headByte=u,this.stack=[]}reinitializeState(){this.totalPos=0,this.headByte=u,this.stack.length=0}setBuffer(l){this.bytes=(0,i.ensureUint8Array)(l),this.view=(0,i.createDataView)(this.bytes),this.pos=0}appendBuffer(l){if(this.headByte===u&&!this.hasRemaining(1))this.setBuffer(l);else{let c=this.bytes.subarray(this.pos),g=(0,i.ensureUint8Array)(l),d=new Uint8Array(c.length+g.length);d.set(c),d.set(g,c.length),this.setBuffer(d)}}hasRemaining(l){return this.view.byteLength-this.pos>=l}createExtraByteError(l){let{view:c,pos:g}=this;return new RangeError(`Extra ${c.byteLength-g} of ${c.byteLength} byte(s) found at buffer[${l}]`)}decode(l){this.reinitializeState(),this.setBuffer(l);let c=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return c}*decodeMulti(l){for(this.reinitializeState(),this.setBuffer(l);this.hasRemaining(1);)yield this.doDecodeSync()}async decodeAsync(l){let c=!1,g;for await(let k of l){if(c)throw this.createExtraByteError(this.totalPos);this.appendBuffer(k);try{g=this.doDecodeSync(),c=!0}catch(U){if(!(U instanceof e.DataViewIndexOutOfBoundsError))throw U}this.totalPos+=this.pos}if(c){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return g}let{headByte:d,pos:E,totalPos:$}=this;throw new RangeError(`Insufficient data in parsing ${(0,t.prettyByte)(d)} at ${$} (${E} in the current buffer)`)}decodeArrayStream(l){return this.decodeMultiAsync(l,!0)}decodeStream(l){return this.decodeMultiAsync(l,!1)}async*decodeMultiAsync(l,c){let g=c,d=-1;for await(let E of l){if(c&&d===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(E),g&&(d=this.readArraySize(),g=!1,this.complete());try{for(;yield this.doDecodeSync(),--d!==0;);}catch($){if(!($ instanceof e.DataViewIndexOutOfBoundsError))throw $}this.totalPos+=this.pos}}doDecodeSync(){e:for(;;){let l=this.readHeadByte(),c;if(l>=224)c=l-256;else if(l<192)if(l<128)c=l;else if(l<144){let d=l-128;if(d!==0){this.pushMapState(d),this.complete();continue e}else c={}}else if(l<160){let d=l-144;if(d!==0){this.pushArrayState(d),this.complete();continue e}else c=[]}else{let d=l-160;c=this.decodeUtf8String(d,0)}else if(l===192)c=null;else if(l===194)c=!1;else if(l===195)c=!0;else if(l===202)c=this.readF32();else if(l===203)c=this.readF64();else if(l===204)c=this.readU8();else if(l===205)c=this.readU16();else if(l===206)c=this.readU32();else if(l===207)c=this.readU64();else if(l===208)c=this.readI8();else if(l===209)c=this.readI16();else if(l===210)c=this.readI32();else if(l===211)c=this.readI64();else if(l===217){let d=this.lookU8();c=this.decodeUtf8String(d,1)}else if(l===218){let d=this.lookU16();c=this.decodeUtf8String(d,2)}else if(l===219){let d=this.lookU32();c=this.decodeUtf8String(d,4)}else if(l===220){let d=this.readU16();if(d!==0){this.pushArrayState(d),this.complete();continue e}else c=[]}else if(l===221){let d=this.readU32();if(d!==0){this.pushArrayState(d),this.complete();continue e}else c=[]}else if(l===222){let d=this.readU16();if(d!==0){this.pushMapState(d),this.complete();continue e}else c={}}else if(l===223){let d=this.readU32();if(d!==0){this.pushMapState(d),this.complete();continue e}else c={}}else if(l===196){let d=this.lookU8();c=this.decodeBinary(d,1)}else if(l===197){let d=this.lookU16();c=this.decodeBinary(d,2)}else if(l===198){let d=this.lookU32();c=this.decodeBinary(d,4)}else if(l===212)c=this.decodeExtension(1,0);else if(l===213)c=this.decodeExtension(2,0);else if(l===214)c=this.decodeExtension(4,0);else if(l===215)c=this.decodeExtension(8,0);else if(l===216)c=this.decodeExtension(16,0);else if(l===199){let d=this.lookU8();c=this.decodeExtension(d,1)}else if(l===200){let d=this.lookU16();c=this.decodeExtension(d,2)}else if(l===201){let d=this.lookU32();c=this.decodeExtension(d,4)}else throw new o.DecodeError(`Unrecognized type byte: ${(0,t.prettyByte)(l)}`);this.complete();let g=this.stack;for(;g.length>0;){let d=g[g.length-1];if(d.type===0)if(d.array[d.position]=c,d.position++,d.position===d.size)g.pop(),c=d.array;else continue e;else if(d.type===1){if(!h(c))throw new o.DecodeError("The type of key must be string or number but "+typeof c);if(c==="__proto__")throw new o.DecodeError("The key __proto__ is not allowed");d.key=c,d.type=2;continue e}else if(d.map[d.key]=c,d.readCount++,d.readCount===d.size)g.pop(),c=d.map;else{d.key=null,d.type=1;continue e}}return c}}readHeadByte(){return this.headByte===u&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=u}readArraySize(){let l=this.readHeadByte();switch(l){case 220:return this.readU16();case 221:return this.readU32();default:{if(l<160)return l-144;throw new o.DecodeError(`Unrecognized array type byte: ${(0,t.prettyByte)(l)}`)}}}pushMapState(l){if(l>this.maxMapLength)throw new o.DecodeError(`Max length exceeded: map length (${l}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.push({type:1,size:l,key:null,readCount:0,map:{}})}pushArrayState(l){if(l>this.maxArrayLength)throw new o.DecodeError(`Max length exceeded: array length (${l}) > maxArrayLength (${this.maxArrayLength})`);this.stack.push({type:0,size:l,array:new Array(l),position:0})}decodeUtf8String(l,c){var g;if(l>this.maxStrLength)throw new o.DecodeError(`Max length exceeded: UTF-8 byte length (${l}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+c+l)throw _;let d=this.pos+c,E;return this.stateIsMapKey()&&!((g=this.keyDecoder)===null||g===void 0)&&g.canBeCached(l)?E=this.keyDecoder.decode(this.bytes,d,l):l>a.TEXT_DECODER_THRESHOLD?E=(0,a.utf8DecodeTD)(this.bytes,d,l):E=(0,a.utf8DecodeJs)(this.bytes,d,l),this.pos+=c+l,E}stateIsMapKey(){return this.stack.length>0?this.stack[this.stack.length-1].type===1:!1}decodeBinary(l,c){if(l>this.maxBinLength)throw new o.DecodeError(`Max length exceeded: bin length (${l}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(l+c))throw _;let g=this.pos+c,d=this.bytes.subarray(g,g+l);return this.pos+=c+l,d}decodeExtension(l,c){if(l>this.maxExtLength)throw new o.DecodeError(`Max length exceeded: ext length (${l}) > maxExtLength (${this.maxExtLength})`);let g=this.view.getInt8(this.pos+c),d=this.decodeBinary(l,c+1);return this.extensionCodec.decode(d,g,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){let l=this.view.getUint8(this.pos);return this.pos++,l}readI8(){let l=this.view.getInt8(this.pos);return this.pos++,l}readU16(){let l=this.view.getUint16(this.pos);return this.pos+=2,l}readI16(){let l=this.view.getInt16(this.pos);return this.pos+=2,l}readU32(){let l=this.view.getUint32(this.pos);return this.pos+=4,l}readI32(){let l=this.view.getInt32(this.pos);return this.pos+=4,l}readU64(){let l=(0,n.getUint64)(this.view,this.pos);return this.pos+=8,l}readI64(){let l=(0,n.getInt64)(this.view,this.pos);return this.pos+=8,l}readF32(){let l=this.view.getFloat32(this.pos);return this.pos+=4,l}readF64(){let l=this.view.getFloat64(this.pos);return this.pos+=8,l}};e.Decoder=v}),zr=se(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.decodeMulti=e.decode=e.defaultDecodeOptions=void 0;var t=yr();e.defaultDecodeOptions={};function r(a,i=e.defaultDecodeOptions){return new t.Decoder(i.extensionCodec,i.context,i.maxStrLength,i.maxBinLength,i.maxArrayLength,i.maxMapLength,i.maxExtLength).decode(a)}e.decode=r;function n(a,i=e.defaultDecodeOptions){return new t.Decoder(i.extensionCodec,i.context,i.maxStrLength,i.maxBinLength,i.maxArrayLength,i.maxMapLength,i.maxExtLength).decodeMulti(a)}e.decodeMulti=n}),Cn=se(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ensureAsyncIterable=e.asyncIterableFromStream=e.isAsyncIterable=void 0;function t(i){return i[Symbol.asyncIterator]!=null}e.isAsyncIterable=t;function r(i){if(i==null)throw new Error("Assertion Failure: value must not be null nor undefined")}async function*n(i){let s=i.getReader();try{for(;;){let{done:o,value:h}=await s.read();if(o)return;r(h),yield h}}finally{s.releaseLock()}}e.asyncIterableFromStream=n;function a(i){return t(i)?i:n(i)}e.ensureAsyncIterable=a}),Ln=se(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.decodeStream=e.decodeMultiStream=e.decodeArrayStream=e.decodeAsync=void 0;var t=yr(),r=Cn(),n=zr();async function a(h,u=n.defaultDecodeOptions){let m=(0,r.ensureAsyncIterable)(h);return new t.Decoder(u.extensionCodec,u.context,u.maxStrLength,u.maxBinLength,u.maxArrayLength,u.maxMapLength,u.maxExtLength).decodeAsync(m)}e.decodeAsync=a;function i(h,u=n.defaultDecodeOptions){let m=(0,r.ensureAsyncIterable)(h);return new t.Decoder(u.extensionCodec,u.context,u.maxStrLength,u.maxBinLength,u.maxArrayLength,u.maxMapLength,u.maxExtLength).decodeArrayStream(m)}e.decodeArrayStream=i;function s(h,u=n.defaultDecodeOptions){let m=(0,r.ensureAsyncIterable)(h);return new t.Decoder(u.extensionCodec,u.context,u.maxStrLength,u.maxBinLength,u.maxArrayLength,u.maxMapLength,u.maxExtLength).decodeStream(m)}e.decodeMultiStream=s;function o(h,u=n.defaultDecodeOptions){return s(h,u)}e.decodeStream=o}),gr=se(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.decodeTimestampExtension=e.encodeTimestampExtension=e.decodeTimestampToTimeSpec=e.encodeTimeSpecToTimestamp=e.encodeDateToTimeSpec=e.EXT_TIMESTAMP=e.ExtData=e.ExtensionCodec=e.Encoder=e.DataViewIndexOutOfBoundsError=e.DecodeError=e.Decoder=e.decodeStream=e.decodeMultiStream=e.decodeArrayStream=e.decodeAsync=e.decodeMulti=e.decode=e.encode=void 0;var t=In();Object.defineProperty(e,"encode",{enumerable:!0,get:function(){return t.encode}});var r=zr();Object.defineProperty(e,"decode",{enumerable:!0,get:function(){return r.decode}}),Object.defineProperty(e,"decodeMulti",{enumerable:!0,get:function(){return r.decodeMulti}});var n=Ln();Object.defineProperty(e,"decodeAsync",{enumerable:!0,get:function(){return n.decodeAsync}}),Object.defineProperty(e,"decodeArrayStream",{enumerable:!0,get:function(){return n.decodeArrayStream}}),Object.defineProperty(e,"decodeMultiStream",{enumerable:!0,get:function(){return n.decodeMultiStream}}),Object.defineProperty(e,"decodeStream",{enumerable:!0,get:function(){return n.decodeStream}});var a=yr();Object.defineProperty(e,"Decoder",{enumerable:!0,get:function(){return a.Decoder}}),Object.defineProperty(e,"DataViewIndexOutOfBoundsError",{enumerable:!0,get:function(){return a.DataViewIndexOutOfBoundsError}});var i=pr();Object.defineProperty(e,"DecodeError",{enumerable:!0,get:function(){return i.DecodeError}});var s=qr();Object.defineProperty(e,"Encoder",{enumerable:!0,get:function(){return s.Encoder}});var o=mr();Object.defineProperty(e,"ExtensionCodec",{enumerable:!0,get:function(){return o.ExtensionCodec}});var h=Wr();Object.defineProperty(e,"ExtData",{enumerable:!0,get:function(){return h.ExtData}});var u=Fr();Object.defineProperty(e,"EXT_TIMESTAMP",{enumerable:!0,get:function(){return u.EXT_TIMESTAMP}}),Object.defineProperty(e,"encodeDateToTimeSpec",{enumerable:!0,get:function(){return u.encodeDateToTimeSpec}}),Object.defineProperty(e,"encodeTimeSpecToTimestamp",{enumerable:!0,get:function(){return u.encodeTimeSpecToTimestamp}}),Object.defineProperty(e,"decodeTimestampToTimeSpec",{enumerable:!0,get:function(){return u.decodeTimestampToTimeSpec}}),Object.defineProperty(e,"encodeTimestampExtension",{enumerable:!0,get:function(){return u.encodeTimestampExtension}}),Object.defineProperty(e,"decodeTimestampExtension",{enumerable:!0,get:function(){return u.decodeTimestampExtension}})}),at=class extends Error{constructor(e){super(e),this.name=this.constructor.name,Object.setPrototypeOf(this,new.target.prototype)}},He=class extends at{},_e=class extends at{},Ut=class extends at{},Te=typeof process<"u"&&process.release&&process.release.name==="node";if(!globalThis.document){if(!globalThis.importScripts){if(!Te)throw new at("Cannot determine runtime environment")}}var p={};function Nn(e){Object.keys(e).forEach(t=>p._free(e[t]))}var Ee={null:0,symbol:1,pairlist:2,closure:3,environment:4,promise:5,call:6,special:7,builtin:8,string:9,logical:10,integer:13,double:14,complex:15,character:16,dots:17,any:18,list:19,expression:20,bytecode:21,pointer:22,weakref:23,raw:24,s4:25,new:30,free:31,function:99};function Hr(e){return!!e&&typeof e=="object"&&Object.keys(Ee).includes(e.type)}function Ot(e){return!!e&&typeof e=="object"&&"re"in e&&"im"in e}function vt(e){return p._Rf_protect(ke(e)),e}function J(e,t){return p._Rf_protect(ke(e)),++t.n,e}function Wn(e){let t=p._malloc(4);return p._R_ProtectWithIndex(ke(e),t),{loc:p.getValue(t,"i32"),ptr:t}}function Fn(e){p._Rf_unprotect(1),p._free(e.ptr)}function Vn(e,t){return p._R_Reprotect(ke(e),t.loc),e}function Q(e){p._Rf_unprotect(e)}function Dr(e,t,r){p._Rf_defineVar(ke(t),ke(r),ke(e))}function Ur(e,t){let r={},n={n:0};try{let a=new Gr(t);J(a,n),r.code=p.allocateUTF8(e);let i=p._R_ParseEvalString(r.code,a.ptr);return M.wrap(i)}finally{Nn(r),Q(n.n)}}function Pt(e,t){return p.getWasmTableEntry(p.GOT.ffi_safe_eval.value)(ke(e),ke(t))}var qn=new WeakMap;function zn(e,t){return qn.set(e,t),e}var Hn=63;function Jr(){let e=Array.from({length:4},Jn).join("-");if(e.length!==Hn)throw new Error("comlink internal error: UUID has the wrong length");return e}function Jn(){let e=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16),t=15-e.length;return t>0&&(e=Array.from({length:t},()=>0).join("")+e),e}function ke(e){return xt(e)?e.ptr:e}function Ke(e,t){if(p._TYPEOF(e.ptr)!==Ee[t])throw new Error(`Unexpected object type "${e.type()}" when expecting type "${t}"`)}function Xr(e){if(Hr(e))return new(sn(e.type))(e);if(e&&typeof e=="object"&&"type"in e&&e.type==="null")return new Kr;if(e===null)return new it({type:"logical",names:null,values:[null]});if(typeof e=="boolean")return new it(e);if(typeof e=="number")return new Bt(e);if(typeof e=="string")return new Ce(e);if(Ot(e))return new br(e);if(ArrayBuffer.isView(e)||e instanceof ArrayBuffer)return new vr(e);if(Array.isArray(e))return Xn(e);if(typeof e=="object")return yt.fromObject(e);throw new Error("Robj construction for this JS object is not yet supported")}function Xn(e){let t={n:0};if(e.every(r=>r&&typeof r=="object"&&!xt(r)&&!Ot(r))){let r=e,n=r.every(i=>Object.keys(i).filter(s=>!Object.keys(r[0]).includes(s)).length===0&&Object.keys(r[0]).filter(s=>!Object.keys(i).includes(s)).length===0),a=r.every(i=>Object.values(i).every(s=>on(s)||an(s)));if(n&&a)return yt.fromD3(r)}if(e.every(r=>typeof r=="boolean"||r===null))return new it(e);if(e.every(r=>typeof r=="number"||r===null))return new Bt(e);if(e.every(r=>typeof r=="string"||r===null))return new Ce(e);try{let r=new Je([new $e("c"),...e]);return J(r,t),r.eval()}finally{Q(t.n)}}var Y=class{constructor(e){this.ptr=e}type(){let e=p._TYPEOF(this.ptr);return Object.keys(Ee).find(t=>Ee[t]===e)}},ct,_t,nt=class extends Y{constructor(e){if(!(e instanceof Y))return Xr(e);super(e.ptr),O(this,ct)}static wrap(e){let t=p._TYPEOF(e),r=Object.keys(Ee)[Object.values(Ee).indexOf(t)];return new(sn(r))(new Y(e))}get[Symbol.toStringTag](){return`RObject:${this.type()}`}static getPersistentObject(e){return ne[e]}getPropertyValue(e){return this[e]}inspect(){Ur(".Internal(inspect(x))",{x:this})}isNull(){return p._TYPEOF(this.ptr)===Ee.null}isNa(){try{let e=Ur("is.na(x)",{x:this});return vt(e),e.toBoolean()}finally{Q(1)}}isUnbound(){return this.ptr===ne.unboundValue.ptr}attrs(){return It.wrap(p._ATTRIB(this.ptr))}class(){let e={n:0},t=new Je([new $e("class"),this]);J(t,e);try{return t.eval()}finally{Q(e.n)}}setNames(e){let t;if(e===null)t=ne.null;else if(Array.isArray(e)&&e.every(r=>typeof r=="string"||r===null))t=new Ce(e);else throw new Error("Argument to setNames must be null or an Array of strings or null");return p._Rf_setAttrib(this.ptr,ne.namesSymbol.ptr,t.ptr),this}names(){let e=Ce.wrap(p._Rf_getAttrib(this.ptr,ne.namesSymbol.ptr));return e.isNull()?null:e.toArray()}includes(e){let t=this.names();return t&&t.includes(e)}toJs(e={depth:0},t=1){throw new Error("This R object cannot be converted to JS")}subset(e){return ye(this,ct,_t).call(this,e,ne.bracketSymbol.ptr)}get(e){return ye(this,ct,_t).call(this,e,ne.bracket2Symbol.ptr)}getDollar(e){return ye(this,ct,_t).call(this,e,ne.dollarSymbol.ptr)}pluck(...e){let t=Wn(ne.null);try{let r=(a,i)=>{let s=a.get(i);return Vn(s,t)},n=e.reduce(r,this);return n.isNull()?void 0:n}finally{Fn(t)}}set(e,t){let r={n:0};try{let n=new nt(e);J(n,r);let a=new nt(t);J(a,r);let i=new $e("[[<-"),s=p._Rf_lang4(i.ptr,this.ptr,n.ptr,a.ptr);return J(s,r),nt.wrap(Pt(s,ne.baseEnv))}finally{Q(r.n)}}static getMethods(e){let t=new Set,r=e;do Object.getOwnPropertyNames(r).map(n=>t.add(n));while(r=Object.getPrototypeOf(r));return[...t.keys()].filter(n=>typeof e[n]=="function")}},M=nt;ct=new WeakSet,_t=function(e,t){let r={n:0};try{let n=new nt(e);J(n,r);let a=p._Rf_lang3(t,this.ptr,n.ptr);return J(a,r),nt.wrap(Pt(a,ne.baseEnv))}finally{Q(r.n)}};var Kr=class extends M{constructor(){return super(new Y(p.getValue(p._R_NilValue,"*"))),this}toJs(){return{type:"null"}}},$e=class extends M{constructor(e){if(e instanceof Y){Ke(e,"symbol"),super(e);return}let t=p.allocateUTF8(e);try{super(new Y(p._Rf_install(t)))}finally{p._free(t)}}toJs(){let e=this.toObject();return{type:"symbol",printname:e.printname,symvalue:e.symvalue,internal:e.internal}}toObject(){return{printname:this.printname().isUnbound()?null:this.printname().toString(),symvalue:this.symvalue().isUnbound()?null:this.symvalue().ptr,internal:this.internal().isNull()?null:this.internal().ptr}}toString(){return this.printname().toString()}printname(){return wr.wrap(p._PRINTNAME(this.ptr))}symvalue(){return M.wrap(p._SYMVALUE(this.ptr))}internal(){return M.wrap(p._INTERNAL(this.ptr))}},It=class extends M{constructor(e){if(e instanceof Y)return Ke(e,"pairlist"),super(e),this;let t={n:0};try{let{names:r,values:n}=lt(e),a=It.wrap(p._Rf_allocList(n.length));J(a,t);for(let[i,s]=[0,a];!s.isNull();[i,s]=[i+1,s.cdr()])s.setcar(new M(n[i]));a.setNames(r),super(a)}finally{Q(t.n)}}get length(){return this.toArray().length}toArray(e={depth:1}){return this.toJs(e).values}toObject({allowDuplicateKey:e=!0,allowEmptyKey:t=!1,depth:r=-1}={}){let n=this.entries({depth:r}),a=n.map(([i])=>i);if(!e&&new Set(a).size!==a.length)throw new Error("Duplicate key when converting pairlist without allowDuplicateKey enabled");if(!t&&a.some(i=>!i))throw new Error("Empty or null key when converting pairlist without allowEmptyKey enabled");return Object.fromEntries(n.filter((i,s)=>n.findIndex(o=>o[0]===i[0])===s))}entries(e={depth:1}){let t=this.toJs(e);return t.values.map((r,n)=>[t.names?t.names[n]:null,r])}toJs(e={depth:0},t=1){let r=[],n=!1,a=[];for(let i=this;!i.isNull();i=i.cdr()){let s=i.tag();s.isNull()?r.push(""):(n=!0,r.push(s.toString())),e.depth&&t>=e.depth?a.push(i.car()):a.push(i.car().toJs(e,t+1))}return{type:"pairlist",names:n?r:null,values:a}}includes(e){return e in this.toObject()}setcar(e){p._SETCAR(this.ptr,e.ptr)}car(){return M.wrap(p._CAR(this.ptr))}cdr(){return M.wrap(p._CDR(this.ptr))}tag(){return M.wrap(p._TAG(this.ptr))}},Je=class extends M{constructor(e){if(e instanceof Y)return Ke(e,"call"),super(e),this;let t={n:0};try{let{values:r}=lt(e),n=r.map(i=>J(new M(i),t)),a=Je.wrap(p._Rf_allocVector(Ee.call,r.length));J(a,t);for(let[i,s]=[0,a];!s.isNull();[i,s]=[i+1,s.cdr()])s.setcar(n[i]);super(a)}finally{Q(t.n)}}setcar(e){p._SETCAR(this.ptr,e.ptr)}car(){return M.wrap(p._CAR(this.ptr))}cdr(){return M.wrap(p._CDR(this.ptr))}eval(){return p.webr.evalR(this,{env:ne.baseEnv})}capture(e={}){return p.webr.captureR(this,e)}deparse(){let e={n:0};try{let t=p._Rf_lang2(new $e("deparse1").ptr,p._Rf_lang2(new $e("quote").ptr,this.ptr));J(t,e);let r=Ce.wrap(Pt(t,ne.baseEnv));return J(r,e),r.toString()}finally{Q(e.n)}}},Ht=class extends M{constructor(e,t=null){if(e instanceof Y){if(Ke(e,"list"),super(e),t){if(t.length!==this.length)throw new Error("Can't construct named `RList`. Supplied `names` must be the same length as the list.");this.setNames(t)}return this}let r={n:0};try{let n=lt(e),a=p._Rf_allocVector(Ee.list,n.values.length);J(a,r),n.values.forEach((s,o)=>{p._SET_VECTOR_ELT(a,o,new M(s).ptr)});let i=t||n.names;if(i&&i.length!==n.values.length)throw new Error("Can't construct named `RList`. Supplied `names` must be the same length as the list.");M.wrap(a).setNames(i),super(new Y(a))}finally{Q(r.n)}}get length(){return p._LENGTH(this.ptr)}isDataFrame(){let e=It.wrap(p._ATTRIB(this.ptr)).get("class");return!e.isNull()&&e.toArray().includes("data.frame")}toArray(e={depth:1}){return this.toJs(e).values}toObject({allowDuplicateKey:e=!0,allowEmptyKey:t=!1,depth:r=-1}={}){let n=this.entries({depth:r}),a=n.map(([i])=>i);if(!e&&new Set(a).size!==a.length)throw new Error("Duplicate key when converting list without allowDuplicateKey enabled");if(!t&&a.some(i=>!i))throw new Error("Empty or null key when converting list without allowEmptyKey enabled");return Object.fromEntries(n.filter((i,s)=>n.findIndex(o=>o[0]===i[0])===s))}toD3(){if(!this.isDataFrame())throw new Error("Can't convert R list object to D3 format. Object must be of class 'data.frame'.");return this.entries().reduce((e,t)=>(t[1].forEach((r,n)=>e[n]=Object.assign(e[n]||{},{[t[0]]:r})),e),[])}entries(e={depth:-1}){let t=this.toJs(e);return this.isDataFrame()&&e.depth<0&&(t.values=t.values.map(r=>r.toArray())),t.values.map((r,n)=>[t.names?t.names[n]:null,r])}toJs(e={depth:0},t=1){return{type:"list",names:this.names(),values:[...Array(this.length).keys()].map(r=>e.depth&&t>=e.depth?this.get(r+1):this.get(r+1).toJs(e,t+1))}}},yt=class extends Ht{constructor(e){if(e instanceof Y){if(super(e),!this.isDataFrame())throw new Error("Can't construct `RDataFrame`. Supplied R object is not a `data.frame`.");return this}return yt.fromObject(e)}static fromObject(e){let{names:t,values:r}=lt(e),n={n:0};try{let a=!!t&&t.length>0&&t.every(s=>s),i=r.length>0&&r.every(s=>Array.isArray(s)||ArrayBuffer.isView(s)||s instanceof ArrayBuffer);if(a&&i){let s=r,o=s.every(u=>u.length===s[0].length),h=s.every(u=>on(u[0])||an(u[0]));if(o&&h){let u=new Ht({type:"list",names:t,values:s.map(b=>Xr(b))});J(u,n);let m=new Je([new $e("as.data.frame"),u]);return J(m,n),new yt(m.eval())}}}finally{Q(n.n)}throw new Error("Can't construct `data.frame`. Source object is not eligible.")}static fromD3(e){return this.fromObject(Object.fromEntries(Object.keys(e[0]).map(t=>[t,e.map(r=>r[t])])))}},bt=class extends M{exec(...e){let t={n:0};try{let r=new Je([this,...e]);return J(r,t),r.eval()}finally{Q(t.n)}}capture(e={},...t){let r={n:0};try{let n=new Je([this,...t]);return J(n,r),n.capture(e)}finally{Q(r.n)}}},wr=class extends M{constructor(e){if(e instanceof Y){Ke(e,"string"),super(e);return}let t=p.allocateUTF8(e);try{super(new Y(p._Rf_mkChar(t)))}finally{p._free(t)}}toString(){return p.UTF8ToString(p._R_CHAR(this.ptr))}toJs(){return{type:"string",value:this.toString()}}},Gr=class extends M{constructor(e={}){if(e instanceof Y)return Ke(e,"environment"),super(e),this;let t=0;try{let{names:r,values:n}=lt(e),a=vt(p._R_NewEnv(ne.globalEnv.ptr,0,0));++t,n.forEach((i,s)=>{let o=r?r[s]:null;if(!o)throw new Error("Can't create object in new environment with empty symbol name");let h=new $e(o),u=vt(new M(i));try{Dr(a,h,u)}finally{Q(1)}}),super(new Y(a))}finally{Q(t)}}ls(e=!1,t=!0){return Ce.wrap(p._R_lsInternal3(this.ptr,Number(e),Number(t))).toArray()}bind(e,t){let r=new $e(e),n=vt(new M(t));try{Dr(this,r,n)}finally{Q(1)}}names(){return this.ls(!0,!0)}frame(){return M.wrap(p._FRAME(this.ptr))}subset(e){if(typeof e=="number")throw new Error("Object of type environment is not subsettable");return this.getDollar(e)}toObject({depth:e=-1}={}){let t=this.names();return Object.fromEntries([...Array(t.length).keys()].map(r=>{let n=this.getDollar(t[r]);return[t[r],e<0?n:n.toJs({depth:e})]}))}toJs(e={depth:0},t=1){let r=this.names(),n=[...Array(r.length).keys()].map(a=>e.depth&&t>=e.depth?this.getDollar(r[a]):this.getDollar(r[a]).toJs(e,t+1));return{type:"environment",names:r,values:n}}},ot=class extends M{constructor(e,t,r){if(e instanceof Y)return Ke(e,t),super(e),this;let n={n:0};try{let{names:a,values:i}=lt(e),s=p._Rf_allocVector(Ee[t],i.length);J(s,n),i.forEach(r(s)),M.wrap(s).setNames(a),super(new Y(s))}finally{Q(n.n)}}get length(){return p._LENGTH(this.ptr)}get(e){return super.get(e)}subset(e){return super.subset(e)}getDollar(){throw new Error("$ operator is invalid for atomic vectors")}detectMissing(){let e={n:0};try{let t=p._Rf_lang2(new $e("is.na").ptr,this.ptr);J(t,e);let r=it.wrap(Pt(t,ne.baseEnv));J(r,e);let n=r.toTypedArray();return Array.from(n).map(a=>!!a)}finally{Q(e.n)}}toArray(){let e=this.toTypedArray();return this.detectMissing().map((t,r)=>t?null:e[r])}toObject({allowDuplicateKey:e=!0,allowEmptyKey:t=!1}={}){let r=this.entries(),n=r.map(([a])=>a);if(!e&&new Set(n).size!==n.length)throw new Error("Duplicate key when converting atomic vector without allowDuplicateKey enabled");if(!t&&n.some(a=>!a))throw new Error("Empty or null key when converting atomic vector without allowEmptyKey enabled");return Object.fromEntries(r.filter((a,i)=>r.findIndex(s=>s[0]===a[0])===i))}entries(){let e=this.toArray(),t=this.names();return e.map((r,n)=>[t?t[n]:null,r])}toJs(){return{type:this.type(),names:this.names(),values:this.toArray()}}},Jt,Qr=class extends ot{constructor(e){super(e,"logical",f(Qr,Jt))}getBoolean(e){return this.get(e).toArray()[0]}toBoolean(){if(this.length!==1)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");let e=this.getBoolean(1);if(e===null)throw new Error("Can't convert missing value `NA` to a JS boolean");return e}toTypedArray(){return new Int32Array(p.HEAP32.subarray(p._LOGICAL(this.ptr)/4,p._LOGICAL(this.ptr)/4+this.length))}toArray(){let e=this.toTypedArray();return this.detectMissing().map((t,r)=>t?null:!!e[r])}},it=Qr;Jt=new WeakMap,O(it,Jt,e=>{let t=p._LOGICAL(e),r=p.getValue(p._R_NaInt,"i32");return(n,a)=>{p.setValue(t+4*a,n===null?r:!!n,"i32")}});var Xt,Yr=class extends ot{constructor(e){super(e,"integer",f(Yr,Xt))}getNumber(e){return this.get(e).toArray()[0]}toNumber(){if(this.length!==1)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");let e=this.getNumber(1);if(e===null)throw new Error("Can't convert missing value `NA` to a JS number");return e}toTypedArray(){return new Int32Array(p.HEAP32.subarray(p._INTEGER(this.ptr)/4,p._INTEGER(this.ptr)/4+this.length))}},Zr=Yr;Xt=new WeakMap,O(Zr,Xt,e=>{let t=p._INTEGER(e),r=p.getValue(p._R_NaInt,"i32");return(n,a)=>{p.setValue(t+4*a,n===null?r:Math.round(Number(n)),"i32")}});var Kt,en=class extends ot{constructor(e){super(e,"double",f(en,Kt))}getNumber(e){return this.get(e).toArray()[0]}toNumber(){if(this.length!==1)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");let e=this.getNumber(1);if(e===null)throw new Error("Can't convert missing value `NA` to a JS number");return e}toTypedArray(){return new Float64Array(p.HEAPF64.subarray(p._REAL(this.ptr)/8,p._REAL(this.ptr)/8+this.length))}},Bt=en;Kt=new WeakMap,O(Bt,Kt,e=>{let t=p._REAL(e),r=p.getValue(p._R_NaReal,"double");return(n,a)=>{p.setValue(t+8*a,n===null?r:n,"double")}});var Gt,tn=class extends ot{constructor(e){super(e,"complex",f(tn,Gt))}getComplex(e){return this.get(e).toArray()[0]}toComplex(){if(this.length!==1)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");let e=this.getComplex(1);if(e===null)throw new Error("Can't convert missing value `NA` to a JS object");return e}toTypedArray(){return new Float64Array(p.HEAPF64.subarray(p._COMPLEX(this.ptr)/8,p._COMPLEX(this.ptr)/8+2*this.length))}toArray(){let e=this.toTypedArray();return this.detectMissing().map((t,r)=>t?null:{re:e[2*r],im:e[2*r+1]})}},br=tn;Gt=new WeakMap,O(br,Gt,e=>{let t=p._COMPLEX(e),r=p.getValue(p._R_NaReal,"double");return(n,a)=>{p.setValue(t+8*(2*a),n===null?r:n.re,"double"),p.setValue(t+8*(2*a+1),n===null?r:n.im,"double")}});var Qt,rn=class extends ot{constructor(e){super(e,"character",f(rn,Qt))}getString(e){return this.get(e).toArray()[0]}toString(){if(this.length!==1)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");let e=this.getString(1);if(e===null)throw new Error("Can't convert missing value `NA` to a JS string");return e}toTypedArray(){return new Uint32Array(p.HEAPU32.subarray(p._STRING_PTR(this.ptr)/4,p._STRING_PTR(this.ptr)/4+this.length))}toArray(){return this.detectMissing().map((e,t)=>e?null:p.UTF8ToString(p._R_CHAR(p._STRING_ELT(this.ptr,t))))}},Ce=rn;Qt=new WeakMap,O(Ce,Qt,e=>(t,r)=>{t===null?p._SET_STRING_ELT(e,r,ne.naString.ptr):p._SET_STRING_ELT(e,r,new wr(t).ptr)});var Yt,nn=class extends ot{constructor(e){e instanceof ArrayBuffer&&(e=new Uint8Array(e)),super(e,"raw",f(nn,Yt))}getNumber(e){return this.get(e).toArray()[0]}toNumber(){if(this.length!==1)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");let e=this.getNumber(1);if(e===null)throw new Error("Can't convert missing value `NA` to a JS number");return e}toTypedArray(){return new Uint8Array(p.HEAPU8.subarray(p._RAW(this.ptr),p._RAW(this.ptr)+this.length))}},vr=nn;Yt=new WeakMap,O(vr,Yt,e=>{let t=p._RAW(e);return(r,n)=>{p.setValue(t+n,Number(r),"i8")}});function lt(e){return Hr(e)?e:Array.isArray(e)||ArrayBuffer.isView(e)?{names:null,values:e}:e&&typeof e=="object"&&!Ot(e)?{names:Object.keys(e),values:Object.values(e)}:{names:null,values:[e]}}function sn(e){let t={object:M,null:Kr,symbol:$e,pairlist:It,closure:bt,environment:Gr,call:Je,special:bt,builtin:bt,string:wr,logical:it,integer:Zr,double:Bt,complex:br,character:Ce,list:Ht,raw:vr,function:bt,dataframe:yt};return e in t?t[e]:M}function xt(e){return e instanceof M}function an(e){let t=["logical","integer","double","complex","character"];return xt(e)&&t.includes(e.type())||xt(e)&&e.isNa()}function on(e){return e===null||typeof e=="number"||typeof e=="boolean"||typeof e=="string"||Ot(e)}var ne;function Mt(){let e={resolve:()=>{},reject:()=>{},promise:Promise.resolve()},t=new Promise((r,n)=>{e.resolve=r,e.reject=n});return e.promise=t,e}function Kn(e){return new Promise(t=>setTimeout(t,e))}function Le(e,t,r,...n){return e==null||Gn(e)?e:e instanceof ArrayBuffer?new Uint8Array(e):t(e)?r(e,...n):Array.isArray(e)||ArrayBuffer.isView(e)?e.map(a=>Le(a,t,r,...n)):e instanceof Y?e:typeof e=="object"?Object.fromEntries(Object.entries(e).map(([a,i])=>[a,Le(i,t,r,...n)])):e}function _r(e,t){let r=new XMLHttpRequest;r.open("get",e,!0),r.onload=()=>{let n=new Worker(URL.createObjectURL(new Blob([r.responseText])));t(n)},r.send()}function Er(e){if(Te)return!1;let t=new URL(location.href),r=new URL(e,location.origin);return!(t.host===r.host&&t.port===r.port&&t.protocol===r.protocol)}function Gn(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap}var Qn=hr(gr()),Yn=new TextEncoder;async function Zn(e,t,r){try{let{taskId:n,sizeBuffer:a,dataBuffer:i,signalBuffer:s}=t,o=(0,Qn.encode)(r),h=o.length<=i.length;if(Atomics.store(a,0,o.length),Atomics.store(a,1,+h),!h){let[u,m]=es(e);i.set(Yn.encode(u)),await xr(s,n),i=(await m).dataBuffer}i.set(o),Atomics.store(a,1,1),await xr(s,n)}catch(n){console.warn(n)}}function es(e){let t=Jr();return[t,new Promise(r=>{Te?e.once("message",n=>{!n.id||n.id!==t||r(n)}):e.addEventListener("message",function n(a){!a.data||!a.data.id||a.data.id!==t||(e.removeEventListener("message",n),r(a.data))}),e.start&&e.start()})]}async function xr(e,t){let r=(t>>1)%32,n=1;for(;Atomics.compareExchange(e,r+1,0,t)!==0;)await Kn(n),n<32&&(n*=2);Atomics.or(e,0,1<<r),Atomics.notify(e,0)}var xe,je,Et,Zt,Ft=class{constructor(){O(this,Et),O(this,xe,void 0),O(this,je,void 0),oe(this,je,[]),oe(this,xe,[])}reset(){oe(this,je,[]),oe(this,xe,[])}put(e){f(this,je).length||ye(this,Et,Zt).call(this),f(this,je).shift()(e)}async get(){return f(this,xe).length||ye(this,Et,Zt).call(this),f(this,xe).shift()}isEmpty(){return!f(this,xe).length}isBlocked(){return!!f(this,je).length}get length(){return f(this,xe).length-f(this,je).length}};xe=new WeakMap,je=new WeakMap,Et=new WeakSet,Zt=function(){f(this,xe).push(new Promise(e=>{f(this,je).push(e)}))};function ts(e,t){return ln({type:"request",data:{uuid:Jr(),msg:e}},t)}function er(e,t,r){return ln({type:"response",data:{uuid:e,resp:t}},r)}function ln(e,t){return t&&zn(e,t),e}function rs(e){let t=new He(e.obj.message);return e.obj.name!=="Error"&&(t.name=e.obj.name),t.stack=e.obj.stack,t}function ns(e){return!!e&&typeof e=="object"&&"payloadType"in e&&"obj"in e}function un(e){return ns(e)&&e.payloadType==="ptr"}var ht,$t,$r=class{constructor(){this.inputQueue=new Ft,this.outputQueue=new Ft,this.systemQueue=new Ft,O(this,ht,new Map),O(this,$t,!1)}async read(){return await this.outputQueue.get()}async flush(){let e=[];for(;!this.outputQueue.isEmpty();)e.push(await this.read());return e}async readSystem(){return await this.systemQueue.get()}write(e){if(f(this,$t))throw new _e("The webR communication channel has been closed.");this.inputQueue.put(e)}async request(e,t){let r=ts(e,t),{resolve:n,reject:a,promise:i}=Mt();return f(this,ht).set(r.data.uuid,{resolve:n,reject:a}),this.write(r),i}putClosedMessage(){oe(this,$t,!0),this.outputQueue.put({type:"closed"})}resolveResponse(e){let t=e.data.uuid,r=f(this,ht).get(t);if(r){let n=e.data.resp;f(this,ht).delete(t),n.payloadType==="err"?r.reject(rs(n)):r.resolve(n)}else console.warn("Can't find request.")}};ht=new WeakMap,$t=new WeakMap;hr(gr());new TextDecoder("utf-8");Te&&(globalThis.Worker=cr("worker_threads").Worker);var dt,tr,cn,Tt,jr=class extends $r{constructor(e){super(),O(this,tr),O(this,dt,void 0),this.close=()=>{},O(this,Tt,async(r,n)=>{if(!(!n||!n.type))switch(n.type){case"resolve":oe(this,dt,new Int32Array(n.data)),this.resolve();return;case"response":this.resolveResponse(n);return;case"system":this.systemQueue.put(n.data);return;default:this.outputQueue.put(n);return;case"sync-request":{let a=n,i=a.data.msg,s=a.data.reqData;switch(i.type){case"read":{let o=await this.inputQueue.get();await Zn(r,s,o);break}default:throw new _e(`Unsupported request type '${i.type}'.`)}return}case"request":throw new _e("Can't send messages of type 'request' from a worker. Please Use 'sync-request' instead.")}}),{resolve:this.resolve,reject:this.reject,promise:this.initialised}=Mt();let t=r=>{ye(this,tr,cn).call(this,r),this.close=()=>{r.terminate(),this.putClosedMessage()};let n={type:"init",data:{config:e,channelType:Me.SharedArrayBuffer}};r.postMessage(n)};if(Er(e.baseUrl))_r(`${e.baseUrl}webr-worker.js`,r=>t(r));else{let r=new Worker(`${e.baseUrl}webr-worker.js`);t(r)}}interrupt(){if(!f(this,dt))throw new _e("Failed attempt to interrupt before initialising interruptBuffer");this.inputQueue.reset(),f(this,dt)[0]=1}};dt=new WeakMap,tr=new WeakSet,cn=function(e){Te?(e.on("message",t=>{f(this,Tt).call(this,e,t)}),e.on("error",t=>{console.error(t),this.reject(new He("An error occurred initialising the webR SharedBufferChannel worker."))})):(e.onmessage=t=>f(this,Tt).call(this,e,t.data),e.onerror=t=>{console.error(t),this.reject(new He("An error occurred initialising the webR SharedBufferChannel worker."))})},Tt=new WeakMap;hr(gr());Te&&(globalThis.Worker=cr("worker_threads").Worker);var pt,st,mt,rr,hn,nr,kr,sr,dn,Rt,ss=class extends $r{constructor(e){super(),O(this,rr),O(this,nr),O(this,sr),this.close=()=>{},O(this,pt,new Map),O(this,st,void 0),O(this,mt,!1),O(this,Rt,(r,n)=>{if(!(!n||!n.type))switch(n.type){case"resolve":this.resolve();return;case"response":this.resolveResponse(n);return;case"system":this.systemQueue.put(n.data);return;default:this.outputQueue.put(n);return;case"sync-request":{let a=n.data;f(this,pt).set(a.data.uuid,a.data.msg);return}case"request":throw new _e("Can't send messages of type 'request' from a worker.Use service worker fetch request instead.")}}),{resolve:this.resolve,reject:this.reject,promise:this.initialised}=Mt(),console.warn("The ServiceWorker communication channel is deprecated and will be removed in a future version of webR. Consider using the PostMessage channel instead. If blocking input is required (for example, `browser()`) the SharedArrayBuffer channel should be used. See https://docs.r-wasm.org/webr/latest/serving.html for further information.");let t=r=>{ye(this,sr,dn).call(this,r),this.close=()=>{r.terminate(),this.putClosedMessage()},ye(this,rr,hn).call(this,`${e.serviceWorkerUrl}webr-serviceworker.js`).then(n=>{let a={type:"init",data:{config:e,channelType:Me.ServiceWorker,clientId:n,location:window.location.href}};r.postMessage(a)})};if(Er(e.serviceWorkerUrl))_r(`${e.serviceWorkerUrl}webr-worker.js`,r=>t(r));else{let r=new Worker(`${e.serviceWorkerUrl}webr-worker.js`);t(r)}}activeRegistration(){var e;if(!((e=f(this,st))!=null&&e.active))throw new _e("Attempted to obtain a non-existent active registration.");return f(this,st).active}interrupt(){oe(this,mt,!0)}};pt=new WeakMap,st=new WeakMap,mt=new WeakMap,rr=new WeakSet,hn=async function(e){oe(this,st,await navigator.serviceWorker.register(e)),await navigator.serviceWorker.ready,window.addEventListener("beforeunload",()=>{var r;(r=f(this,st))==null||r.unregister()});let t=await new Promise(r=>{navigator.serviceWorker.addEventListener("message",function n(a){a.data.type==="registration-successful"&&(navigator.serviceWorker.removeEventListener("message",n),r(a.data.clientId))}),this.activeRegistration().postMessage({type:"register-client-main"})});return navigator.serviceWorker.addEventListener("message",r=>{ye(this,nr,kr).call(this,r)}),t},nr=new WeakSet,kr=async function(e){if(e.data.type==="request"){let t=e.data.data,r=f(this,pt).get(t);if(!r)throw new _e("Request not found during service worker XHR request");switch(f(this,pt).delete(t),r.type){case"read":{let n=await this.inputQueue.get();this.activeRegistration().postMessage({type:"wasm-webr-fetch-response",uuid:t,response:er(t,n)});break}case"interrupt":{let n=f(this,mt);this.activeRegistration().postMessage({type:"wasm-webr-fetch-response",uuid:t,response:er(t,n)}),this.inputQueue.reset(),oe(this,mt,!1);break}default:throw new _e(`Unsupported request type '${r.type}'.`)}return}},sr=new WeakSet,dn=function(e){Te?(e.on("message",t=>{f(this,Rt).call(this,e,t)}),e.on("error",t=>{console.error(t),this.reject(new He("An error occurred initialising the webR ServiceWorkerChannel worker."))})):(e.onmessage=t=>f(this,Rt).call(this,e,t.data),e.onerror=t=>{console.error(t),this.reject(new He("An error occurred initialising the webR ServiceWorkerChannel worker."))})},Rt=new WeakMap;Te&&(globalThis.Worker=cr("worker_threads").Worker);var ft,ir,fn,St,Or=class extends $r{constructor(e){super(),O(this,ir),this.close=()=>{},O(this,ft,void 0),O(this,St,async(r,n)=>{if(!(!n||!n.type))switch(n.type){case"resolve":this.resolve();return;case"response":this.resolveResponse(n);return;case"system":this.systemQueue.put(n.data);return;default:this.outputQueue.put(n);return;case"request":{let a=n,i=a.data.msg;switch(i.type){case"read":{let s=await this.inputQueue.get();if(f(this,ft)){let o=er(a.data.uuid,s);f(this,ft).postMessage(o)}break}default:throw new _e(`Unsupported request type '${i.type}'.`)}return}case"sync-request":throw new _e("Can't send messages of type 'sync-request' in PostMessage mode. Use 'request' instead.")}}),{resolve:this.resolve,reject:this.reject,promise:this.initialised}=Mt();let t=r=>{oe(this,ft,r),ye(this,ir,fn).call(this,r),this.close=()=>{r.terminate(),this.putClosedMessage()};let n={type:"init",data:{config:e,channelType:Me.PostMessage}};r.postMessage(n)};if(Er(e.baseUrl))_r(`${e.baseUrl}webr-worker.js`,r=>t(r));else{let r=new Worker(`${e.baseUrl}webr-worker.js`);t(r)}}interrupt(){console.error("Interrupting R execution is not available when using the PostMessage channel")}};ft=new WeakMap,ir=new WeakSet,fn=function(e){Te?(e.on("message",t=>{f(this,St).call(this,e,t)}),e.on("error",t=>{console.error(t),this.reject(new He("An error occurred initialising the webR PostMessageChannel worker."))})):(e.onmessage=t=>f(this,St).call(this,e,t.data),e.onerror=t=>{console.error(t),this.reject(new He("An error occurred initialising the webR PostMessageChannel worker."))})},St=new WeakMap;var Me={Automatic:0,SharedArrayBuffer:1,ServiceWorker:2,PostMessage:3};function is(e){switch(e.channelType){case Me.SharedArrayBuffer:return new jr(e);case Me.ServiceWorker:return new ss(e);case Me.PostMessage:return new Or(e);case Me.Automatic:default:return typeof SharedArrayBuffer<"u"?new jr(e):new Or(e)}}var as=Te?__dirname+"/":"https://webr.r-wasm.org/v0.4.2/",os="https://repo.r-wasm.org",pn="0.4.2";function Xe(e){return!!e&&(typeof e=="object"||typeof e=="function")&&"payloadType"in e&&un(e._payload)}function ls(e){var t;return!!(Xe(e)&&(t=e._payload.obj.methods)!=null&&t.includes("exec"))}function us(){}function cs(e,t){return async function*(){let r={type:"callRObjectMethod",data:{payload:t._payload,prop:"getPropertyValue",args:[{payloadType:"raw",obj:"length"}],shelter:void 0}},n=await e.request(r);if(typeof n.obj!="number")throw new at("Cannot iterate over object, unexpected type for length property.");for(let a=1;a<=n.obj;a++)yield t.get(a)}}function mn(e,t,r){return async(...n)=>{let a=n.map(o=>Xe(o)?o._payload:{obj:Le(o,Xe,h=>h._payload),payloadType:"raw"}),i={type:"callRObjectMethod",data:{payload:r,prop:t,args:a}},s=await e.request(i);switch(s.payloadType){case"ptr":return ze(e,s);case"raw":return Le(s,un,(o,h)=>ze(h,o),e).obj}}}async function hs(e,t,r,...n){let a={type:"newRObject",data:{objType:t,args:Le(n,Xe,s=>s._payload),shelter:r}},i=await e.request(a);switch(i.payloadType){case"raw":throw new Ut("Unexpected raw payload type returned from newRObject");case"ptr":return ze(e,i)}}function ze(e,t){var r;let n=new Proxy((r=t.obj.methods)!=null&&r.includes("exec")?Object.assign(us,{...t}):t,{get:(a,i)=>{var s;if(i==="_payload")return t;if(i===Symbol.asyncIterator)return cs(e,n);if((s=t.obj.methods)!=null&&s.includes(i.toString()))return mn(e,i.toString(),t)},apply:async(a,i,s)=>{let o=await ze(e,t).exec(...s);return ls(o)?o:o.toJs()}});return n}function ue(e,t,r){return new Proxy(M,{construct:(n,a)=>hs(e,r,t,...a),get:(n,a)=>mn(e,a.toString())})}var ds={FONTCONFIG_PATH:"/etc/fonts",R_HOME:"/usr/lib/R",R_ENABLE_JIT:"0",WEBR:"1",WEBR_VERSION:pn},Pr={RArgs:[],REnv:ds,baseUrl:as,serviceWorkerUrl:"",repoUrl:os,homedir:"/home/web_user",interactive:!0,channelType:Me.Automatic,createLazyFilesystem:!0},z,At,ar,yn,fs=class{constructor(e={}){O(this,ar),O(this,z,void 0),O(this,At,void 0),this.version=pn,this.FS={lookupPath:async r=>{let n={type:"lookupPath",data:{path:r}};return(await f(this,z).request(n)).obj},mkdir:async r=>{let n={type:"mkdir",data:{path:r}};return(await f(this,z).request(n)).obj},mount:async(r,n,a)=>{let i=[];"blobs"in n&&n.blobs&&(i=[...i,...n.blobs.map(o=>o.data instanceof Blob?o.data.arrayBuffer().then(h=>{o.data=new Uint8Array(h)}):Promise.resolve())]),"packages"in n&&n.packages&&(i=[...i,...n.packages.map(o=>o.blob instanceof Blob?o.blob.arrayBuffer().then(h=>{o.blob=new Uint8Array(h)}):Promise.resolve())]),await Promise.all(i);let s={type:"mount",data:{type:r,options:n,mountpoint:a}};await f(this,z).request(s)},syncfs:async r=>{let n={type:"syncfs",data:{populate:r}};await f(this,z).request(n)},readFile:async(r,n)=>{let a={type:"readFile",data:{path:r,flags:n}};return(await f(this,z).request(a)).obj},rmdir:async r=>{let n={type:"rmdir",data:{path:r}};await f(this,z).request(n)},writeFile:async(r,n,a)=>{let i={type:"writeFile",data:{path:r,data:n,flags:a}};await f(this,z).request(i)},unlink:async r=>{let n={type:"unlink",data:{path:r}};await f(this,z).request(n)},unmount:async r=>{let n={type:"unmount",data:{path:r}};await f(this,z).request(n)}};let t={...Pr,...e,REnv:{...Pr.REnv,...e.REnv}};oe(this,z,is(t)),this.objs={},this.Shelter=ps(f(this,z)),oe(this,At,f(this,z).initialised.then(async()=>{this.globalShelter=await new this.Shelter,this.RObject=this.globalShelter.RObject,this.RLogical=this.globalShelter.RLogical,this.RInteger=this.globalShelter.RInteger,this.RDouble=this.globalShelter.RDouble,this.RComplex=this.globalShelter.RComplex,this.RCharacter=this.globalShelter.RCharacter,this.RRaw=this.globalShelter.RRaw,this.RList=this.globalShelter.RList,this.RDataFrame=this.globalShelter.RDataFrame,this.RPairlist=this.globalShelter.RPairlist,this.REnvironment=this.globalShelter.REnvironment,this.RSymbol=this.globalShelter.RSymbol,this.RString=this.globalShelter.RString,this.RCall=this.globalShelter.RCall,this.objs={baseEnv:await this.RObject.getPersistentObject("baseEnv"),globalEnv:await this.RObject.getPersistentObject("globalEnv"),null:await this.RObject.getPersistentObject("null"),true:await this.RObject.getPersistentObject("true"),false:await this.RObject.getPersistentObject("false"),na:await this.RObject.getPersistentObject("na")},ye(this,ar,yn).call(this)}))}async init(){return f(this,At)}close(){f(this,z).close()}async read(){return await f(this,z).read()}async flush(){return await f(this,z).flush()}write(e){f(this,z).write(e)}writeConsole(e){this.write({type:"stdin",data:e+`
`})}interrupt(){f(this,z).interrupt()}async installPackages(e,t){let r=Object.assign({quiet:!1,mount:!0},t),n={type:"installPackages",data:{name:e,options:r}};await f(this,z).request(n)}async destroy(e){await this.globalShelter.destroy(e)}async evalR(e,t){return this.globalShelter.evalR(e,t)}async evalRVoid(e,t){return this.evalRRaw(e,"void",t)}async evalRBoolean(e,t){return this.evalRRaw(e,"boolean",t)}async evalRNumber(e,t){return this.evalRRaw(e,"number",t)}async evalRString(e,t){return this.evalRRaw(e,"string",t)}async evalRRaw(e,t,r={}){let n=Le(r,Xe,s=>s._payload),a={type:"evalRRaw",data:{code:e,options:n,outputType:t}},i=await f(this,z).request(a);switch(i.payloadType){case"raw":return i.obj;case"ptr":throw new Ut("Unexpected ptr payload type returned from evalRVoid")}}async invokeWasmFunction(e,...t){let r={type:"invokeWasmFunction",data:{ptr:e,args:t}};return(await f(this,z).request(r)).obj}};z=new WeakMap,At=new WeakMap,ar=new WeakSet,yn=async function(){for(;;){let e=await f(this,z).readSystem();switch(e.type){case"setTimeoutWasm":setTimeout((t,r)=>{this.invokeWasmFunction(t,...r)},e.data.delay,e.data.ptr,e.data.args);break;case"console.log":console.log(e.data);break;case"console.warn":console.warn(e.data);break;case"console.error":console.error(e.data);break;case"close":f(this,z).close();break;default:throw new at("Unknown system message type `"+e.type+"`")}}};var H,L,Dt,Ir=class{constructor(e){O(this,H,""),O(this,L,void 0),O(this,Dt,!1),oe(this,L,e)}async init(){if(f(this,Dt))return;let e={type:"newShelter"},t=await f(this,L).request(e);oe(this,H,t.obj),this.RObject=ue(f(this,L),f(this,H),"object"),this.RLogical=ue(f(this,L),f(this,H),"logical"),this.RInteger=ue(f(this,L),f(this,H),"integer"),this.RDouble=ue(f(this,L),f(this,H),"double"),this.RComplex=ue(f(this,L),f(this,H),"complex"),this.RCharacter=ue(f(this,L),f(this,H),"character"),this.RRaw=ue(f(this,L),f(this,H),"raw"),this.RList=ue(f(this,L),f(this,H),"list"),this.RDataFrame=ue(f(this,L),f(this,H),"dataframe"),this.RPairlist=ue(f(this,L),f(this,H),"pairlist"),this.REnvironment=ue(f(this,L),f(this,H),"environment"),this.RSymbol=ue(f(this,L),f(this,H),"symbol"),this.RString=ue(f(this,L),f(this,H),"string"),this.RCall=ue(f(this,L),f(this,H),"call"),oe(this,Dt,!0)}async purge(){let e={type:"shelterPurge",data:f(this,H)};await f(this,L).request(e)}async destroy(e){let t={type:"shelterDestroy",data:{id:f(this,H),obj:e._payload}};await f(this,L).request(t)}async size(){let e={type:"shelterSize",data:f(this,H)};return(await f(this,L).request(e)).obj}async evalR(e,t={}){let r=Le(t,Xe,i=>i._payload),n={type:"evalR",data:{code:e,options:r,shelter:f(this,H)}},a=await f(this,L).request(n);switch(a.payloadType){case"raw":throw new Ut("Unexpected payload type returned from evalR");default:return ze(f(this,L),a)}}async captureR(e,t={}){let r=Le(t,Xe,i=>i._payload),n={type:"captureR",data:{code:e,options:r,shelter:f(this,H)}},a=await f(this,L).request(n);switch(a.payloadType){case"ptr":throw new Ut("Unexpected payload type returned from evalR");case"raw":{let i=a.obj,s=ze(f(this,L),i.result),o=i.output,h=i.images;for(let u=0;u<o.length;++u)o[u].type!=="stdout"&&o[u].type!=="stderr"&&(o[u].data=ze(f(this,L),o[u].data));return{result:s,output:o,images:h}}}}};H=new WeakMap,L=new WeakMap,Dt=new WeakMap;function ps(e){return new Proxy(Ir,{construct:async()=>{let t=new Ir(e);return await t.init(),t}})}async function ms(e,t){const r=`${window.location.origin}/tools/webR`,n=new fs({baseUrl:`${r}/webr-0.4.2/`});await n.init(),await n.evalR(`
        webr::mount(mountpoint = "/usr/lib/R/library/statmod", source = "${r}/packages/statmod_1.5.0.tgz");
        webr::mount(mountpoint = "/usr/lib/R/library/Rcpp", source = "${r}/packages/Rcpp_1.0.13.tgz");
        webr::mount(mountpoint = "/usr/lib/R/library/limma", source = "${r}/packages/limma_3.61.12.tgz");
        webr::mount(mountpoint = "/edgeR", source = "${r}/packages/edgeR/library.data");
        .libPaths(c(.libPaths(), "/edgeR"));
        library(edgeR);
        message("Running differential analysis with edgeR")
    `);const a=e.map(s=>s.map(o=>({...o}))),i=t.map(s=>s.map(o=>({...o})));for(let s=0;s<a.length;s++)await n.objs.globalEnv.bind("controlDataPart",a[s]),await n.evalR(`
        # check if controlData exists
        if (!exists("controlData")) {
          controlData <- list()
        }
        controlData[[${s+1}]] <- controlDataPart
        # clean up
        rm(controlDataPart)
      `);for(let s=0;s<i.length;s++)await n.objs.globalEnv.bind("treatmentDataPart",i[s]),await n.evalR(`
        # check if treatmentData exists
        if (!exists("treatmentData")) {
          treatmentData <- list()
        }
        treatmentData[[${s+1}]] <- treatmentDataPart
        # clean up
        rm(treatmentDataPart)
      `);try{return await(await n.evalR(`
        # Function to process input data and perform differential expression analysis
        load_data <- function(control_list, treatment_list) {
          # Merge control and treatment data for filtering
          all_list <- c(control_list, treatment_list)
          read_counts <- do.call(cbind, lapply(all_list, function(x) { x$readCount }))

          # Apply filtering for non-zero counts
          zeros <- apply(apply(read_counts, 1, ">", 0), 2, any)
          noness_list <- lapply(all_list, function(x) { x[zeros, ] })

          # Build count matrix and treatments factor
          count_mat <- do.call(cbind, lapply(noness_list, function(x) { x$readCount }))
          conds <- factor(c(rep("ctrl", length(control_list)), rep("cond", length(treatment_list))))

          list(count_mat = count_mat, conds = conds, noness_list = noness_list)
        }
        
        perform_differential_expression <- function(count_mat, conds, noness_list) {
            # Perform edgeR differential expression analysis
            d <- DGEList(counts = count_mat, group = conds)
            d <- calcNormFactors(d)
            d <- estimateCommonDisp(d)
            d <- estimateTagwiseDisp(d)
            de.tgw <- exactTest(d, pair = c("ctrl", "cond"))

            # Prepare differential expression results
            ctrl1_noness <- noness_list[[1]]
            diff <- cbind(ctrl1_noness[, c("seqId", "name", "start", "end", "strand")], de.tgw$table, QValue = p.adjust(de.tgw$table$PValue, "BH"))

            return(diff)
        }

        data <- load_data(controlData, treatmentData)
        diff_results <- perform_differential_expression(data$count_mat, data$conds, data$noness_list)
        diff_results
      `)).toD3()}finally{n.close()}}async function ys(e,t){return(await ms(e,t)).map((n,a)=>({id:a,seqId:n.seqId,name:n.name,start:n.start,stop:n.end,strand:n.strand,logFC:n.logFC,logCPM:n.logCPM,pValue:n.PValue||Number.MIN_VALUE,qValue:n.QValue||Number.MIN_VALUE}))}function Br(e){let t,r,n;return r=new _n({props:{value:void 0,width:"w-14",strokeLinecap:"round"}}),{c(){t=I("div"),W(r.$$.fragment),this.h()},l(a){t=B(a,"DIV",{class:!0});var i=N(t);F(r.$$.fragment,i),i.forEach(T),this.h()},h(){ae(t,"class","flex items-center justify-center align-middle m-12")},m(a,i){le(a,t,i),V(r,t,null),n=!0},p:rt,i(a){n||(j(r.$$.fragment,a),n=!0)},o(a){P(r.$$.fragment,a),n=!1},d(a){a&&T(t),q(r)}}}function gs(e){let t,r,n,a,i,s,o=`This plot shows the comparison between the log2 fold-change (x-axis) and the -log10(Q-Value) for
    each gene. The logFC represents the log2 fold-change between control and treatment read counts
    for each gene. The -log10(Q-Value) represents the negative log10 of the Q-Value, which is a
    measure of the significance of the difference in expression between control and treatment
    samples.`,h,u=e[0]&&Br();return{c(){t=I("div"),r=I("section"),n=I("div"),a=A(),u&&u.c(),i=A(),s=I("footer"),s.textContent=o,this.h()},l(m){t=B(m,"DIV",{class:!0});var b=N(t);r=B(b,"SECTION",{class:!0});var _=N(r);n=B(_,"DIV",{id:!0,style:!0}),N(n).forEach(T),a=D(_),u&&u.l(_),_.forEach(T),i=D(b),s=B(b,"FOOTER",{class:!0,"data-svelte-h":!0}),jt(s)!=="svelte-1qzvpvg"&&(s.textContent=o),b.forEach(T),this.h()},h(){ae(n,"id",e[1]),Rr(n,"width","100%"),Rr(n,"height","100%"),ae(r,"class","p-4"),ae(s,"class","card-footer"),ae(t,"class","card")},m(m,b){le(m,t,b),w(t,r),w(r,n),w(r,a),u&&u.m(r,null),w(t,i),w(t,s),h=!0},p(m,[b]){m[0]?u?(u.p(m,b),b&1&&j(u,1)):(u=Br(),u.c(),j(u,1),u.m(r,null)):u&&(qt(),P(u,1,1,()=>{u=null}),zt())},i(m){h||(j(u),h=!0)},o(m){P(u),h=!1},d(m){m&&T(t),u&&u.d()}}}function ws(e,t,r){let n,{comparisonResults:a}=t,{filterData:i}=t,s="plotly",o=!1;const h=()=>{const m=document.getElementById(s);m&&wt.relayout(m,{width:m.clientWidth,height:m.clientHeight})},u=()=>{wt.downloadImage(document.getElementById(s),{format:"svg",filename:"diana"})};return gn(()=>{window.removeEventListener("resize",h)}),e.$$set=m=>{"comparisonResults"in m&&r(2,a=m.comparisonResults),"filterData"in m&&r(3,i=m.filterData)},e.$$.update=()=>{if(e.$$.dirty&4&&r(0,n=a.length===0),e.$$.dirty&29&&!n&&!o){const m={yaxis:{title:"-log10(Q-Value)"},xaxis:{zeroline:!1},margin:{b:25,t:25,r:25},barmode:"overlay",modebar:{orientation:"v"},dragmode:"select"},b={modeBarButtonsToRemove:["autoScale2d"],responsive:!0,displaylogo:!1,modeBarButtonsToAdd:[{name:"Download plot as svg",icon:wt.Icons.camera,click:u}]},_={x:a.map(v=>v.logFC),y:a.map(v=>-Math.log10(v.qValue)),text:a.map(v=>v.name),customdata:a.map(v=>v.id),type:"scatter",mode:"markers"};wt.newPlot(s,[_],m,b),window.addEventListener("resize",h);const R=document.getElementById(s);R==null||R.on("plotly_selected",function(v){if(v===void 0)return;const l=v.points.map(c=>c.customdata);i(l)}),R==null||R.on("plotly_deselect",function(){i([])}),r(4,o=!0)}},[n,s,a,i,o]}class bs extends lr{constructor(t){super(),ur(this,t,ws,gs,or,{comparisonResults:2,filterData:3})}}function Mr(e,t,r){const n=e.slice();return n[4]=t[r],n}function vs(e){let t;return{c(){t=te("Chromosome")},l(r){t=re(r,"Chromosome")},m(r,n){le(r,t,n)},d(r){r&&T(t)}}}function _s(e){let t;return{c(){t=te("Name")},l(r){t=re(r,"Name")},m(r,n){le(r,t,n)},d(r){r&&T(t)}}}function Es(e){let t;return{c(){t=te("Start")},l(r){t=re(r,"Start")},m(r,n){le(r,t,n)},d(r){r&&T(t)}}}function $s(e){let t;return{c(){t=te("End")},l(r){t=re(r,"End")},m(r,n){le(r,t,n)},d(r){r&&T(t)}}}function Ts(e){let t;return{c(){t=te("Log2 Fold Change")},l(r){t=re(r,"Log2 Fold Change")},m(r,n){le(r,t,n)},d(r){r&&T(t)}}}function Rs(e){let t;return{c(){t=te("Log CPM")},l(r){t=re(r,"Log CPM")},m(r,n){le(r,t,n)},d(r){r&&T(t)}}}function Ss(e){let t;return{c(){t=te("P-Value")},l(r){t=re(r,"P-Value")},m(r,n){le(r,t,n)},d(r){r&&T(t)}}}function As(e){let t;return{c(){t=te("Q-Value")},l(r){t=re(r,"Q-Value")},m(r,n){le(r,t,n)},d(r){r&&T(t)}}}function Cr(e){let t,r,n=e[4].seqId+"",a,i,s,o=e[4].name+"",h,u,m,b=e[4].start+"",_,R,v,l=e[4].stop+"",c,g,d,E=e[4].logFC+"",$,k,U,ie=e[4].logCPM+"",Z,Re,x,ce=e[4].pValue+"",Oe,pe,Se,he=e[4].qValue+"",Pe,me;return{c(){t=I("tr"),r=I("td"),a=te(n),i=A(),s=I("td"),h=te(o),u=A(),m=I("td"),_=te(b),R=A(),v=I("td"),c=te(l),g=A(),d=I("td"),$=te(E),k=A(),U=I("td"),Z=te(ie),Re=A(),x=I("td"),Oe=te(ce),pe=A(),Se=I("td"),Pe=te(he),me=A()},l(G){t=B(G,"TR",{});var S=N(t);r=B(S,"TD",{});var Ge=N(r);a=re(Ge,n),Ge.forEach(T),i=D(S),s=B(S,"TD",{});var ge=N(s);h=re(ge,o),ge.forEach(T),u=D(S),m=B(S,"TD",{});var Qe=N(m);_=re(Qe,b),Qe.forEach(T),R=D(S),v=B(S,"TD",{});var we=N(v);c=re(we,l),we.forEach(T),g=D(S),d=B(S,"TD",{});var Ye=N(d);$=re(Ye,E),Ye.forEach(T),k=D(S),U=B(S,"TD",{});var be=N(U);Z=re(be,ie),be.forEach(T),Re=D(S),x=B(S,"TD",{});var Ze=N(x);Oe=re(Ze,ce),Ze.forEach(T),pe=D(S),Se=B(S,"TD",{});var Ae=N(Se);Pe=re(Ae,he),Ae.forEach(T),me=D(S),S.forEach(T)},m(G,S){le(G,t,S),w(t,r),w(r,a),w(t,i),w(t,s),w(s,h),w(t,u),w(t,m),w(m,_),w(t,R),w(t,v),w(v,c),w(t,g),w(t,d),w(d,$),w(t,k),w(t,U),w(U,Z),w(t,Re),w(t,x),w(x,Oe),w(t,pe),w(t,Se),w(Se,Pe),w(t,me)},p(G,S){S&1&&n!==(n=G[4].seqId+"")&&Ue(a,n),S&1&&o!==(o=G[4].name+"")&&Ue(h,o),S&1&&b!==(b=G[4].start+"")&&Ue(_,b),S&1&&l!==(l=G[4].stop+"")&&Ue(c,l),S&1&&E!==(E=G[4].logFC+"")&&Ue($,E),S&1&&ie!==(ie=G[4].logCPM+"")&&Ue(Z,ie),S&1&&ce!==(ce=G[4].pValue+"")&&Ue(Oe,ce),S&1&&he!==(he=G[4].qValue+"")&&Ue(Pe,he)},d(G){G&&T(t)}}}function Ds(e){let t,r,n,a,i,s,o,h,u,m,b,_,R,v,l,c,g,d,E,$,k,U,ie,Z,Re,x,ce,Oe,pe,Se,he,Pe,me,G,S,Ge,ge,Qe,we,Ye,be,Ze,Ae,Ct,ve,Ne,Lt,We,Nt,Fe,gt;n=new En({props:{handler:e[1]}}),i=new Sn({props:{handler:e[1],filename:"comparisons.csv"}}),m=new Ie({props:{handler:e[1],orderBy:"seqId",$$slots:{default:[vs]},$$scope:{ctx:e}}}),_=new Ie({props:{handler:e[1],orderBy:"name",$$slots:{default:[_s]},$$scope:{ctx:e}}}),v=new Ie({props:{handler:e[1],orderBy:"start",$$slots:{default:[Es]},$$scope:{ctx:e}}}),c=new Ie({props:{handler:e[1],orderBy:"stop",$$slots:{default:[$s]},$$scope:{ctx:e}}}),d=new Ie({props:{handler:e[1],orderBy:"logFC",$$slots:{default:[Ts]},$$scope:{ctx:e}}}),$=new Ie({props:{handler:e[1],orderBy:"logCPM",$$slots:{default:[Rs]},$$scope:{ctx:e}}}),U=new Ie({props:{handler:e[1],orderBy:"pValue",$$slots:{default:[Ss]},$$scope:{ctx:e}}}),Z=new Ie({props:{handler:e[1],orderBy:"qValue",$$slots:{default:[As]},$$scope:{ctx:e}}}),ce=new Be({props:{handler:e[1],filterBy:"seqId"}}),pe=new Be({props:{handler:e[1],filterBy:"name"}}),he=new Be({props:{handler:e[1],filterBy:"start"}}),me=new Be({props:{handler:e[1],filterBy:"stop"}}),S=new Be({props:{handler:e[1],filterBy:"logFC"}}),ge=new Be({props:{handler:e[1],filterBy:"logCPM"}}),we=new Be({props:{handler:e[1],filterBy:"pValue"}}),be=new Be({props:{handler:e[1],filterBy:"qValue"}});let et=Ar(e[0]),ee=[];for(let y=0;y<et.length;y+=1)ee[y]=Cr(Mr(e,et,y));return Ne=new $n({props:{handler:e[1]}}),We=new Tn({props:{handler:e[1]}}),Fe=new Rn({props:{handler:e[1]}}),{c(){t=I("div"),r=I("header"),W(n.$$.fragment),a=A(),W(i.$$.fragment),s=A(),o=I("table"),h=I("thead"),u=I("tr"),W(m.$$.fragment),b=A(),W(_.$$.fragment),R=A(),W(v.$$.fragment),l=A(),W(c.$$.fragment),g=A(),W(d.$$.fragment),E=A(),W($.$$.fragment),k=A(),W(U.$$.fragment),ie=A(),W(Z.$$.fragment),Re=A(),x=I("tr"),W(ce.$$.fragment),Oe=A(),W(pe.$$.fragment),Se=A(),W(he.$$.fragment),Pe=A(),W(me.$$.fragment),G=A(),W(S.$$.fragment),Ge=A(),W(ge.$$.fragment),Qe=A(),W(we.$$.fragment),Ye=A(),W(be.$$.fragment),Ze=A(),Ae=I("tbody");for(let y=0;y<ee.length;y+=1)ee[y].c();Ct=A(),ve=I("footer"),W(Ne.$$.fragment),Lt=A(),W(We.$$.fragment),Nt=A(),W(Fe.$$.fragment),this.h()},l(y){t=B(y,"DIV",{class:!0});var C=N(t);r=B(C,"HEADER",{class:!0});var de=N(r);F(n.$$.fragment,de),a=D(de),F(i.$$.fragment,de),de.forEach(T),s=D(C),o=B(C,"TABLE",{class:!0});var Ve=N(o);h=B(Ve,"THEAD",{});var qe=N(h);u=B(qe,"TR",{});var X=N(u);F(m.$$.fragment,X),b=D(X),F(_.$$.fragment,X),R=D(X),F(v.$$.fragment,X),l=D(X),F(c.$$.fragment,X),g=D(X),F(d.$$.fragment,X),E=D(X),F($.$$.fragment,X),k=D(X),F(U.$$.fragment,X),ie=D(X),F(Z.$$.fragment,X),X.forEach(T),Re=D(qe),x=B(qe,"TR",{});var K=N(x);F(ce.$$.fragment,K),Oe=D(K),F(pe.$$.fragment,K),Se=D(K),F(he.$$.fragment,K),Pe=D(K),F(me.$$.fragment,K),G=D(K),F(S.$$.fragment,K),Ge=D(K),F(ge.$$.fragment,K),Qe=D(K),F(we.$$.fragment,K),Ye=D(K),F(be.$$.fragment,K),K.forEach(T),qe.forEach(T),Ze=D(Ve),Ae=B(Ve,"TBODY",{});var ut=N(Ae);for(let tt=0;tt<ee.length;tt+=1)ee[tt].l(ut);ut.forEach(T),Ve.forEach(T),Ct=D(C),ve=B(C,"FOOTER",{class:!0});var De=N(ve);F(Ne.$$.fragment,De),Lt=D(De),F(We.$$.fragment,De),Nt=D(De),F(Fe.$$.fragment,De),De.forEach(T),C.forEach(T),this.h()},h(){ae(r,"class","flex justify-between gap-4"),ae(o,"class","table table-hover table-compact w-full table-auto"),ae(ve,"class","flex justify-between"),ae(t,"class","overflow-x-auto space-y-4")},m(y,C){le(y,t,C),w(t,r),V(n,r,null),w(r,a),V(i,r,null),w(t,s),w(t,o),w(o,h),w(h,u),V(m,u,null),w(u,b),V(_,u,null),w(u,R),V(v,u,null),w(u,l),V(c,u,null),w(u,g),V(d,u,null),w(u,E),V($,u,null),w(u,k),V(U,u,null),w(u,ie),V(Z,u,null),w(h,Re),w(h,x),V(ce,x,null),w(x,Oe),V(pe,x,null),w(x,Se),V(he,x,null),w(x,Pe),V(me,x,null),w(x,G),V(S,x,null),w(x,Ge),V(ge,x,null),w(x,Qe),V(we,x,null),w(x,Ye),V(be,x,null),w(o,Ze),w(o,Ae);for(let de=0;de<ee.length;de+=1)ee[de]&&ee[de].m(Ae,null);w(t,Ct),w(t,ve),V(Ne,ve,null),w(ve,Lt),V(We,ve,null),w(ve,Nt),V(Fe,ve,null),gt=!0},p(y,[C]){const de={};C&128&&(de.$$scope={dirty:C,ctx:y}),m.$set(de);const Ve={};C&128&&(Ve.$$scope={dirty:C,ctx:y}),_.$set(Ve);const qe={};C&128&&(qe.$$scope={dirty:C,ctx:y}),v.$set(qe);const X={};C&128&&(X.$$scope={dirty:C,ctx:y}),c.$set(X);const K={};C&128&&(K.$$scope={dirty:C,ctx:y}),d.$set(K);const ut={};C&128&&(ut.$$scope={dirty:C,ctx:y}),$.$set(ut);const De={};C&128&&(De.$$scope={dirty:C,ctx:y}),U.$set(De);const tt={};if(C&128&&(tt.$$scope={dirty:C,ctx:y}),Z.$set(tt),C&1){et=Ar(y[0]);let fe;for(fe=0;fe<et.length;fe+=1){const Tr=Mr(y,et,fe);ee[fe]?ee[fe].p(Tr,C):(ee[fe]=Cr(Tr),ee[fe].c(),ee[fe].m(Ae,null))}for(;fe<ee.length;fe+=1)ee[fe].d(1);ee.length=et.length}},i(y){gt||(j(n.$$.fragment,y),j(i.$$.fragment,y),j(m.$$.fragment,y),j(_.$$.fragment,y),j(v.$$.fragment,y),j(c.$$.fragment,y),j(d.$$.fragment,y),j($.$$.fragment,y),j(U.$$.fragment,y),j(Z.$$.fragment,y),j(ce.$$.fragment,y),j(pe.$$.fragment,y),j(he.$$.fragment,y),j(me.$$.fragment,y),j(S.$$.fragment,y),j(ge.$$.fragment,y),j(we.$$.fragment,y),j(be.$$.fragment,y),j(Ne.$$.fragment,y),j(We.$$.fragment,y),j(Fe.$$.fragment,y),gt=!0)},o(y){P(n.$$.fragment,y),P(i.$$.fragment,y),P(m.$$.fragment,y),P(_.$$.fragment,y),P(v.$$.fragment,y),P(c.$$.fragment,y),P(d.$$.fragment,y),P($.$$.fragment,y),P(U.$$.fragment,y),P(Z.$$.fragment,y),P(ce.$$.fragment,y),P(pe.$$.fragment,y),P(he.$$.fragment,y),P(me.$$.fragment,y),P(S.$$.fragment,y),P(ge.$$.fragment,y),P(we.$$.fragment,y),P(be.$$.fragment,y),P(Ne.$$.fragment,y),P(We.$$.fragment,y),P(Fe.$$.fragment,y),gt=!1},d(y){y&&T(t),q(n),q(i),q(m),q(_),q(v),q(c),q(d),q($),q(U),q(Z),q(ce),q(pe),q(he),q(me),q(S),q(ge),q(we),q(be),wn(ee,y),q(Ne),q(We),q(Fe)}}}function Us(e,t,r){let n,{comparisonResults:a}=t,i=new An(a,{rowsPerPage:10}),s=i.getRows();return Vt(e,s,o=>r(0,n=o)),e.$$set=o=>{"comparisonResults"in o&&r(3,a=o.comparisonResults)},e.$$.update=()=>{e.$$.dirty&8&&a&&i.setRows(a)},[n,i,s,a]}class xs extends lr{constructor(t){super(),ur(this,t,Us,Ds,or,{comparisonResults:3})}}function js(e){let t,r;return t=new bs({props:{comparisonResults:e[0],filterData:e[6]}}),{c(){W(t.$$.fragment)},l(n){F(t.$$.fragment,n)},m(n,a){V(t,n,a),r=!0},p(n,a){const i={};a&1&&(i.comparisonResults=n[0]),t.$set(i)},i(n){r||(j(t.$$.fragment,n),r=!0)},o(n){P(t.$$.fragment,n),r=!1},d(n){q(t,n)}}}function ks(e){let t,r=`<p class="font-bold">Insufficient replicates</p> <p>Please use the <a class="anchor" href="/">Data Panel</a> to ensure that you have at least
          two control and two treatment datasets to perform a valid comparison.</p>`;return{c(){t=I("div"),t.innerHTML=r,this.h()},l(n){t=B(n,"DIV",{class:!0,"data-svelte-h":!0}),jt(t)!=="svelte-1gljt8k"&&(t.innerHTML=r),this.h()},h(){ae(t,"class","block card p-4 variant-ghost-error")},m(n,a){le(n,t,a)},p:rt,i:rt,o:rt,d(n){n&&T(t)}}}function Os(e){let t,r,n="An error occurred while comparing gene insert sites. Please try again.",a,i,s=(e[3]?e[3]:"")+"",o;return{c(){t=I("div"),r=I("p"),r.textContent=n,a=A(),i=I("p"),o=te(s),this.h()},l(h){t=B(h,"DIV",{class:!0});var u=N(t);r=B(u,"P",{class:!0,"data-svelte-h":!0}),jt(r)!=="svelte-dvkxpk"&&(r.textContent=n),a=D(u),i=B(u,"P",{});var m=N(i);o=re(m,s),m.forEach(T),u.forEach(T),this.h()},h(){ae(r,"class","font-bold"),ae(t,"class","block card p-4 variant-ghost-error")},m(h,u){le(h,t,u),w(t,r),w(t,a),w(t,i),w(i,o)},p(h,u){u&8&&s!==(s=(h[3]?h[3]:"")+"")&&Ue(o,s)},i:rt,o:rt,d(h){h&&T(t)}}}function Lr(e){let t,r;return t=new xs({props:{comparisonResults:e[1]}}),{c(){W(t.$$.fragment)},l(n){F(t.$$.fragment,n)},m(n,a){V(t,n,a),r=!0},p(n,a){const i={};a&2&&(i.comparisonResults=n[1]),t.$set(i)},i(n){r||(j(t.$$.fragment,n),r=!0)},o(n){P(t.$$.fragment,n),r=!1},d(n){q(t,n)}}}function Ps(e){let t,r,n=`<h1 class="h1 mb-1">Compare gene insert sites</h1> <p>Perform edgeR differential expression analysis to compare the gene insert sites between your
      control and treatment datasets.</p>`,a,i,s,o,h,u,m;const b=[Os,ks,js],_=[];function R(l,c){return l[2]?0:l[4].length<2||l[5].length<2?1:2}s=R(e),o=_[s]=b[s](e);let v=e[1].length>0&&Lr(e);return{c(){t=I("div"),r=I("div"),r.innerHTML=n,a=A(),i=I("div"),o.c(),h=A(),u=I("div"),v&&v.c(),this.h()},l(l){t=B(l,"DIV",{class:!0});var c=N(t);r=B(c,"DIV",{class:!0,"data-svelte-h":!0}),jt(r)!=="svelte-br2ch9"&&(r.innerHTML=n),a=D(c),i=B(c,"DIV",{class:!0});var g=N(i);o.l(g),g.forEach(T),h=D(c),u=B(c,"DIV",{});var d=N(u);v&&v.l(d),d.forEach(T),c.forEach(T),this.h()},h(){ae(r,"class","mb-4"),ae(i,"class","mb-4"),ae(t,"class","m-4")},m(l,c){le(l,t,c),w(t,r),w(t,a),w(t,i),_[s].m(i,null),w(t,h),w(t,u),v&&v.m(u,null),m=!0},p(l,[c]){let g=s;s=R(l),s===g?_[s].p(l,c):(qt(),P(_[g],1,1,()=>{_[g]=null}),zt(),o=_[s],o?o.p(l,c):(o=_[s]=b[s](l),o.c()),j(o,1),o.m(i,null)),l[1].length>0?v?(v.p(l,c),c&2&&j(v,1)):(v=Lr(l),v.c(),j(v,1),v.m(u,null)):v&&(qt(),P(v,1,1,()=>{v=null}),zt())},i(l){m||(j(o),j(v),m=!0)},o(l){P(o),P(v),m=!1},d(l){l&&T(t),_[s].d(),v&&v.d()}}}function Is(e,t,r){let n,a;Vt(e,vn,l=>r(7,n=l)),Vt(e,bn,l=>r(8,a=l));const i=Dn();let s=[],o=[],h=!1,u=null;const m=Array.from(a.entries());let b=m.filter(([l,c])=>!c.isTreatment).map(([l,c])=>c.chromosomes),_=m.filter(([l,c])=>c.isTreatment).map(([l,c])=>c.chromosomes);async function R(){const l=await Promise.all(b.map(g=>Sr(n.filteredFeatures,g))),c=await Promise.all(_.map(g=>Sr(n.filteredFeatures,g)));try{r(0,s=await ys(l,c))}catch(g){console.error(g);const E={message:`An error occurred while comparing gene insert sites. ${g.message}`,background:"variant-glass-error"};i.trigger(E),r(2,h=!0),g.message.includes("dispersions must be finite non-negative values")&&r(3,u="Could not estimate dispersion for the data. Please increase the number of replicates or adjust the data.")}r(1,o=[...s])}const v=l=>{if(l.length===0){r(1,o=s);return}r(1,o=s.filter(c=>l.includes(c.id)))};return b.length>1&&_.length>1&&R(),[s,o,h,u,b,_,v]}class Js extends lr{constructor(t){super(),ur(this,t,Is,Ps,or,{})}}export{Js as component};
