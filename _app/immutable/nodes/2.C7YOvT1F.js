import{s as ae,y as Q,A as _e,e as L,a as H,c as D,b as A,g as U,f as I,O as ue,m as p,v as K,i as C,h as S,P as R,B as ve,C as be,D as pe,J as Ue,Q as de,w as Ge,z as me,R as F,F as ze,t as Z,l as Y,d as J,n as X,aa as Je,L as qe,j as he,G as Oe,I as Xe,k as oe,S as Le}from"../chunks/scheduler.Ctx98Cov.js";import{S as ie,i as re,t as M,g as q,a as j,c as O,f as Ke,b as x,d as $,m as ee,e as te}from"../chunks/index.DzosD7qk.js";import{e as Se}from"../chunks/each.tnL4mEXE.js";import{g as Ye}from"../chunks/stores.CA_mewrb.js";import"../chunks/ProgressBar.svelte_svelte_type_style_lang.HlYL--rL.js";import{g as Qe}from"../chunks/spread.CN4WR7uZ.js";import{P as xe}from"../chunks/ProgressRadial.XZQD61kG.js";import{a as fe}from"../chunks/annotationStore.Dn3m1aBo.js";import{i as le}from"../chunks/insertStore.MaCQ88it.js";import{t as De}from"../chunks/TAStore.BMmLN0sp.js";import{r as ne}from"../chunks/refStore.BhAY7eVF.js";import{i as ce}from"../chunks/igvStore.BTHXzOeg.js";const $e=s=>({}),Ve=s=>({}),et=s=>({}),We=s=>({}),tt=s=>({}),Pe=s=>({});function Ae(s){let e,t,l;const a=s[18].lead,n=_e(a,s,s[17],Pe);return{c(){e=L("div"),n&&n.c(),this.h()},l(i){e=D(i,"DIV",{class:!0});var o=A(e);n&&n.l(o),o.forEach(I),this.h()},h(){p(e,"class",t="dropzone-lead "+s[5])},m(i,o){C(i,e,o),n&&n.m(e,null),l=!0},p(i,o){n&&n.p&&(!l||o[0]&131072)&&ve(n,a,i,i[17],l?pe(a,i[17],o,tt):be(i[17]),Pe),(!l||o[0]&32&&t!==(t="dropzone-lead "+i[5]))&&p(e,"class",t)},i(i){l||(M(n,i),l=!0)},o(i){j(n,i),l=!1},d(i){i&&I(e),n&&n.d(i)}}}function st(s){let e,t="Upload a file",l;return{c(){e=L("strong"),e.textContent=t,l=Z(" or drag and drop")},l(a){e=D(a,"STRONG",{"data-svelte-h":!0}),Y(e)!=="svelte-13uz6lq"&&(e.textContent=t),l=J(a," or drag and drop")},m(a,n){C(a,e,n),C(a,l,n)},p:X,d(a){a&&(I(e),I(l))}}}function Me(s){let e,t,l;const a=s[18].meta,n=_e(a,s,s[17],Ve);return{c(){e=L("small"),n&&n.c(),this.h()},l(i){e=D(i,"SMALL",{class:!0});var o=A(e);n&&n.l(o),o.forEach(I),this.h()},h(){p(e,"class",t="dropzone-meta "+s[7])},m(i,o){C(i,e,o),n&&n.m(e,null),l=!0},p(i,o){n&&n.p&&(!l||o[0]&131072)&&ve(n,a,i,i[17],l?pe(a,i[17],o,$e):be(i[17]),Ve),(!l||o[0]&128&&t!==(t="dropzone-meta "+i[7]))&&p(e,"class",t)},i(i){l||(M(n,i),l=!0)},o(i){j(n,i),l=!1},d(i){i&&I(e),n&&n.d(i)}}}function lt(s){let e,t,l,a,n,i,o,m,g,z,u,_,v,b,T,y,V=[{type:"file"},{name:s[2]},{class:l="dropzone-input "+s[9]},s[11]()],r={};for(let h=0;h<V.length;h+=1)r=Q(r,V[h]);let d=s[13].lead&&Ae(s);const k=s[18].message,w=_e(k,s,s[17],We),P=w||st();let f=s[13].meta&&Me(s);return{c(){e=L("div"),t=L("input"),a=H(),n=L("div"),i=L("div"),d&&d.c(),o=H(),m=L("div"),P&&P.c(),z=H(),f&&f.c(),this.h()},l(h){e=D(h,"DIV",{class:!0,"data-testid":!0});var E=A(e);t=D(E,"INPUT",{type:!0,name:!0,class:!0}),a=U(E),n=D(E,"DIV",{class:!0});var W=A(n);i=D(W,"DIV",{class:!0});var N=A(i);d&&d.l(N),o=U(N),m=D(N,"DIV",{class:!0});var B=A(m);P&&P.l(B),B.forEach(I),z=U(N),f&&f.l(N),N.forEach(I),W.forEach(I),E.forEach(I),this.h()},h(){ue(t,r),p(m,"class",g="dropzone-message "+s[6]),p(i,"class",u="dropzone-interface-text "+s[4]),p(n,"class",_="dropzone-interface "+s[8]+" "+s[3]),p(e,"class",v="dropzone "+s[10]),p(e,"data-testid","file-dropzone"),K(e,"opacity-50",s[12].disabled)},m(h,E){C(h,e,E),S(e,t),t.autofocus&&t.focus(),s[32](t),S(e,a),S(e,n),S(n,i),d&&d.m(i,null),S(i,o),S(i,m),P&&P.m(m,null),S(i,z),f&&f.m(i,null),b=!0,T||(y=[R(t,"change",s[31]),R(t,"change",s[19]),R(t,"dragenter",s[20]),R(t,"dragover",s[21]),R(t,"dragleave",s[22]),R(t,"drop",s[23]),R(t,"click",s[24]),R(t,"keydown",s[25]),R(t,"keyup",s[26]),R(t,"keypress",s[27]),R(t,"focus",s[28]),R(t,"focusin",s[29]),R(t,"focusout",s[30])],T=!0)},p(h,E){ue(t,r=Qe(V,[{type:"file"},(!b||E[0]&4)&&{name:h[2]},(!b||E[0]&512&&l!==(l="dropzone-input "+h[9]))&&{class:l},h[11]()])),h[13].lead?d?(d.p(h,E),E[0]&8192&&M(d,1)):(d=Ae(h),d.c(),M(d,1),d.m(i,o)):d&&(q(),j(d,1,1,()=>{d=null}),O()),w&&w.p&&(!b||E[0]&131072)&&ve(w,k,h,h[17],b?pe(k,h[17],E,et):be(h[17]),We),(!b||E[0]&64&&g!==(g="dropzone-message "+h[6]))&&p(m,"class",g),h[13].meta?f?(f.p(h,E),E[0]&8192&&M(f,1)):(f=Me(h),f.c(),M(f,1),f.m(i,null)):f&&(q(),j(f,1,1,()=>{f=null}),O()),(!b||E[0]&16&&u!==(u="dropzone-interface-text "+h[4]))&&p(i,"class",u),(!b||E[0]&264&&_!==(_="dropzone-interface "+h[8]+" "+h[3]))&&p(n,"class",_),(!b||E[0]&1024&&v!==(v="dropzone "+h[10]))&&p(e,"class",v),(!b||E[0]&5120)&&K(e,"opacity-50",h[12].disabled)},i(h){b||(M(d),M(P,h),M(f),b=!0)},o(h){j(d),j(P,h),j(f),b=!1},d(h){h&&I(e),s[32](null),d&&d.d(),P&&P.d(h),f&&f.d(),T=!1,Ue(y)}}}const nt="textarea relative flex justify-center items-center",at="w-full absolute top-0 left-0 right-0 bottom-0 z-[1] opacity-0 disabled:!opacity-0 cursor-pointer",it="flex justify-center items-center text-center";function rt(s,e,t){let l,a,n;const i=["files","fileInput","name","border","padding","rounded","regionInterface","regionInterfaceText","slotLead","slotMessage","slotMeta"];let o=de(e,i),{$$slots:m={},$$scope:g}=e;const z=Ge(m);let{files:u=void 0}=e,{fileInput:_=void 0}=e,{name:v}=e,{border:b="border-2 border-dashed"}=e,{padding:T="p-4 py-8"}=e,{rounded:y="rounded-container-token"}=e,{regionInterface:V=""}=e,{regionInterfaceText:r=""}=e,{slotLead:d="mb-4"}=e,{slotMessage:k=""}=e,{slotMeta:w="opacity-75"}=e;function P(){return delete o.class,o}function f(c){F.call(this,s,c)}function h(c){F.call(this,s,c)}function E(c){F.call(this,s,c)}function W(c){F.call(this,s,c)}function N(c){F.call(this,s,c)}function B(c){F.call(this,s,c)}function G(c){F.call(this,s,c)}function se(c){F.call(this,s,c)}function ke(c){F.call(this,s,c)}function Ie(c){F.call(this,s,c)}function Te(c){F.call(this,s,c)}function ye(c){F.call(this,s,c)}function Ee(){u=this.files,t(0,u)}function we(c){ze[c?"unshift":"push"](()=>{_=c,t(1,_)})}return s.$$set=c=>{t(33,e=Q(Q({},e),me(c))),t(12,o=de(e,i)),"files"in c&&t(0,u=c.files),"fileInput"in c&&t(1,_=c.fileInput),"name"in c&&t(2,v=c.name),"border"in c&&t(14,b=c.border),"padding"in c&&t(15,T=c.padding),"rounded"in c&&t(16,y=c.rounded),"regionInterface"in c&&t(3,V=c.regionInterface),"regionInterfaceText"in c&&t(4,r=c.regionInterfaceText),"slotLead"in c&&t(5,d=c.slotLead),"slotMessage"in c&&t(6,k=c.slotMessage),"slotMeta"in c&&t(7,w=c.slotMeta),"$$scope"in c&&t(17,g=c.$$scope)},s.$$.update=()=>{t(10,l=`${nt} ${b} ${T} ${y} ${e.class??""}`)},t(9,a=`${at}`),t(8,n=`${it}`),e=me(e),[u,_,v,V,r,d,k,w,n,a,l,P,o,z,b,T,y,g,m,f,h,E,W,N,B,G,se,ke,Ie,Te,ye,Ee,we]}class ot extends ie{constructor(e){super(),re(this,e,rt,lt,ae,{files:0,fileInput:1,name:2,border:14,padding:15,rounded:16,regionInterface:3,regionInterfaceText:4,slotLead:5,slotMessage:6,slotMeta:7},null,[-1,-1])}}function Ne(s){let e,t;const l=s[22].default,a=_e(l,s,s[21],null);return{c(){e=L("div"),a&&a.c(),this.h()},l(n){e=D(n,"DIV",{class:!0});var i=A(e);a&&a.l(i),i.forEach(I),this.h()},h(){p(e,"class","slide-toggle-text ml-3")},m(n,i){C(n,e,i),a&&a.m(e,null),t=!0},p(n,i){a&&a.p&&(!t||i[0]&2097152)&&ve(a,l,n,n[21],t?pe(l,n[21],i,null):be(n[21]),null)},i(n){t||(M(a,n),t=!0)},o(n){j(a,n),t=!1},d(n){n&&I(e),a&&a.d(n)}}}function ct(s){let e,t,l,a,n,i,o,m,g,z,u,_,v,b,T,y=[{type:"checkbox"},{class:"slide-toggle-input hidden"},{name:s[1]},s[8](),{disabled:a=s[9].disabled}],V={};for(let d=0;d<y.length;d+=1)V=Q(V,y[d]);let r=s[10].default&&Ne(s);return{c(){e=L("div"),t=L("label"),l=L("input"),n=H(),i=L("div"),o=L("div"),z=H(),r&&r.c(),this.h()},l(d){e=D(d,"DIV",{id:!0,class:!0,"data-testid":!0,role:!0,"aria-label":!0,"aria-checked":!0,tabindex:!0});var k=A(e);t=D(k,"LABEL",{class:!0});var w=A(t);l=D(w,"INPUT",{type:!0,class:!0,name:!0}),n=U(w),i=D(w,"DIV",{class:!0});var P=A(i);o=D(P,"DIV",{class:!0}),A(o).forEach(I),P.forEach(I),z=U(w),r&&r.l(w),w.forEach(I),k.forEach(I),this.h()},h(){ue(l,V),p(o,"class",m="slide-toggle-thumb "+s[3]),K(o,"cursor-not-allowed",s[9].disabled),p(i,"class",g="slide-toggle-track "+s[4]),K(i,"cursor-not-allowed",s[9].disabled),p(t,"class",u="slide-toggle-label "+s[5]),p(e,"id",s[2]),p(e,"class",_="slide-toggle "+s[6]),p(e,"data-testid","slide-toggle"),p(e,"role","switch"),p(e,"aria-label",s[2]),p(e,"aria-checked",s[0]),p(e,"tabindex","0")},m(d,k){C(d,e,k),S(e,t),S(t,l),l.autofocus&&l.focus(),l.checked=s[0],S(t,n),S(t,i),S(i,o),S(t,z),r&&r.m(t,null),v=!0,b||(T=[R(l,"change",s[31]),R(l,"click",s[23]),R(l,"keydown",s[24]),R(l,"keyup",s[25]),R(l,"keypress",s[26]),R(l,"mouseover",s[27]),R(l,"change",s[28]),R(l,"focus",s[29]),R(l,"blur",s[30]),R(e,"keydown",s[7])],b=!0)},p(d,k){ue(l,V=Qe(y,[{type:"checkbox"},{class:"slide-toggle-input hidden"},(!v||k[0]&2)&&{name:d[1]},d[8](),(!v||k[0]&512&&a!==(a=d[9].disabled))&&{disabled:a}])),k[0]&1&&(l.checked=d[0]),(!v||k[0]&8&&m!==(m="slide-toggle-thumb "+d[3]))&&p(o,"class",m),(!v||k[0]&520)&&K(o,"cursor-not-allowed",d[9].disabled),(!v||k[0]&16&&g!==(g="slide-toggle-track "+d[4]))&&p(i,"class",g),(!v||k[0]&528)&&K(i,"cursor-not-allowed",d[9].disabled),d[10].default?r?(r.p(d,k),k[0]&1024&&M(r,1)):(r=Ne(d),r.c(),M(r,1),r.m(t,null)):r&&(q(),j(r,1,1,()=>{r=null}),O()),(!v||k[0]&32&&u!==(u="slide-toggle-label "+d[5]))&&p(t,"class",u),(!v||k[0]&4)&&p(e,"id",d[2]),(!v||k[0]&64&&_!==(_="slide-toggle "+d[6]))&&p(e,"class",_),(!v||k[0]&4)&&p(e,"aria-label",d[2]),(!v||k[0]&1)&&p(e,"aria-checked",d[0])},i(d){v||(M(r),v=!0)},o(d){j(r),v=!1},d(d){d&&I(e),r&&r.d(),b=!1,Ue(T)}}}const ft="inline-block",ut="unstyled flex items-center",dt="flex transition-all duration-[200ms] cursor-pointer",mt="w-[50%] h-full scale-[0.8] transition-all duration-[200ms] shadow";function ht(s,e,t){let l,a,n,i,o,m,g,z;const u=["name","checked","size","background","active","border","rounded","label"];let _=de(e,u),{$$slots:v={},$$scope:b}=e;const T=Ge(v),y=Je();let{name:V}=e,{checked:r=!1}=e,{size:d="md"}=e,{background:k="bg-surface-400 dark:bg-surface-700"}=e,{active:w="bg-surface-900 dark:bg-surface-300"}=e,{border:P=""}=e,{rounded:f="rounded-full"}=e,{label:h=""}=e,E;switch(d){case"sm":E="w-12 h-6";break;case"lg":E="w-20 h-10";break;default:E="w-16 h-8"}function W(c){["Enter","Space"].includes(c.code)&&(c.preventDefault(),y("keyup",c),c.currentTarget.firstChild.click())}function N(){return delete _.class,_}function B(c){F.call(this,s,c)}function G(c){F.call(this,s,c)}function se(c){F.call(this,s,c)}function ke(c){F.call(this,s,c)}function Ie(c){F.call(this,s,c)}function Te(c){F.call(this,s,c)}function ye(c){F.call(this,s,c)}function Ee(c){F.call(this,s,c)}function we(){r=this.checked,t(0,r)}return s.$$set=c=>{t(9,e=Q(Q({},e),me(c))),t(33,_=de(e,u)),"name"in c&&t(1,V=c.name),"checked"in c&&t(0,r=c.checked),"size"in c&&t(11,d=c.size),"background"in c&&t(12,k=c.background),"active"in c&&t(13,w=c.active),"border"in c&&t(14,P=c.border),"rounded"in c&&t(15,f=c.rounded),"label"in c&&t(2,h=c.label),"$$scope"in c&&t(21,b=c.$$scope)},s.$$.update=()=>{s.$$.dirty[0]&12289&&t(19,l=r?w:`${k} cursor-pointer`),s.$$.dirty[0]&1&&t(18,a=r?"bg-white/75":"bg-white"),s.$$.dirty[0]&1&&t(17,n=r?"translate-x-full":""),t(20,i=e.disabled===!0?"opacity-50":"hover:brightness-[105%] dark:hover:brightness-110 cursor-pointer"),t(6,o=`${ft} ${f} ${i} ${e.class??""}`),s.$$.dirty[0]&638976&&t(4,g=`${dt} ${P} ${f} ${E} ${l}`),s.$$.dirty[0]&425984&&t(3,z=`${mt} ${f} ${a} ${n}`)},t(5,m=`${ut}`),e=me(e),[r,V,h,z,g,m,o,W,N,e,T,d,k,w,P,f,E,n,a,l,i,b,v,B,G,se,ke,Ie,Te,ye,Ee,we]}class gt extends ie{constructor(e){super(),re(this,e,ht,ct,ae,{name:1,checked:0,size:11,background:12,active:13,border:14,rounded:15,label:2},null,[-1,-1])}}const ge=s=>s.replace(/\.[^/.]+$/,"");function _t(s){let e,t=s[0]?"Treatment":"Control",l,a;return{c(){e=L("span"),l=Z(t),this.h()},l(n){e=D(n,"SPAN",{class:!0});var i=A(e);l=J(i,t),i.forEach(I),this.h()},h(){p(e,"class",a=`chip ${s[0]?"variant-soft-primary":"variant-soft-surface"}`)},m(n,i){C(n,e,i),S(e,l)},p(n,i){i&1&&t!==(t=n[0]?"Treatment":"Control")&&he(l,t),i&1&&a!==(a=`chip ${n[0]?"variant-soft-primary":"variant-soft-surface"}`)&&p(e,"class",a)},d(n){n&&I(e)}}}function vt(s){let e,t,l,a,n=ge(s[1])+"",i,o,m,g,z,u,_,v='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"></path></svg>',b,T,y;function V(d){s[4](d)}let r={active:"variant-soft-primary",size:"sm",class:"mr-2",name:"slide",$$slots:{default:[_t]},$$scope:{ctx:s}};return s[0]!==void 0&&(r.checked=s[0]),g=new gt({props:r}),ze.push(()=>Ke(g,"checked",V)),g.$on("change",s[5]),{c(){e=L("div"),t=L("div"),l=L("div"),a=L("p"),i=Z(n),o=H(),m=L("div"),x(g.$$.fragment),u=H(),_=L("button"),_.innerHTML=v,this.h()},l(d){e=D(d,"DIV",{class:!0});var k=A(e);t=D(k,"DIV",{class:!0});var w=A(t);l=D(w,"DIV",{class:!0});var P=A(l);a=D(P,"P",{class:!0});var f=A(a);i=J(f,n),f.forEach(I),o=U(P),m=D(P,"DIV",{class:!0});var h=A(m);$(g.$$.fragment,h),u=U(h),_=D(h,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),Y(_)!=="svelte-1m0ck3b"&&(_.innerHTML=v),h.forEach(I),P.forEach(I),w.forEach(I),k.forEach(I),this.h()},h(){p(a,"class","text-lg"),p(_,"type","button"),p(_,"class","btn-icon hover:variant-ringed-tertiary"),p(m,"class","flex justify-between items-center min-w-64"),p(l,"class","flex flex-col space-y-2 w-full"),p(t,"class","flex justify-center items-center space-x-2"),p(e,"class","card p-4")},m(d,k){C(d,e,k),S(e,t),S(t,l),S(l,a),S(a,i),S(l,o),S(l,m),ee(g,m,null),S(m,u),S(m,_),b=!0,T||(y=R(_,"click",function(){qe(s[2])&&s[2].apply(this,arguments)}),T=!0)},p(d,[k]){s=d,(!b||k&2)&&n!==(n=ge(s[1])+"")&&he(i,n);const w={};k&65&&(w.$$scope={dirty:k,ctx:s}),!z&&k&1&&(z=!0,w.checked=s[0],Oe(()=>z=!1)),g.$set(w)},i(d){b||(M(g.$$.fragment,d),b=!0)},o(d){j(g.$$.fragment,d),b=!1},d(d){d&&I(e),te(g),T=!1,y()}}}function bt(s,e,t){let{filename:l}=e,{onRemove:a}=e,{onToggle:n}=e,{isTreatment:i=!1}=e;function o(g){i=g,t(0,i)}const m=()=>n(i);return s.$$set=g=>{"filename"in g&&t(1,l=g.filename),"onRemove"in g&&t(2,a=g.onRemove),"onToggle"in g&&t(3,n=g.onToggle),"isTreatment"in g&&t(0,i=g.isTreatment)},[i,l,a,n,o,m]}class pt extends ie{constructor(e){super(),re(this,e,bt,vt,ae,{filename:1,onRemove:2,onToggle:3,isTreatment:0})}}function kt(s){let e,t,l,a,n=ge(s[0])+"",i,o,m,g,z,u,_,v,b='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"></path></svg>',T,y;return{c(){e=L("div"),t=L("div"),l=L("div"),a=L("p"),i=Z(n),o=H(),m=L("div"),g=L("span"),z=Z(s[2]),_=H(),v=L("button"),v.innerHTML=b,this.h()},l(V){e=D(V,"DIV",{class:!0});var r=A(e);t=D(r,"DIV",{class:!0});var d=A(t);l=D(d,"DIV",{class:!0});var k=A(l);a=D(k,"P",{class:!0});var w=A(a);i=J(w,n),w.forEach(I),o=U(k),m=D(k,"DIV",{class:!0});var P=A(m);g=D(P,"SPAN",{class:!0});var f=A(g);z=J(f,s[2]),f.forEach(I),_=U(P),v=D(P,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),Y(v)!=="svelte-1m0ck3b"&&(v.innerHTML=b),P.forEach(I),k.forEach(I),d.forEach(I),r.forEach(I),this.h()},h(){p(a,"class","text-lg"),p(g,"class",u=`chip ${s[3]}`),p(v,"type","button"),p(v,"class","btn-icon hover:variant-ringed-tertiary"),p(m,"class","flex justify-between items-center min-w-64"),p(l,"class","flex flex-col space-y-2 w-full"),p(t,"class","flex justify-center items-center space-x-2"),p(e,"class","card p-4")},m(V,r){C(V,e,r),S(e,t),S(t,l),S(l,a),S(a,i),S(l,o),S(l,m),S(m,g),S(g,z),S(m,_),S(m,v),T||(y=R(v,"click",function(){qe(s[1])&&s[1].apply(this,arguments)}),T=!0)},p(V,[r]){s=V,r&1&&n!==(n=ge(s[0])+"")&&he(i,n),r&4&&he(z,s[2]),r&8&&u!==(u=`chip ${s[3]}`)&&p(g,"class",u)},i:X,o:X,d(V){V&&I(e),T=!1,y()}}}function It(s,e,t){let{filename:l}=e,{onRemove:a}=e,{type:n}=e,{chip:i="variant-soft-success"}=e;return s.$$set=o=>{"filename"in o&&t(0,l=o.filename),"onRemove"in o&&t(1,a=o.onRemove),"type"in o&&t(2,n=o.type),"chip"in o&&t(3,i=o.chip)},[l,a,n,i]}class Ze extends ie{constructor(e){super(),re(this,e,It,kt,ae,{filename:0,onRemove:1,type:2,chip:3})}}function Tt(s){const e=s.split(`
`),t=["##gff-version 3"],l=[];let a="",n=!1,i=null;const o=[];let m="";const g=u=>{let _="+";u.startsWith("complement(")&&(_="-",u=u.replace("complement(","").replace(")",""));const[v,b]=u.split("..");return{start:parseInt(v,10),end:parseInt(b,10),strand:_}},z=()=>{if(m&&a){l.push(`>${m}`);for(let u=0;u<a.length;u+=60)l.push(a.slice(u,u+60));o.forEach(u=>{u.attributes.gene?u.attributes.Name=u.attributes.gene:u.attributes.product?u.attributes.Name=u.attributes.product:u.attributes.note&&(u.attributes.Name=u.attributes.note),u.type==="source"&&(u.attributes.Name=u.attributes.organism);const _=Object.entries(u.attributes||{}).map(([v,b])=>`${v}=${b.replace('"',"")}`).join(";");t.push(`${m}	diana	${u.type}	${u.start}	${u.end}	.	${u.strand}	.	${_}`)}),a="",n=!1,i=null,m="",o.length=0}};return e.forEach(u=>{if(u.startsWith("LOCUS"))z(),m=u.split(/\s+/)[1];else if(!u.startsWith("FEATURES"))if(u.startsWith("ORIGIN"))n=!0;else if(n)a+=u.replace(/[^a-zA-Z]/g,"");else if(u.trim().startsWith("CDS")||u.trim().startsWith("gene")||u.trim().startsWith("source")){const _=u.trim().split(/\s+/,2);if(_.length===2){const v=_[0],b=_[1],{start:T,end:y,strand:V}=g(b);i&&o.push(i),i={type:v,start:T,end:y,strand:V,attributes:{}}}}else if(i&&u.trim().startsWith("/")){const _=u.trim().match(/^\/(\S+?)=(?:"(.+?)"|(.+))/);if(_){const[,v,b,T]=_,y=b||T||"";i.attributes[v]=y}}else if(i&&/^\s+[^/]/.test(u)){const _=Object.keys(i.attributes).pop();_&&(i.attributes[_]+=u.trim())}else console.log("Unhandled line:",u)}),z(),{gff:t.join(`
`),fasta:l.join(`
`)}}async function yt(s,e,t=5e4){const l=[];l.push(`variableStep chrom=${e}`);const a=s.split(`
`);for(let n=0;n<a.length;n+=t)a.slice(n,n+t).forEach((o,m)=>{let[g,z]=o.split(/\s+/).map(u=>parseInt(u,10));isNaN(z)&&(z=0),isNaN(g)&&(g=0),g!==0&&l.push(`${n+m} ${g}`),z!==0&&l.push(`${n+m} -${z}`)}),await new Promise(o=>setTimeout(o,0));return l.join(`
`)}function Re(s,e,t){const l=s.slice();return l[11]=e[t][0],l[12]=e[t][1].isTreatment,l[14]=t,l}function je(s){let e,t,l;return t=new Ze({props:{type:"Reference",filename:s[3].filename,onRemove:ne.reset}}),{c(){e=L("div"),x(t.$$.fragment),this.h()},l(a){e=D(a,"DIV",{class:!0});var n=A(e);$(t.$$.fragment,n),n.forEach(I),this.h()},h(){p(e,"class","m-2 w-full md:w-auto")},m(a,n){C(a,e,n),ee(t,e,null),l=!0},p(a,n){const i={};n&8&&(i.filename=a[3].filename),t.$set(i)},i(a){l||(M(t.$$.fragment,a),l=!0)},o(a){j(t.$$.fragment,a),l=!1},d(a){a&&I(e),te(t)}}}function Ce(s){let e,t,l;return t=new Ze({props:{type:"Annotations",chip:"variant-soft-warning",filename:s[2].filename,onRemove:fe.reset}}),{c(){e=L("div"),x(t.$$.fragment),this.h()},l(a){e=D(a,"DIV",{class:!0});var n=A(e);$(t.$$.fragment,n),n.forEach(I),this.h()},h(){p(e,"class","m-2 w-full md:w-auto")},m(a,n){C(a,e,n),ee(t,e,null),l=!0},p(a,n){const i={};n&4&&(i.filename=a[2].filename),t.$set(i)},i(a){l||(M(t.$$.fragment,a),l=!0)},o(a){j(t.$$.fragment,a),l=!1},d(a){a&&I(e),te(t)}}}function Fe(s){let e,t,l,a;function n(...o){return s[6](s[11],...o)}function i(){return s[7](s[11])}return t=new pt({props:{isTreatment:s[12],onToggle:n,onRemove:i,filename:s[11]}}),{c(){e=L("div"),x(t.$$.fragment),l=H(),this.h()},l(o){e=D(o,"DIV",{class:!0});var m=A(e);$(t.$$.fragment,m),l=U(m),m.forEach(I),this.h()},h(){p(e,"class","m-2 w-full md:w-auto ")},m(o,m){C(o,e,m),ee(t,e,null),S(e,l),a=!0},p(o,m){s=o;const g={};m&16&&(g.isTreatment=s[12]),m&16&&(g.onToggle=n),m&16&&(g.onRemove=i),m&16&&(g.filename=s[11]),t.$set(g)},i(o){a||(M(t.$$.fragment,o),a=!0)},o(o){j(t.$$.fragment,o),a=!1},d(o){o&&I(e),te(t)}}}function Et(s){let e,t,l;function a(i){s[8](i)}let n={padding:"py-4",name:"files",multiple:!0,$$slots:{meta:[zt],message:[Dt],lead:[Lt]},$$scope:{ctx:s}};return s[0]!==void 0&&(n.files=s[0]),e=new ot({props:n}),ze.push(()=>Ke(e,"files",a)),e.$on("change",s[5]),e.$on("click",Be),e.$on("drop",Be),{c(){x(e.$$.fragment)},l(i){$(e.$$.fragment,i)},m(i,o){ee(e,i,o),l=!0},p(i,o){const m={};o&32768&&(m.$$scope={dirty:o,ctx:i}),!t&&o&1&&(t=!0,m.files=i[0],Oe(()=>t=!1)),e.$set(m)},i(i){l||(M(e.$$.fragment,i),l=!0)},o(i){j(e.$$.fragment,i),l=!1},d(i){te(e,i)}}}function wt(s){let e,t,l;return t=new xe({props:{value:void 0,width:"w-16",strokeLinecap:"round"}}),{c(){e=L("div"),x(t.$$.fragment),this.h()},l(a){e=D(a,"DIV",{class:!0});var n=A(e);$(t.$$.fragment,n),n.forEach(I),this.h()},h(){p(e,"class","flex items-center justify-center align-middle")},m(a,n){C(a,e,n),ee(t,e,null),l=!0},p:X,i(a){l||(M(t.$$.fragment,a),l=!0)},o(a){j(t.$$.fragment,a),l=!1},d(a){a&&I(e),te(t)}}}function Lt(s){let e,t='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-8"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m3.75 9v6m3-3H9m1.5-12H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"></path></svg>';return{c(){e=L("div"),e.innerHTML=t,this.h()},l(l){e=D(l,"DIV",{class:!0,"data-svelte-h":!0}),Y(e)!=="svelte-stz8rw"&&(e.innerHTML=t),this.h()},h(){p(e,"class","flex justify-center")},m(l,a){C(l,e,a)},p:X,d(l){l&&I(e)}}}function Dt(s){let e,t='<span class="font-semibold">Load files</span> or drag and drop';return{c(){e=L("p"),e.innerHTML=t,this.h()},l(l){e=D(l,"P",{class:!0,"data-svelte-h":!0}),Y(e)!=="svelte-10rbgmq"&&(e.innerHTML=t),this.h()},h(){p(e,"class","text-xl ")},m(l,a){C(l,e,a)},p:X,d(l){l&&I(e)}}}function zt(s){let e;return{c(){e=Z("GENBANK, GFF, FASTA, WIG and UserPlot files allowed.")},l(t){e=J(t,"GENBANK, GFF, FASTA, WIG and UserPlot files allowed.")},m(t,l){C(t,e,l)},d(t){t&&I(e)}}}function St(s){let e,t='<div class="flex flex-col items-center align-baseline justify-center max-w-4xl space-y-8 "><figure class="card-hover rounded-full svelte-ppo8by"><div><section class="img-bg svelte-ppo8by"></section></div> <img class="logo-img mt-8 svelte-ppo8by" src="/images/logo2.png" alt="Skeleton Logo"/></figure> <h1 class="text-center text-3xl mx-2">Transposon Sequencing Data Visualiser</h1></div>',l,a,n,i,o,m,g,z,u,_,v,b,T=s[3].filename&&je(s),y=s[2].filename&&Ce(s),V=Se(Array.from(s[4].entries()).sort(He)),r=[];for(let f=0;f<V.length;f+=1)r[f]=Fe(Re(s,V,f));const d=f=>j(r[f],1,1,()=>{r[f]=null}),k=[wt,Et],w=[];function P(f,h){return f[1]?0:1}return _=P(s),v=w[_]=k[_](s),{c(){e=L("div"),e.innerHTML=t,l=H(),a=L("div"),n=L("div"),T&&T.c(),i=H(),y&&y.c(),o=H(),m=L("div");for(let f=0;f<r.length;f+=1)r[f].c();g=H(),z=L("div"),u=L("div"),v.c(),this.h()},l(f){e=D(f,"DIV",{class:!0,"data-svelte-h":!0}),Y(e)!=="svelte-kcnmyh"&&(e.innerHTML=t),l=U(f),a=D(f,"DIV",{class:!0});var h=A(a);n=D(h,"DIV",{class:!0});var E=A(n);T&&T.l(E),i=U(E),y&&y.l(E),E.forEach(I),o=U(h),m=D(h,"DIV",{class:!0});var W=A(m);for(let G=0;G<r.length;G+=1)r[G].l(W);W.forEach(I),h.forEach(I),g=U(f),z=D(f,"DIV",{class:!0});var N=A(z);u=D(N,"DIV",{class:!0});var B=A(u);v.l(B),B.forEach(I),N.forEach(I),this.h()},h(){p(e,"class","flex justify-center mb-6"),p(n,"class","flex flex-wrap justify-center w-full"),p(m,"class","flex flex-wrap justify-center "),p(a,"class","flex flex-col justify-center items-center mb-6"),p(u,"class","w-full max-w-3xl mx-4 mb-4"),p(z,"class","flex justify-center ")},m(f,h){C(f,e,h),C(f,l,h),C(f,a,h),S(a,n),T&&T.m(n,null),S(n,i),y&&y.m(n,null),S(a,o),S(a,m);for(let E=0;E<r.length;E+=1)r[E]&&r[E].m(m,null);C(f,g,h),C(f,z,h),S(z,u),w[_].m(u,null),b=!0},p(f,[h]){if(f[3].filename?T?(T.p(f,h),h&8&&M(T,1)):(T=je(f),T.c(),M(T,1),T.m(n,i)):T&&(q(),j(T,1,1,()=>{T=null}),O()),f[2].filename?y?(y.p(f,h),h&4&&M(y,1)):(y=Ce(f),y.c(),M(y,1),y.m(n,null)):y&&(q(),j(y,1,1,()=>{y=null}),O()),h&16){V=Se(Array.from(f[4].entries()).sort(He));let W;for(W=0;W<V.length;W+=1){const N=Re(f,V,W);r[W]?(r[W].p(N,h),M(r[W],1)):(r[W]=Fe(N),r[W].c(),M(r[W],1),r[W].m(m,null))}for(q(),W=V.length;W<r.length;W+=1)d(W);O()}let E=_;_=P(f),_===E?w[_].p(f,h):(q(),j(w[E],1,1,()=>{w[E]=null}),O(),v=w[_],v?v.p(f,h):(v=w[_]=k[_](f),v.c()),M(v,1),v.m(u,null))},i(f){if(!b){M(T),M(y);for(let h=0;h<V.length;h+=1)M(r[h]);M(v),b=!0}},o(f){j(T),j(y),r=r.filter(Boolean);for(let h=0;h<r.length;h+=1)j(r[h]);j(v),b=!1},d(f){f&&(I(e),I(l),I(a),I(g),I(z)),T&&T.d(),y&&y.d(),Xe(r,f),w[_].d()}}}function Vt(s){const e=s.split(`
`);let t="",l="",a=!1;for(const n of e){if(n.startsWith("##")&&n.includes("FASTA")){a=!0;continue}a&&(n.startsWith(">")?(l&&(t+=l+`
`),l=n+`
`):l+=n.trim())}return l&&(t+=l+`
`),t.trim()}function Be(){const s=document.getElementsByName("files")[0];s.value=""}const He=([s],[e])=>s.localeCompare(e);function Wt(s,e,t){let l,a,n,i;oe(s,fe,b=>t(2,l=b)),oe(s,ce,b=>t(9,a=b)),oe(s,ne,b=>t(3,n=b)),oe(s,le,b=>t(4,i=b));const o=Ye();let m,g=!1;function z(b){if(!m||m.length===0)return;t(1,g=!0);let T=[];for(let y=0;y<m.length;y++){const V=m[y],r=V.name,d=new FileReader;T.push(new Promise((k,w)=>{d.onload=async P=>{var h,E;let f=(E=(h=P.target)==null?void 0:h.result)==null?void 0:E.toString();if(r.endsWith(".gb")||r.endsWith(".gbk")||r.endsWith(".genbank")){const{gff:W,fasta:N}=Tt(f);await fe.load(r,W),Le(ce,a.locus=void 0,a),N.length>0&&(await ne.load(r,N).catch(B=>{console.error("Error loading reference:",B);const se={message:"Error loading reference: "+B,background:"variant-glass-error"};o.trigger(se)}),await De.load(N),k(0))}else if(r.endsWith(".gff")||r.endsWith(".gff3")){await fe.load(r,f),Le(ce,a.locus=void 0,a);const W=Vt(f);W.length>0&&(await ne.load(r,W).catch(N=>{console.error("Error loading reference:",N);const G={message:"Error loading reference: "+N,background:"variant-glass-error"};o.trigger(G)}),await De.load(W),k(0))}else if(r.endsWith(".fasta")||r.endsWith(".fa")||r.endsWith(".fna"))await ne.load(r,f),await De.load(f),Le(ce,a.locus=void 0,a),k(0);else if(r.endsWith(".wig")||r.endsWith(".wiggle"))await le.load(r,f),k(0);else if(r.endsWith(".userplot")||r.endsWith(".plot")){const W=l.chromosomes.keys().next().value;if(W){const N={message:`Converting UserPlot file '${r}' to Wig Format. Assuming the first chromosome in the annotations is the reference chromosome`,background:"variant-glass-warning"};o.trigger(N);const B=await yt(f,W);await le.load(r,B),k(0)}else{console.error("No chromosome found in annotations");const B={message:"Please load annotations before loading userplot files",background:"variant-glass-error"};o.trigger(B),w("No chromosome found in annotations")}}else{console.error("Unsupported file type:",r);const N={message:"Unsupported file type: "+r,background:"variant-glass-error"};o.trigger(N),w("Unsupported file type: "+r)}k(0)},d.onerror=w,d.readAsText(V)}))}Promise.all(T).then(y=>{t(1,g=!1)}).catch(y=>{console.error("Error reading files:",y),t(1,g=!1)})}const u=(b,T)=>le.setIsTreatment(b,T),_=b=>le.remove(b);function v(b){m=b,t(0,m)}return[m,g,l,n,i,z,u,_,v]}class Ot extends ie{constructor(e){super(),re(this,e,Wt,St,ae,{})}}export{Ot as component};
