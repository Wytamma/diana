import{s as ae,y as Q,A as _e,e as z,a as H,c as D,b as A,g as G,f as I,O as ue,m as v,v as Z,i as B,h as V,P as M,B as ve,C as be,D as pe,J as Ge,Q as de,w as Ue,z as me,R as C,F as De,t as J,l as x,d as X,n as Y,aa as Je,L as qe,j as he,G as Oe,I as Xe,k as oe,S as Le}from"../chunks/scheduler.Ctx98Cov.js";import{S as ie,i as re,t as P,g as O,a as j,c as K,f as Ke,b as $,d as ee,m as te,e as se}from"../chunks/index.DzosD7qk.js";import{e as Se}from"../chunks/each.tnL4mEXE.js";import{g as Ye}from"../chunks/stores.CA_mewrb.js";import"../chunks/ProgressBar.svelte_svelte_type_style_lang.HlYL--rL.js";import{g as Ze}from"../chunks/spread.CN4WR7uZ.js";import{P as xe}from"../chunks/ProgressRadial.XZQD61kG.js";import{a as fe}from"../chunks/annotationStore.Dn3m1aBo.js";import{i as le}from"../chunks/insertStore.MaCQ88it.js";import{t as ze}from"../chunks/TAStore.BMmLN0sp.js";import{r as ne}from"../chunks/refStore.BhAY7eVF.js";import{i as ce}from"../chunks/igvStore.BTHXzOeg.js";const $e=s=>({}),Ve=s=>({}),et=s=>({}),We=s=>({}),tt=s=>({}),Ne=s=>({});function Ae(s){let e,t,l;const a=s[18].lead,n=_e(a,s,s[17],Ne);return{c(){e=z("div"),n&&n.c(),this.h()},l(i){e=D(i,"DIV",{class:!0});var o=A(e);n&&n.l(o),o.forEach(I),this.h()},h(){v(e,"class",t="dropzone-lead "+s[5])},m(i,o){B(i,e,o),n&&n.m(e,null),l=!0},p(i,o){n&&n.p&&(!l||o[0]&131072)&&ve(n,a,i,i[17],l?pe(a,i[17],o,tt):be(i[17]),Ne),(!l||o[0]&32&&t!==(t="dropzone-lead "+i[5]))&&v(e,"class",t)},i(i){l||(P(n,i),l=!0)},o(i){j(n,i),l=!1},d(i){i&&I(e),n&&n.d(i)}}}function st(s){let e,t="Upload a file",l;return{c(){e=z("strong"),e.textContent=t,l=J(" or drag and drop")},l(a){e=D(a,"STRONG",{"data-svelte-h":!0}),x(e)!=="svelte-13uz6lq"&&(e.textContent=t),l=X(a," or drag and drop")},m(a,n){B(a,e,n),B(a,l,n)},p:Y,d(a){a&&(I(e),I(l))}}}function Pe(s){let e,t,l;const a=s[18].meta,n=_e(a,s,s[17],Ve);return{c(){e=z("small"),n&&n.c(),this.h()},l(i){e=D(i,"SMALL",{class:!0});var o=A(e);n&&n.l(o),o.forEach(I),this.h()},h(){v(e,"class",t="dropzone-meta "+s[7])},m(i,o){B(i,e,o),n&&n.m(e,null),l=!0},p(i,o){n&&n.p&&(!l||o[0]&131072)&&ve(n,a,i,i[17],l?pe(a,i[17],o,$e):be(i[17]),Ve),(!l||o[0]&128&&t!==(t="dropzone-meta "+i[7]))&&v(e,"class",t)},i(i){l||(P(n,i),l=!0)},o(i){j(n,i),l=!1},d(i){i&&I(e),n&&n.d(i)}}}function lt(s){let e,t,l,a,n,i,o,m,g,w,L,T,c,_,b,p,S=[{type:"file"},{name:s[2]},{class:l="dropzone-input "+s[9]},s[11]()],r={};for(let h=0;h<S.length;h+=1)r=Q(r,S[h]);let d=s[13].lead&&Ae(s);const k=s[18].message,E=_e(k,s,s[17],We),N=E||st();let u=s[13].meta&&Pe(s);return{c(){e=z("div"),t=z("input"),a=H(),n=z("div"),i=z("div"),d&&d.c(),o=H(),m=z("div"),N&&N.c(),w=H(),u&&u.c(),this.h()},l(h){e=D(h,"DIV",{class:!0,"data-testid":!0});var y=A(e);t=D(y,"INPUT",{type:!0,name:!0,class:!0}),a=G(y),n=D(y,"DIV",{class:!0});var W=A(n);i=D(W,"DIV",{class:!0});var F=A(i);d&&d.l(F),o=G(F),m=D(F,"DIV",{class:!0});var R=A(m);N&&N.l(R),R.forEach(I),w=G(F),u&&u.l(F),F.forEach(I),W.forEach(I),y.forEach(I),this.h()},h(){ue(t,r),v(m,"class",g="dropzone-message "+s[6]),v(i,"class",L="dropzone-interface-text "+s[4]),v(n,"class",T="dropzone-interface "+s[8]+" "+s[3]),v(e,"class",c="dropzone "+s[10]),v(e,"data-testid","file-dropzone"),Z(e,"opacity-50",s[12].disabled)},m(h,y){B(h,e,y),V(e,t),t.autofocus&&t.focus(),s[32](t),V(e,a),V(e,n),V(n,i),d&&d.m(i,null),V(i,o),V(i,m),N&&N.m(m,null),V(i,w),u&&u.m(i,null),_=!0,b||(p=[M(t,"change",s[31]),M(t,"change",s[19]),M(t,"dragenter",s[20]),M(t,"dragover",s[21]),M(t,"dragleave",s[22]),M(t,"drop",s[23]),M(t,"click",s[24]),M(t,"keydown",s[25]),M(t,"keyup",s[26]),M(t,"keypress",s[27]),M(t,"focus",s[28]),M(t,"focusin",s[29]),M(t,"focusout",s[30])],b=!0)},p(h,y){ue(t,r=Ze(S,[{type:"file"},(!_||y[0]&4)&&{name:h[2]},(!_||y[0]&512&&l!==(l="dropzone-input "+h[9]))&&{class:l},h[11]()])),h[13].lead?d?(d.p(h,y),y[0]&8192&&P(d,1)):(d=Ae(h),d.c(),P(d,1),d.m(i,o)):d&&(O(),j(d,1,1,()=>{d=null}),K()),E&&E.p&&(!_||y[0]&131072)&&ve(E,k,h,h[17],_?pe(k,h[17],y,et):be(h[17]),We),(!_||y[0]&64&&g!==(g="dropzone-message "+h[6]))&&v(m,"class",g),h[13].meta?u?(u.p(h,y),y[0]&8192&&P(u,1)):(u=Pe(h),u.c(),P(u,1),u.m(i,null)):u&&(O(),j(u,1,1,()=>{u=null}),K()),(!_||y[0]&16&&L!==(L="dropzone-interface-text "+h[4]))&&v(i,"class",L),(!_||y[0]&264&&T!==(T="dropzone-interface "+h[8]+" "+h[3]))&&v(n,"class",T),(!_||y[0]&1024&&c!==(c="dropzone "+h[10]))&&v(e,"class",c),(!_||y[0]&5120)&&Z(e,"opacity-50",h[12].disabled)},i(h){_||(P(d),P(N,h),P(u),_=!0)},o(h){j(d),j(N,h),j(u),_=!1},d(h){h&&I(e),s[32](null),d&&d.d(),N&&N.d(h),u&&u.d(),b=!1,Ge(p)}}}const nt="textarea relative flex justify-center items-center",at="w-full absolute top-0 left-0 right-0 bottom-0 z-[1] opacity-0 disabled:!opacity-0 cursor-pointer",it="flex justify-center items-center text-center";function rt(s,e,t){let l,a,n;const i=["files","fileInput","name","border","padding","rounded","regionInterface","regionInterfaceText","slotLead","slotMessage","slotMeta"];let o=de(e,i),{$$slots:m={},$$scope:g}=e;const w=Ue(m);let{files:L=void 0}=e,{fileInput:T=void 0}=e,{name:c}=e,{border:_="border-2 border-dashed"}=e,{padding:b="p-4 py-8"}=e,{rounded:p="rounded-container-token"}=e,{regionInterface:S=""}=e,{regionInterfaceText:r=""}=e,{slotLead:d="mb-4"}=e,{slotMessage:k=""}=e,{slotMeta:E="opacity-75"}=e;function N(){return delete o.class,o}function u(f){C.call(this,s,f)}function h(f){C.call(this,s,f)}function y(f){C.call(this,s,f)}function W(f){C.call(this,s,f)}function F(f){C.call(this,s,f)}function R(f){C.call(this,s,f)}function U(f){C.call(this,s,f)}function q(f){C.call(this,s,f)}function ke(f){C.call(this,s,f)}function Ie(f){C.call(this,s,f)}function Te(f){C.call(this,s,f)}function ye(f){C.call(this,s,f)}function Ee(){L=this.files,t(0,L)}function we(f){De[f?"unshift":"push"](()=>{T=f,t(1,T)})}return s.$$set=f=>{t(33,e=Q(Q({},e),me(f))),t(12,o=de(e,i)),"files"in f&&t(0,L=f.files),"fileInput"in f&&t(1,T=f.fileInput),"name"in f&&t(2,c=f.name),"border"in f&&t(14,_=f.border),"padding"in f&&t(15,b=f.padding),"rounded"in f&&t(16,p=f.rounded),"regionInterface"in f&&t(3,S=f.regionInterface),"regionInterfaceText"in f&&t(4,r=f.regionInterfaceText),"slotLead"in f&&t(5,d=f.slotLead),"slotMessage"in f&&t(6,k=f.slotMessage),"slotMeta"in f&&t(7,E=f.slotMeta),"$$scope"in f&&t(17,g=f.$$scope)},s.$$.update=()=>{t(10,l=`${nt} ${_} ${b} ${p} ${e.class??""}`)},t(9,a=`${at}`),t(8,n=`${it}`),e=me(e),[L,T,c,S,r,d,k,E,n,a,l,N,o,w,_,b,p,g,m,u,h,y,W,F,R,U,q,ke,Ie,Te,ye,Ee,we]}class ot extends ie{constructor(e){super(),re(this,e,rt,lt,ae,{files:0,fileInput:1,name:2,border:14,padding:15,rounded:16,regionInterface:3,regionInterfaceText:4,slotLead:5,slotMessage:6,slotMeta:7},null,[-1,-1])}}function Fe(s){let e,t;const l=s[22].default,a=_e(l,s,s[21],null);return{c(){e=z("div"),a&&a.c(),this.h()},l(n){e=D(n,"DIV",{class:!0});var i=A(e);a&&a.l(i),i.forEach(I),this.h()},h(){v(e,"class","slide-toggle-text ml-3")},m(n,i){B(n,e,i),a&&a.m(e,null),t=!0},p(n,i){a&&a.p&&(!t||i[0]&2097152)&&ve(a,l,n,n[21],t?pe(l,n[21],i,null):be(n[21]),null)},i(n){t||(P(a,n),t=!0)},o(n){j(a,n),t=!1},d(n){n&&I(e),a&&a.d(n)}}}function ct(s){let e,t,l,a,n,i,o,m,g,w,L,T,c,_,b,p=[{type:"checkbox"},{class:"slide-toggle-input hidden"},{name:s[1]},s[8](),{disabled:a=s[9].disabled}],S={};for(let d=0;d<p.length;d+=1)S=Q(S,p[d]);let r=s[10].default&&Fe(s);return{c(){e=z("div"),t=z("label"),l=z("input"),n=H(),i=z("div"),o=z("div"),w=H(),r&&r.c(),this.h()},l(d){e=D(d,"DIV",{id:!0,class:!0,"data-testid":!0,role:!0,"aria-label":!0,"aria-checked":!0,tabindex:!0});var k=A(e);t=D(k,"LABEL",{class:!0});var E=A(t);l=D(E,"INPUT",{type:!0,class:!0,name:!0}),n=G(E),i=D(E,"DIV",{class:!0});var N=A(i);o=D(N,"DIV",{class:!0}),A(o).forEach(I),N.forEach(I),w=G(E),r&&r.l(E),E.forEach(I),k.forEach(I),this.h()},h(){ue(l,S),v(o,"class",m="slide-toggle-thumb "+s[3]),Z(o,"cursor-not-allowed",s[9].disabled),v(i,"class",g="slide-toggle-track "+s[4]),Z(i,"cursor-not-allowed",s[9].disabled),v(t,"class",L="slide-toggle-label "+s[5]),v(e,"id",s[2]),v(e,"class",T="slide-toggle "+s[6]),v(e,"data-testid","slide-toggle"),v(e,"role","switch"),v(e,"aria-label",s[2]),v(e,"aria-checked",s[0]),v(e,"tabindex","0")},m(d,k){B(d,e,k),V(e,t),V(t,l),l.autofocus&&l.focus(),l.checked=s[0],V(t,n),V(t,i),V(i,o),V(t,w),r&&r.m(t,null),c=!0,_||(b=[M(l,"change",s[31]),M(l,"click",s[23]),M(l,"keydown",s[24]),M(l,"keyup",s[25]),M(l,"keypress",s[26]),M(l,"mouseover",s[27]),M(l,"change",s[28]),M(l,"focus",s[29]),M(l,"blur",s[30]),M(e,"keydown",s[7])],_=!0)},p(d,k){ue(l,S=Ze(p,[{type:"checkbox"},{class:"slide-toggle-input hidden"},(!c||k[0]&2)&&{name:d[1]},d[8](),(!c||k[0]&512&&a!==(a=d[9].disabled))&&{disabled:a}])),k[0]&1&&(l.checked=d[0]),(!c||k[0]&8&&m!==(m="slide-toggle-thumb "+d[3]))&&v(o,"class",m),(!c||k[0]&520)&&Z(o,"cursor-not-allowed",d[9].disabled),(!c||k[0]&16&&g!==(g="slide-toggle-track "+d[4]))&&v(i,"class",g),(!c||k[0]&528)&&Z(i,"cursor-not-allowed",d[9].disabled),d[10].default?r?(r.p(d,k),k[0]&1024&&P(r,1)):(r=Fe(d),r.c(),P(r,1),r.m(t,null)):r&&(O(),j(r,1,1,()=>{r=null}),K()),(!c||k[0]&32&&L!==(L="slide-toggle-label "+d[5]))&&v(t,"class",L),(!c||k[0]&4)&&v(e,"id",d[2]),(!c||k[0]&64&&T!==(T="slide-toggle "+d[6]))&&v(e,"class",T),(!c||k[0]&4)&&v(e,"aria-label",d[2]),(!c||k[0]&1)&&v(e,"aria-checked",d[0])},i(d){c||(P(r),c=!0)},o(d){j(r),c=!1},d(d){d&&I(e),r&&r.d(),_=!1,Ge(b)}}}const ft="inline-block",ut="unstyled flex items-center",dt="flex transition-all duration-[200ms] cursor-pointer",mt="w-[50%] h-full scale-[0.8] transition-all duration-[200ms] shadow";function ht(s,e,t){let l,a,n,i,o,m,g,w;const L=["name","checked","size","background","active","border","rounded","label"];let T=de(e,L),{$$slots:c={},$$scope:_}=e;const b=Ue(c),p=Je();let{name:S}=e,{checked:r=!1}=e,{size:d="md"}=e,{background:k="bg-surface-400 dark:bg-surface-700"}=e,{active:E="bg-surface-900 dark:bg-surface-300"}=e,{border:N=""}=e,{rounded:u="rounded-full"}=e,{label:h=""}=e,y;switch(d){case"sm":y="w-12 h-6";break;case"lg":y="w-20 h-10";break;default:y="w-16 h-8"}function W(f){["Enter","Space"].includes(f.code)&&(f.preventDefault(),p("keyup",f),f.currentTarget.firstChild.click())}function F(){return delete T.class,T}function R(f){C.call(this,s,f)}function U(f){C.call(this,s,f)}function q(f){C.call(this,s,f)}function ke(f){C.call(this,s,f)}function Ie(f){C.call(this,s,f)}function Te(f){C.call(this,s,f)}function ye(f){C.call(this,s,f)}function Ee(f){C.call(this,s,f)}function we(){r=this.checked,t(0,r)}return s.$$set=f=>{t(9,e=Q(Q({},e),me(f))),t(33,T=de(e,L)),"name"in f&&t(1,S=f.name),"checked"in f&&t(0,r=f.checked),"size"in f&&t(11,d=f.size),"background"in f&&t(12,k=f.background),"active"in f&&t(13,E=f.active),"border"in f&&t(14,N=f.border),"rounded"in f&&t(15,u=f.rounded),"label"in f&&t(2,h=f.label),"$$scope"in f&&t(21,_=f.$$scope)},s.$$.update=()=>{s.$$.dirty[0]&12289&&t(19,l=r?E:`${k} cursor-pointer`),s.$$.dirty[0]&1&&t(18,a=r?"bg-white/75":"bg-white"),s.$$.dirty[0]&1&&t(17,n=r?"translate-x-full":""),t(20,i=e.disabled===!0?"opacity-50":"hover:brightness-[105%] dark:hover:brightness-110 cursor-pointer"),t(6,o=`${ft} ${u} ${i} ${e.class??""}`),s.$$.dirty[0]&638976&&t(4,g=`${dt} ${N} ${u} ${y} ${l}`),s.$$.dirty[0]&425984&&t(3,w=`${mt} ${u} ${a} ${n}`)},t(5,m=`${ut}`),e=me(e),[r,S,h,w,g,m,o,W,F,e,b,d,k,E,N,u,y,n,a,l,i,_,c,R,U,q,ke,Ie,Te,ye,Ee,we]}class gt extends ie{constructor(e){super(),re(this,e,ht,ct,ae,{name:1,checked:0,size:11,background:12,active:13,border:14,rounded:15,label:2},null,[-1,-1])}}const ge=s=>s.replace(/\.[^/.]+$/,"");function _t(s){let e,t=s[0]?"Treatment":"Control",l,a;return{c(){e=z("span"),l=J(t),this.h()},l(n){e=D(n,"SPAN",{class:!0});var i=A(e);l=X(i,t),i.forEach(I),this.h()},h(){v(e,"class",a=`chip ${s[0]?"variant-soft-primary":"variant-soft-surface"}`)},m(n,i){B(n,e,i),V(e,l)},p(n,i){i&1&&t!==(t=n[0]?"Treatment":"Control")&&he(l,t),i&1&&a!==(a=`chip ${n[0]?"variant-soft-primary":"variant-soft-surface"}`)&&v(e,"class",a)},d(n){n&&I(e)}}}function vt(s){let e,t,l,a,n=ge(s[1])+"",i,o,m,g,w,L,T,c='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"></path></svg>',_,b,p;function S(d){s[4](d)}let r={active:"variant-soft-primary",size:"sm",class:"mr-2",name:"slide",$$slots:{default:[_t]},$$scope:{ctx:s}};return s[0]!==void 0&&(r.checked=s[0]),g=new gt({props:r}),De.push(()=>Ke(g,"checked",S)),g.$on("change",s[5]),{c(){e=z("div"),t=z("div"),l=z("div"),a=z("p"),i=J(n),o=H(),m=z("div"),$(g.$$.fragment),L=H(),T=z("button"),T.innerHTML=c,this.h()},l(d){e=D(d,"DIV",{class:!0});var k=A(e);t=D(k,"DIV",{class:!0});var E=A(t);l=D(E,"DIV",{class:!0});var N=A(l);a=D(N,"P",{class:!0});var u=A(a);i=X(u,n),u.forEach(I),o=G(N),m=D(N,"DIV",{class:!0});var h=A(m);ee(g.$$.fragment,h),L=G(h),T=D(h,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),x(T)!=="svelte-1m0ck3b"&&(T.innerHTML=c),h.forEach(I),N.forEach(I),E.forEach(I),k.forEach(I),this.h()},h(){v(a,"class","text-lg"),v(T,"type","button"),v(T,"class","btn-icon hover:variant-ringed-tertiary"),v(m,"class","flex justify-between items-center min-w-64"),v(l,"class","flex flex-col space-y-2 w-full"),v(t,"class","flex justify-center items-center space-x-2"),v(e,"class","card p-4")},m(d,k){B(d,e,k),V(e,t),V(t,l),V(l,a),V(a,i),V(l,o),V(l,m),te(g,m,null),V(m,L),V(m,T),_=!0,b||(p=M(T,"click",function(){qe(s[2])&&s[2].apply(this,arguments)}),b=!0)},p(d,[k]){s=d,(!_||k&2)&&n!==(n=ge(s[1])+"")&&he(i,n);const E={};k&65&&(E.$$scope={dirty:k,ctx:s}),!w&&k&1&&(w=!0,E.checked=s[0],Oe(()=>w=!1)),g.$set(E)},i(d){_||(P(g.$$.fragment,d),_=!0)},o(d){j(g.$$.fragment,d),_=!1},d(d){d&&I(e),se(g),b=!1,p()}}}function bt(s,e,t){let{filename:l}=e,{onRemove:a}=e,{onToggle:n}=e,{isTreatment:i=!1}=e;function o(g){i=g,t(0,i)}const m=()=>n(i);return s.$$set=g=>{"filename"in g&&t(1,l=g.filename),"onRemove"in g&&t(2,a=g.onRemove),"onToggle"in g&&t(3,n=g.onToggle),"isTreatment"in g&&t(0,i=g.isTreatment)},[i,l,a,n,o,m]}class pt extends ie{constructor(e){super(),re(this,e,bt,vt,ae,{filename:1,onRemove:2,onToggle:3,isTreatment:0})}}function kt(s){let e,t,l,a,n=ge(s[0])+"",i,o,m,g,w,L,T,c,_='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"></path></svg>',b,p;return{c(){e=z("div"),t=z("div"),l=z("div"),a=z("p"),i=J(n),o=H(),m=z("div"),g=z("span"),w=J(s[2]),T=H(),c=z("button"),c.innerHTML=_,this.h()},l(S){e=D(S,"DIV",{class:!0});var r=A(e);t=D(r,"DIV",{class:!0});var d=A(t);l=D(d,"DIV",{class:!0});var k=A(l);a=D(k,"P",{class:!0});var E=A(a);i=X(E,n),E.forEach(I),o=G(k),m=D(k,"DIV",{class:!0});var N=A(m);g=D(N,"SPAN",{class:!0});var u=A(g);w=X(u,s[2]),u.forEach(I),T=G(N),c=D(N,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),x(c)!=="svelte-1m0ck3b"&&(c.innerHTML=_),N.forEach(I),k.forEach(I),d.forEach(I),r.forEach(I),this.h()},h(){v(a,"class","text-lg"),v(g,"class",L=`chip ${s[3]}`),v(c,"type","button"),v(c,"class","btn-icon hover:variant-ringed-tertiary"),v(m,"class","flex justify-between items-center min-w-64"),v(l,"class","flex flex-col space-y-2 w-full"),v(t,"class","flex justify-center items-center space-x-2"),v(e,"class","card p-4")},m(S,r){B(S,e,r),V(e,t),V(t,l),V(l,a),V(a,i),V(l,o),V(l,m),V(m,g),V(g,w),V(m,T),V(m,c),b||(p=M(c,"click",function(){qe(s[1])&&s[1].apply(this,arguments)}),b=!0)},p(S,[r]){s=S,r&1&&n!==(n=ge(s[0])+"")&&he(i,n),r&4&&he(w,s[2]),r&8&&L!==(L=`chip ${s[3]}`)&&v(g,"class",L)},i:Y,o:Y,d(S){S&&I(e),b=!1,p()}}}function It(s,e,t){let{filename:l}=e,{onRemove:a}=e,{type:n}=e,{chip:i="variant-soft-success"}=e;return s.$$set=o=>{"filename"in o&&t(0,l=o.filename),"onRemove"in o&&t(1,a=o.onRemove),"type"in o&&t(2,n=o.type),"chip"in o&&t(3,i=o.chip)},[l,a,n,i]}class Qe extends ie{constructor(e){super(),re(this,e,It,kt,ae,{filename:0,onRemove:1,type:2,chip:3})}}function Tt(s){const e=s.split(`
`),t=["##gff-version 3"],l=[];let a="",n=!1,i=null,o=!1;const m=[];let g="",w=!1;const L=c=>{let _="+";c.startsWith("complement(")&&(_="-",c=c.replace("complement(","").replace(")","")),c=c.replace("<","").replace(">","");const[b,p]=c.split("..");if(isNaN(parseInt(b,10))||isNaN(parseInt(p,10)))throw new Error(`Invalid location: ${c}`);return{start:parseInt(b,10),end:parseInt(p,10),strand:_}},T=()=>{if(g&&a){l.push(`>${g}`);for(let c=0;c<a.length;c+=60)l.push(a.slice(c,c+60));m.forEach(c=>{c.attributes.gene?c.attributes.Name=c.attributes.gene:c.attributes.product?c.attributes.Name=c.attributes.product:c.attributes.locus_tag&&(c.attributes.Name=c.attributes.locus_tag),c.type==="source"&&(c.attributes.Name=c.attributes.organism);const _=Object.entries(c.attributes||{}).map(([b,p])=>`${b}=${p.replace(/"/g,"")}`).join(";");t.push(`${g}	diana	${c.type}	${c.start}	${c.end}	.	${c.strand}	.	${_}`)}),a="",n=!1,i=null,g="",m.length=0,o=!1}};return e.forEach(c=>{if(c.startsWith("LOCUS"))T(),g=c.split(/\s+/)[1];else if(c.startsWith("FEATURES"))o=!0;else if(c.startsWith("ORIGIN"))o=!1,n=!0;else if(n)a+=c.replace(/[^a-zA-Z]/g,"");else if(o&&/^\s+(?:[a-zA-Z_]+)\s+(complement\()?<?\d+\.\.>?\d+\)?$/.test(c)){const _=c.trim().split(/\s+/,2);if(_.length===2){const b=_[0],p=_[1],{start:S,end:r,strand:d}=L(p);i&&m.push(i),i={type:b,start:S,end:r,strand:d,attributes:{}}}}else if(o&&i&&c.trim().startsWith("/")){const _=c.trim().match(/^\/(\S+?)=(?:"(.+?)"|(.+))/);if(_){const[,b,p,S]=_,r=p||S||"";(r.startsWith('"')&&!r.endsWith('"')||r.startsWith("(")&&!r.endsWith(")"))&&(w=!0),i.attributes[b]=r}else console.log("Invalid qualifier:",c)}else if(w&&o&&i&&/^\s+[^/]/.test(c)){const _=Object.keys(i.attributes).pop();_&&(i.attributes[_]+=c.trim()),c.trim().endsWith('"')&&(w=!1)}else o&&i&&(console.log("Invalid line in feature:",c),m.push(i),i=null)}),T(),{gff:t.join(`
`),fasta:l.join(`
`)}}async function yt(s,e,t=5e4){const l=[];l.push(`variableStep chrom=${e}`);const a=s.split(`
`);for(let n=0;n<a.length;n+=t)a.slice(n,n+t).forEach((o,m)=>{let[g,w]=o.split(/\s+/).map(L=>parseInt(L,10));isNaN(w)&&(w=0),isNaN(g)&&(g=0),g!==0&&l.push(`${n+m} ${g}`),w!==0&&l.push(`${n+m} -${w}`)}),await new Promise(o=>setTimeout(o,0));return l.join(`
`)}function Me(s,e,t){const l=s.slice();return l[11]=e[t][0],l[12]=e[t][1].isTreatment,l[14]=t,l}function Re(s){let e,t,l;return t=new Qe({props:{type:"Reference",filename:s[3].filename,onRemove:ne.reset}}),{c(){e=z("div"),$(t.$$.fragment),this.h()},l(a){e=D(a,"DIV",{class:!0});var n=A(e);ee(t.$$.fragment,n),n.forEach(I),this.h()},h(){v(e,"class","m-2 w-full md:w-auto")},m(a,n){B(a,e,n),te(t,e,null),l=!0},p(a,n){const i={};n&8&&(i.filename=a[3].filename),t.$set(i)},i(a){l||(P(t.$$.fragment,a),l=!0)},o(a){j(t.$$.fragment,a),l=!1},d(a){a&&I(e),se(t)}}}function je(s){let e,t,l;return t=new Qe({props:{type:"Annotations",chip:"variant-soft-warning",filename:s[2].filename,onRemove:fe.reset}}),{c(){e=z("div"),$(t.$$.fragment),this.h()},l(a){e=D(a,"DIV",{class:!0});var n=A(e);ee(t.$$.fragment,n),n.forEach(I),this.h()},h(){v(e,"class","m-2 w-full md:w-auto")},m(a,n){B(a,e,n),te(t,e,null),l=!0},p(a,n){const i={};n&4&&(i.filename=a[2].filename),t.$set(i)},i(a){l||(P(t.$$.fragment,a),l=!0)},o(a){j(t.$$.fragment,a),l=!1},d(a){a&&I(e),se(t)}}}function Be(s){let e,t,l,a;function n(...o){return s[6](s[11],...o)}function i(){return s[7](s[11])}return t=new pt({props:{isTreatment:s[12],onToggle:n,onRemove:i,filename:s[11]}}),{c(){e=z("div"),$(t.$$.fragment),l=H(),this.h()},l(o){e=D(o,"DIV",{class:!0});var m=A(e);ee(t.$$.fragment,m),l=G(m),m.forEach(I),this.h()},h(){v(e,"class","m-2 w-full md:w-auto ")},m(o,m){B(o,e,m),te(t,e,null),V(e,l),a=!0},p(o,m){s=o;const g={};m&16&&(g.isTreatment=s[12]),m&16&&(g.onToggle=n),m&16&&(g.onRemove=i),m&16&&(g.filename=s[11]),t.$set(g)},i(o){a||(P(t.$$.fragment,o),a=!0)},o(o){j(t.$$.fragment,o),a=!1},d(o){o&&I(e),se(t)}}}function Et(s){let e,t,l;function a(i){s[8](i)}let n={padding:"py-4",name:"files",multiple:!0,$$slots:{meta:[Dt],message:[zt],lead:[Lt]},$$scope:{ctx:s}};return s[0]!==void 0&&(n.files=s[0]),e=new ot({props:n}),De.push(()=>Ke(e,"files",a)),e.$on("change",s[5]),e.$on("click",Ce),e.$on("drop",Ce),{c(){$(e.$$.fragment)},l(i){ee(e.$$.fragment,i)},m(i,o){te(e,i,o),l=!0},p(i,o){const m={};o&32768&&(m.$$scope={dirty:o,ctx:i}),!t&&o&1&&(t=!0,m.files=i[0],Oe(()=>t=!1)),e.$set(m)},i(i){l||(P(e.$$.fragment,i),l=!0)},o(i){j(e.$$.fragment,i),l=!1},d(i){se(e,i)}}}function wt(s){let e,t,l;return t=new xe({props:{value:void 0,width:"w-16",strokeLinecap:"round"}}),{c(){e=z("div"),$(t.$$.fragment),this.h()},l(a){e=D(a,"DIV",{class:!0});var n=A(e);ee(t.$$.fragment,n),n.forEach(I),this.h()},h(){v(e,"class","flex items-center justify-center align-middle")},m(a,n){B(a,e,n),te(t,e,null),l=!0},p:Y,i(a){l||(P(t.$$.fragment,a),l=!0)},o(a){j(t.$$.fragment,a),l=!1},d(a){a&&I(e),se(t)}}}function Lt(s){let e,t='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-8"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m3.75 9v6m3-3H9m1.5-12H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"></path></svg>';return{c(){e=z("div"),e.innerHTML=t,this.h()},l(l){e=D(l,"DIV",{class:!0,"data-svelte-h":!0}),x(e)!=="svelte-stz8rw"&&(e.innerHTML=t),this.h()},h(){v(e,"class","flex justify-center")},m(l,a){B(l,e,a)},p:Y,d(l){l&&I(e)}}}function zt(s){let e,t='<span class="font-semibold">Load files</span> or drag and drop';return{c(){e=z("p"),e.innerHTML=t,this.h()},l(l){e=D(l,"P",{class:!0,"data-svelte-h":!0}),x(e)!=="svelte-10rbgmq"&&(e.innerHTML=t),this.h()},h(){v(e,"class","text-xl ")},m(l,a){B(l,e,a)},p:Y,d(l){l&&I(e)}}}function Dt(s){let e;return{c(){e=J("GENBANK, GFF, FASTA, WIG and UserPlot files allowed.")},l(t){e=X(t,"GENBANK, GFF, FASTA, WIG and UserPlot files allowed.")},m(t,l){B(t,e,l)},d(t){t&&I(e)}}}function St(s){let e,t='<div class="flex flex-col items-center align-baseline justify-center max-w-4xl space-y-8 "><figure class="card-hover rounded-full svelte-ppo8by"><div><section class="img-bg svelte-ppo8by"></section></div> <img class="logo-img mt-8 svelte-ppo8by" src="/images/logo2.png" alt="Skeleton Logo"/></figure> <h1 class="text-center text-3xl mx-2">Transposon Sequencing Data Visualiser</h1></div>',l,a,n,i,o,m,g,w,L,T,c,_,b=s[3].filename&&Re(s),p=s[2].filename&&je(s),S=Se(Array.from(s[4].entries()).sort(He)),r=[];for(let u=0;u<S.length;u+=1)r[u]=Be(Me(s,S,u));const d=u=>j(r[u],1,1,()=>{r[u]=null}),k=[wt,Et],E=[];function N(u,h){return u[1]?0:1}return T=N(s),c=E[T]=k[T](s),{c(){e=z("div"),e.innerHTML=t,l=H(),a=z("div"),n=z("div"),b&&b.c(),i=H(),p&&p.c(),o=H(),m=z("div");for(let u=0;u<r.length;u+=1)r[u].c();g=H(),w=z("div"),L=z("div"),c.c(),this.h()},l(u){e=D(u,"DIV",{class:!0,"data-svelte-h":!0}),x(e)!=="svelte-kcnmyh"&&(e.innerHTML=t),l=G(u),a=D(u,"DIV",{class:!0});var h=A(a);n=D(h,"DIV",{class:!0});var y=A(n);b&&b.l(y),i=G(y),p&&p.l(y),y.forEach(I),o=G(h),m=D(h,"DIV",{class:!0});var W=A(m);for(let U=0;U<r.length;U+=1)r[U].l(W);W.forEach(I),h.forEach(I),g=G(u),w=D(u,"DIV",{class:!0});var F=A(w);L=D(F,"DIV",{class:!0});var R=A(L);c.l(R),R.forEach(I),F.forEach(I),this.h()},h(){v(e,"class","flex justify-center mb-6"),v(n,"class","flex flex-wrap justify-center w-full"),v(m,"class","flex flex-wrap justify-center "),v(a,"class","flex flex-col justify-center items-center mb-6"),v(L,"class","w-full max-w-3xl mx-4 mb-4"),v(w,"class","flex justify-center ")},m(u,h){B(u,e,h),B(u,l,h),B(u,a,h),V(a,n),b&&b.m(n,null),V(n,i),p&&p.m(n,null),V(a,o),V(a,m);for(let y=0;y<r.length;y+=1)r[y]&&r[y].m(m,null);B(u,g,h),B(u,w,h),V(w,L),E[T].m(L,null),_=!0},p(u,[h]){if(u[3].filename?b?(b.p(u,h),h&8&&P(b,1)):(b=Re(u),b.c(),P(b,1),b.m(n,i)):b&&(O(),j(b,1,1,()=>{b=null}),K()),u[2].filename?p?(p.p(u,h),h&4&&P(p,1)):(p=je(u),p.c(),P(p,1),p.m(n,null)):p&&(O(),j(p,1,1,()=>{p=null}),K()),h&16){S=Se(Array.from(u[4].entries()).sort(He));let W;for(W=0;W<S.length;W+=1){const F=Me(u,S,W);r[W]?(r[W].p(F,h),P(r[W],1)):(r[W]=Be(F),r[W].c(),P(r[W],1),r[W].m(m,null))}for(O(),W=S.length;W<r.length;W+=1)d(W);K()}let y=T;T=N(u),T===y?E[T].p(u,h):(O(),j(E[y],1,1,()=>{E[y]=null}),K(),c=E[T],c?c.p(u,h):(c=E[T]=k[T](u),c.c()),P(c,1),c.m(L,null))},i(u){if(!_){P(b),P(p);for(let h=0;h<S.length;h+=1)P(r[h]);P(c),_=!0}},o(u){j(b),j(p),r=r.filter(Boolean);for(let h=0;h<r.length;h+=1)j(r[h]);j(c),_=!1},d(u){u&&(I(e),I(l),I(a),I(g),I(w)),b&&b.d(),p&&p.d(),Xe(r,u),E[T].d()}}}function Vt(s){const e=s.split(`
`);let t="",l="",a=!1;for(const n of e){if(n.startsWith("##")&&n.includes("FASTA")){a=!0;continue}a&&(n.startsWith(">")?(l&&(t+=l+`
`),l=n+`
`):l+=n.trim())}return l&&(t+=l+`
`),t.trim()}function Ce(){const s=document.getElementsByName("files")[0];s.value=""}const He=([s],[e])=>s.localeCompare(e);function Wt(s,e,t){let l,a,n,i;oe(s,fe,_=>t(2,l=_)),oe(s,ce,_=>t(9,a=_)),oe(s,ne,_=>t(3,n=_)),oe(s,le,_=>t(4,i=_));const o=Ye();let m,g=!1;function w(_){if(!m||m.length===0)return;t(1,g=!0);let b=[];for(let p=0;p<m.length;p++){const S=m[p],r=S.name,d=new FileReader;b.push(new Promise((k,E)=>{d.onload=async N=>{var h,y;let u=(y=(h=N.target)==null?void 0:h.result)==null?void 0:y.toString();if(r.endsWith(".gb")||r.endsWith(".gbk")||r.endsWith(".genbank")){let W="",F="";try{const R=Tt(u);W=R.gff,F=R.fasta}catch(R){console.error("Error converting GenBank file:",R);const q={message:"Error converting GenBank file: "+R,background:"variant-glass-error"};o.trigger(q),E("Error converting GenBank file: "+R)}await fe.load(r,W),Le(ce,a.locus=void 0,a),F.length>0&&(await ne.load(r,F).catch(R=>{console.error("Error loading reference:",R);const q={message:"Error loading reference: "+R,background:"variant-glass-error"};o.trigger(q)}),await ze.load(F),k(0))}else if(r.endsWith(".gff")||r.endsWith(".gff3")){await fe.load(r,u),Le(ce,a.locus=void 0,a);const W=Vt(u);W.length>0&&(await ne.load(r,W).catch(F=>{console.error("Error loading reference:",F);const U={message:"Error loading reference: "+F,background:"variant-glass-error"};o.trigger(U)}),await ze.load(W),k(0))}else if(r.endsWith(".fasta")||r.endsWith(".fa")||r.endsWith(".fna"))await ne.load(r,u),await ze.load(u),Le(ce,a.locus=void 0,a),k(0);else if(r.endsWith(".wig")||r.endsWith(".wiggle"))await le.load(r,u),k(0);else if(r.endsWith(".userplot")||r.endsWith(".plot")){const W=l.chromosomes.keys().next().value;if(W){const F={message:`Converting UserPlot file '${r}' to Wig Format. Assuming the first chromosome in the annotations is the reference chromosome`,background:"variant-glass-warning"};o.trigger(F);const R=await yt(u,W);await le.load(r,R),k(0)}else{console.error("No chromosome found in annotations");const R={message:"Please load annotations before loading userplot files",background:"variant-glass-error"};o.trigger(R),E("No chromosome found in annotations")}}else{console.error("Unsupported file type:",r);const F={message:"Unsupported file type: "+r,background:"variant-glass-error"};o.trigger(F),E("Unsupported file type: "+r)}k(0)},d.onerror=E,d.readAsText(S)}))}Promise.all(b).then(p=>{t(1,g=!1)}).catch(p=>{console.error("Error reading files:",p),t(1,g=!1)})}const L=(_,b)=>le.setIsTreatment(_,b),T=_=>le.remove(_);function c(_){m=_,t(0,m)}return[m,g,l,n,i,w,L,T,c]}class Ot extends ie{constructor(e){super(),re(this,e,Wt,St,ae,{})}}export{Ot as component};
