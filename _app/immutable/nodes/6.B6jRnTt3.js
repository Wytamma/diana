import{s as V,c as q,o as A,q as H,n as M}from"../chunks/scheduler.Cxdq5DjT.js";import{S as z,i as G,e as v,t as N,s as P,c as w,a as y,b as $,d as g,f as S,k as B,l as E,o as b,g as x,h as _,j as W,q as D,r as J,u as I,v as K,w as R,x as T,y as j,z as O}from"../chunks/index.Bp_61F_m.js";import{i as Q}from"../chunks/insertStore.DwlY1-2V.js";import{a as U}from"../chunks/annotationStore.D01fgoLY.js";import{g as k}from"../chunks/generateGeneInsertSites.ozbo97IV.js";import"../chunks/ProgressBar.svelte_svelte_type_style_lang.DkJRRaEQ.js";import{P as X}from"../chunks/ProgressRadial.BwNK8EGC.js";import{P as F}from"../chunks/plotly.cbd5aJyv.js";async function Y(l,e,a=0){const o=[];if(l.length!==e.length)throw new Error("Control and condition datasets must have the same number of samples.");for(let n=0;n<l[0].length;n++){const t=l[0][n].name,r=l[0][n].start;let s=0,m=0;for(let f=0;f<l.length;f++)s+=l[f][n].readCount,m+=e[f][n].readCount;if(s<a&&m<a)continue;const h=Math.log2((m+1)/(s+1));o.push({name:t,start:r,logFC:h,qValue:void 0}),n%100===0&&await new Promise(f=>setTimeout(f,0))}return o}function L(l){let e,a,o;return a=new X({props:{value:void 0,width:"w-14",strokeLinecap:"round"}}),{c(){e=v("div"),R(a.$$.fragment),this.h()},l(n){e=w(n,"DIV",{class:!0});var t=y(e);T(a.$$.fragment,t),t.forEach(g),this.h()},h(){E(e,"class","flex items-center justify-center align-middle m-12")},m(n,t){x(n,e,t),j(a,e,null),o=!0},p:M,i(n){o||(D(a.$$.fragment,n),o=!0)},o(n){I(a.$$.fragment,n),o=!1},d(n){n&&g(e),O(a)}}}function Z(l){let e,a,o,n,t,r,s,m,h,c="The logFC represents the log2 fold-change between control and condition read counts for each gene.",f,i=l[1]&&L();return{c(){e=v("div"),a=v("header"),o=N(l[0]),n=P(),t=v("section"),r=v("div"),s=P(),i&&i.c(),m=P(),h=v("footer"),h.textContent=c,this.h()},l(u){e=w(u,"DIV",{class:!0});var d=y(e);a=w(d,"HEADER",{class:!0});var p=y(a);o=$(p,l[0]),p.forEach(g),n=S(d),t=w(d,"SECTION",{class:!0});var C=y(t);r=w(C,"DIV",{id:!0,style:!0}),y(r).forEach(g),s=S(C),i&&i.l(C),C.forEach(g),m=S(d),h=w(d,"FOOTER",{class:!0,"data-svelte-h":!0}),B(h)!=="svelte-1qpessx"&&(h.textContent=c),d.forEach(g),this.h()},h(){E(a,"class","card-header"),E(r,"id",l[2]),b(r,"width","100%"),b(r,"height","100%"),E(t,"class","p-4"),E(h,"class","card-footer"),E(e,"class","card")},m(u,d){x(u,e,d),_(e,a),_(a,o),_(e,n),_(e,t),_(t,r),_(t,s),i&&i.m(t,null),_(e,m),_(e,h),f=!0},p(u,[d]){(!f||d&1)&&W(o,u[0]),u[1]?i?(i.p(u,d),d&2&&D(i,1)):(i=L(),i.c(),D(i,1),i.m(t,null)):i&&(J(),I(i,1,1,()=>{i=null}),K())},i(u){f||(D(i),f=!0)},o(u){I(i),f=!1},d(u){u&&g(e),i&&i.d()}}}function ee(l,e,a){let o;q(l,U,c=>a(5,o=c));let{filename:n}=e,{controlData:t}=e,{conditionData:r}=e,s=`plotly-${n}`,m=!0;const h=()=>{const c=document.getElementById(s);c&&F.relayout(c,{width:c.clientWidth,height:c.clientHeight})};return A(async()=>{const c=await Promise.all(t.map(p=>k(o.features,p,[],0,0))),f=await Promise.all(r.map(p=>k(o.features,p,[],0,0))),i=await Y(c,f),u={xaxis:{title:"Gene"},yaxis:{title:"Log2 Fold Change (logFC)"},margin:{b:25,t:25}},d={x:i.map(p=>p.start),y:i.map(p=>p.logFC),text:i.map(p=>p.name),type:"scatter",mode:"markers",marker:{size:8}};F.newPlot(s,[d],u),window.addEventListener("resize",h),a(1,m=!1)}),H(()=>{window.removeEventListener("resize",h)}),l.$$set=c=>{"filename"in c&&a(0,n=c.filename),"controlData"in c&&a(3,t=c.controlData),"conditionData"in c&&a(4,r=c.conditionData)},[n,m,s,t,r]}class te extends z{constructor(e){super(),G(this,e,ee,Z,V,{filename:0,controlData:3,conditionData:4})}}function ne(l){let e,a,o,n;return o=new te({props:{controlData:l[0],conditionData:l[1],filename:"log2FC"}}),{c(){e=v("div"),a=v("div"),R(o.$$.fragment),this.h()},l(t){e=w(t,"DIV",{class:!0});var r=y(e);a=w(r,"DIV",{class:!0});var s=y(a);T(o.$$.fragment,s),s.forEach(g),r.forEach(g),this.h()},h(){E(a,"class","m-4"),E(e,"class","m-4")},m(t,r){x(t,e,r),_(e,a),j(o,a,null),n=!0},p(t,[r]){const s={};r&1&&(s.controlData=t[0]),r&2&&(s.conditionData=t[1]),o.$set(s)},i(t){n||(D(o.$$.fragment,t),n=!0)},o(t){I(o.$$.fragment,t),n=!1},d(t){t&&g(e),O(o)}}}function ae(l,e,a){let o;q(l,Q,s=>a(2,o=s));let n=[],t=[];const r=Array.from(o.entries());return n=r.filter(([s,m])=>s.toLowerCase().includes("0")).map(([s,m])=>m.total),t=r.filter(([s,m])=>!s.toLowerCase().includes("0")).map(([s,m])=>m.total),[n,t]}class de extends z{constructor(e){super(),G(this,e,ae,ne,V,{})}}export{de as component};
